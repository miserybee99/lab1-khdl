\begin{figure}
\centering
\begin{tikzpicture}[
    state/.style={},
    xscale=1.3,yscale=-1.3
]
    \node[state] at (0,0) (q1) {$\state_1$};
    \node[state] at (0,1) (qm) {$\state_\channelmessage$};
    \node[state] at (0,2) (q3) {$\state_3$};
    \node[state] at (0,3) (q4) {$\state_4$};
    \node[state] at (0,4) (q5) {$\state_5$};
    \node[state] at (0,5) (q6) {$\state_6$};
    \node[state] at (0,6) (q7) {$\state_7$};
    \node[state] at (0,7) (q8) {$\state_8$};
    \node[state] at (0,8) (q9) {$\state_9$};
    \node[state] at (0,9) (q10) {$\state_{10}$};
    \node[state] at (0,10) (q11) {$\state_{11}$};
    \node[state] at (0,11) (q12) {$\state_{12}$};
    \node[state] at (0,12) (q13) {$\state_{13}$};
    \node[state] at (0,13) (q14) {$\state_{14}$};
    \node[state] at (0,14) (q1') {$\state_{1}$};

    \draw[->] (q1) -- node[right] {$\rd(\xwr,\channelmessage)$} (qm);
    \draw[->] (qm) -- node[right] {$\wr(\xrd,\channelmessage)$} (q3);
    \draw[->] (q3) -- node[right] {$\mf$} (q4);
    \draw[->] (q4) -- node[right] {$\wr(\xwr,\bot)$} (q5);
    \draw[->] (q5) -- node[right] {$\nop$} (q6);
    \draw[->] (q6) -- node[right] {$\mf$} (q7);
    \draw[->] (q7) -- node[right] {$\rd(\yvar,0)$} (q8);
    \draw[->] (q8) -- node[right] {$\rd(\yvar,1)$} (q9);
    \draw[->] (q9) -- node[right] {$\wr(\yvar,0)$} (q10);
    \draw[->] (q10) -- node[right] {$\mf$} (q11);
    \draw[->] (q11) -- node[right] {$\rd(\xwr,\bot)$} (q12);
    \draw[->] (q12) -- node[right] {$\wr(\xrd,\bot)$} (q13);
    \draw[->] (q13) -- node[right] {$\nop$} (q14);
    \draw[->] (q14) -- node[right] {$\mf$} (q1');

    \node at (-1.5,0) {$\nop$};
    \node[state] at (-3,0)(h1) {$\hstate_1$};
    \node[state] at (-5,0)(f1) {$\state_F$};
    \draw[->] (q1) to [bend left=15] (h1);
    \draw[->] (h1) -- node[above] {$\nop$} (f1);
    \draw[->] (f1) to [out=225,in=135,loop] node[left] {$\nop$} (f1);
    \draw[->] (h1) to [bend left=15] (q1);

    \node at (-1.5,2) {$\nop$};
    \node[state] at (-3,2)(h2) {$\hstate_2$};
    \node[state] at (-5,2)(f2) {$\state_F$};
    \draw[->] (q3) to [bend left=15] (h2);
    \draw[->] (h2) -- node[above] {$\nop$} (f2);
    \draw[->] (f2) to [out=225,in=135,loop] node[left] {$\nop$} (f2);
    \draw[->] (h2) to [bend left=15] (q3);

    % \node at (-1.5,3) {$\nop$};
    % \node[state] at (-3,3)(h3) {$\hstate_3$};
    % \node[state] at (-5,3)(f3) {$\state_F$};
    % \draw[->] (q4) to [bend left=15] (h3);
    % \draw[->] (h3) -- node[above] {$\nop$} (f3);
    % \draw[->] (f3) to [out=225,in=135,loop] node[left] {$\nop$} (f3);
    % \draw[->] (h3) to [bend left=15] (q4);

    \node at (-1.5,7) {$\nop$};
    \node[state] at (-3,7)(h4) {$\hstate_3$};
    \node[state] at (-5,7)(f4) {$\state_F$};
    \draw[->] (q8) to [bend left=15] (h4);
    \draw[->] (h4) -- node[above] {$\nop$} (f4);
    \draw[->] (f4) to [out=225,in=135,loop] node[left] {$\nop$} (f4);
    \draw[->] (h4) to [bend left=15] (q8);

    \node at (-1.5,9) {$\nop$};
    \node[state] at (-3,9)(h5) {$\hstate_4$};
    \node[state] at (-5,9)(f5) {$\state_F$};
    \draw[->] (q10) to [bend left=15] (h5);
    \draw[->] (h5) -- node[above] {$\nop$} (f5);
    \draw[->] (f5) to [out=225,in=135,loop] node[left] {$\nop$} (f5);
    \draw[->] (h5) to [bend left=15] (q10);

    \node at (-1.5,13) {$\nop$};
    \node[state] at (-3,13)(h5) {$\hstate_5$};
    \node[state] at (-5,13)(f5) {$\state_F$};
    \draw[->] (q14) to [bend left=15] (h5);
    \draw[->] (h5) -- node[above] {$\nop$} (f5);
    \draw[->] (f5) to [out=225,in=135,loop] node[left] {$\nop$} (f5);
    \draw[->] (h5) to [bend left=15] (q14);


    \node[state] at (3,0) (qf) {$\state_L$};
    \draw[->] (q1) -- node[above right] {$\rd(\xwr, \channelmessage)$} (qf);
    \draw[->] (qf) to [out=315,in=45,loop] node[right] {$\nop$} (qf);

    \node[state] at (3,1) (qf) {$\state_F$};
    \draw[->] (qm) -- node[above right] {$\nop$} (qf);
    \draw[->] (qf) to [out=315,in=45,loop] node[right] {$\nop$} (qf);

    \node[state] at (3,2) (qf) {$\state_L$};
    \draw[->] (q3) -- node[above right] {$\nop$} (qf);
    \draw[->] (qf) to [out=315,in=45,loop] node[right] {$\nop$} (qf);

    \node[state] at (3,3) (qf) {$\state_F$};
    \draw[->] (q4) -- node[above right] {$\nop$} (qf);
    \draw[->] (qf) to [out=315,in=45,loop] node[right] {$\nop$} (qf);

    \node[state] at (3,5) (qf) {$\state_L$};
    \draw[->] (q6) -- node[above right] {$\nop$} (qf);
    \draw[->] (qf) to [out=315,in=45,loop] node[right] {$\nop$} (qf);

    \node[state] at (3,6) (qf) {$\state_L$};
    \draw[->] (q7) -- node[above right] {$\rd(\yvar,1)$} (qf);
    \draw[->] (qf) to [out=315,in=45,loop] node[right] {$\nop$} (qf);

    \node[state] at (3,10) (qf) {$\state_L$};
    \draw[->] (q11) -- node[above right] {$\rd(\xwr,\channelmessage)$} (qf);
    \draw[->] (qf) to [out=315,in=45,loop] node[right] {$\nop$} (qf);

    \node[state] at (3,13) (qf) {$\state_L$};
    \draw[->] (q14) -- node[above right] {$\rd(\xwr,\channelmessage)$} (qf);
    \draw[->] (qf) to [out=315,in=45,loop] node[right] {$\nop$} (qf);

    \node[state] at (3,14) (qf) {$\state_F$};
    \draw[->] (q1') -- node[above right] {$\rd(\xwr,\top)$} (qf);
    \draw[->] (qf) to [out=315,in=45,loop] node[right] {$\nop$} (qf);

    \draw[thick,decoration={brace, mirror},decorate] (q1.south west) -- node[left]{for all $\channelmessage \in \channelmessageset$} (q3.north west);
\end{tikzpicture}
\bigskip
\caption{$\process^2$ of the B-TSO reduction from PCS}
\label{fig:b-reduction-2}
\end{figure}
