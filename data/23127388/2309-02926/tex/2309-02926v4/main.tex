%%
%% This is file `sample-sigconf.tex',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% samples.dtx  (with options: `sigconf')
%% 
%% IMPORTANT NOTICE:
%% 
%% For the copyright see the source file.
%% 
%% Any modified versions of this file must be renamed
%% with new filenames distinct from sample-sigconf.tex.
%% 
%% For distribution of the original source see the terms
%% for copying and modification in the file samples.dtx.
%% 
%% This generated file may be distributed as long as the
%% original source files, as listed above, are part of the
%% same distribution. (The sources need not necessarily be
%% in the same archive or directory.)
%%
%%
%% Commands for TeXCount
%TC:macro \cite [option:text,text]
%TC:macro \citep [option:text,text]
%TC:macro \citet [option:text,text]
%TC:envir table 0 1
%TC:envir table* 0 1
%TC:envir tabular [ignore] word
%TC:envir displaymath 0 word
%TC:envir math 0 word
%TC:envir comment 0 0
%%
%%
%% The first command in your LaTeX source must be the \documentclass
%% command.
%%
%% For submission and review of your manuscript please change the
%% command to \documentclass[manuscript, screen, review]{acmart}.
%%
%% When submitting camera ready or to TAPS, please change the command
%% to \documentclass[sigconf]{acmart} or whichever template is required
%% for your publication.
%%
%%
\documentclass[sigconf]{acmart}
% \documentclass[sigconf, authorversion, nonacm]{acmart}

% to be able to draw some self-contained figs
\usepackage{amsmath}

% inlined bib file
%\usepackage{filecontents}

\usepackage{verbatim} % for \begin{comment} command 
\usepackage{booktabs} % for toprule midrule bottomrule command...
%\usepackage{comment}
\usepackage{enumitem}
\usepackage{multicol}
\usepackage{listings}
\usepackage{url}
\def\UrlBreaks{\do\A\do\B\do\C\do\D\do\E\do\F\do\G\do\H\do\I\do\J
\do\K\do\L\do\M\do\N\do\O\do\P\do\Q\do\R\do\S\do\T\do\U\do\V
\do\W\do\X\do\Y\do\Z\do\[\do\\\do\]\do\^\do\_\do\`\do\a\do\b
\do\c\do\d\do\e\do\f\do\g\do\h\do\i\do\j\do\k\do\l\do\m\do\n
\do\o\do\p\do\q\do\r\do\s\do\t\do\u\do\v\do\w\do\x\do\y\do\z
\do\.\do\@\do\\\do\/\do\!\do\_\do\|\do\;\do\>\do\]\do\)\do\,
\do\?\do\'\do+\do\=\do\#}
%\usepackage{soul}
\usepackage{threeparttable}
\usepackage{tikz}
\usepackage{xcolor}
\usepackage{xspace}

% \usepackage{hyperref}

\usepackage{multirow}
\usepackage{bbding}

% clean mode, revision mode, and new mode
% use \rlegend to see the usage.
% \rchange{old}{new}
% \usepackage[clean]{revdiff} 

\usepackage{siunitx}
%\usepackage{ulem}
\usepackage{colortbl}
\usepackage{pifont}
\usepackage{seqsplit}
\usepackage[ruled,vlined,linesnumbered]{algorithm2e}

\usepackage{float}

\usepackage{lipsum} 
%\SetAlFnt{\small}

\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}
\definecolor{keyword_color}{RGB}{176,1,75}
\definecolor{id_color}{RGB}{52,5,255}
\definecolor{comment_color}{RGB}{64,128,128}

\definecolor{githubred}{RGB}{255,235,233}
\definecolor{githubgreen}{RGB}{230,255,236}
\definecolor{hpwgray}{RGB}{239,241,243}
\definecolor{codegreen}{RGB}{0,115,0}


\definecolor{hgblue}{RGB}{138,200,224}
\definecolor{hgred}{RGB}{245,138,143}

\definecolor{gold}{RGB}{221, 196, 65}
\definecolor{silver}{RGB}{215, 215, 215}
\definecolor{bronze}{RGB}{126, 66, 5}

\definecolor{mygray}{gray}{.9}

\lstdefinestyle{mystyle}{
	backgroundcolor=\color{backcolour}, 
	commentstyle=\color{codegreen},
	keywordstyle=\color{keyword_color}\bfseries,
	numberstyle=\tiny\color{codegray},
	stringstyle=\color{codepurple},
	% keywordstyle=\color{blue!80!black},
	identifierstyle=\color{id_color},
	basicstyle=\ttfamily\footnotesize,
	breakatwhitespace=false,         
	breaklines=true,                 
	captionpos=b,                    
	keepspaces=true,                 
	numbers=left,                    
	numbersep=5pt,                  
	showspaces=false,                
	showstringspaces=false,
	showtabs=false,                  
	tabsize=2,
	xleftmargin=1.5em,
	xrightmargin=0.5em, 
	aboveskip=1em,
	escapeinside={\%*}{*)}
}
\lstset{style=mystyle}



\def\X#1{\ding{\numexpr181+#1}}

\newtheorem{mydef}{Definition}

\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
		T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}
	
\newcommand\old[1]{\ignorespaces} % ignore spaces and texts.
\newcommand\re[1]{\textcolor{black}{#1}}
\newcommand\red[1]{\textcolor{red}{#1}}
% \newcommand\tool{\textsc{LLMVulnX}\xspace}
\newcommand\tool{\textsc{LLMSmith}\xspace}
\newcommand\dzz[1]{\textcolor{brown}{ZZ: #1}}
\newcommand\guozhu[1]{\textcolor{purple}{GZ: #1}}
\newcommand\lyk[1]{\textcolor{orange}{lyk: #1}}
\newcommand\todo[1]{\textcolor{black}{#1}}
\newcommand\lt[1]{\textcolor{red}{LT: #1}}
\newcommand\kai[1]{\textcolor{blue}{kai: #1}}



\newcommand\etal{\textit{et al.}\xspace}
\newcommand\eg{\textit{e.g.}\xspace}
\newcommand\Eg{\textit{E.g.}\xspace}
\newcommand\ie{\textit{i.e.}\xspace}

\renewcommand{\texttt}[1]{\textsf{#1}}


% Draw the circle
\newcommand*\emptycirc[1][1ex]{\tikz\draw (0,0) circle (#1);} 
\newcommand*\halfcirc[1][1ex]{%
	\begin{tikzpicture}
	\draw[fill] (0,0)-- (90:#1) arc (90:270:#1) -- cycle ;
	\draw (0,0) circle (#1);
	\end{tikzpicture}}
\newcommand*\fullcirc[1][1ex]{\tikz\fill (0,0) circle (#1);} 

% \settopmatter{printfolios=true}
\pagestyle{plain}
\pagenumbering{arabic}

%%
%% \BibTeX command to typeset BibTeX logo in the docs
\AtBeginDocument{%
  \providecommand\BibTeX{{%
    Bib\TeX}}}

%% ------------------ use package -----------------------
\usepackage{enumitem}
\usepackage[ruled,vlined,linesnumbered]{algorithm2e}
% \usepackage{algorithmic}
% \usepackage{algorithm}
% \renewcommand{\algorithmiccomment}[1]{\hfill $\triangleright$ #1}
%% ------------------------------------------------------

%% Rights management information.  This information is sent to you
%% when you complete the rights form.  These commands have SAMPLE
%% values in them; it is your responsibility as an author to replace
%% the commands and values with those provided to you when you
%% complete the rights form.
% \setcopyright{acmcopyright}
% \copyrightyear{2024}
% \acmYear{2024}
% \acmDOI{XXXXXXX.XXXXXXX}

% \copyrightyear{2024}
% \acmYear{2024}
% \setcopyright{acmcopyright}
% \acmConference[CCS '24] {Proceedings of the 2024 ACM SIGSAC Conference on Computer and Communications Security}{October 14-18, 2024}{Salt Lake City, USA.}
% \acmBooktitle{Proceedings of the 2024 ACM SIGSAC Conference on Computer and Communications Security (CCS '24), October 14-18, 2024, Salt Lake City, USA.}
% \acmPrice{15.00}
% \acmISBN{xxxx}
% \acmDOI{10.1145/3658644.3690338}

\copyrightyear{2024} 
\acmYear{2024}
\setcopyright{rightsretained}
\acmConference[CCS '24]{Proceedings of the 2024 ACM SIGSAC Conference on Computer and Communications Security}{October 14--18, 2024}{Salt Lake City, UT, USA}
\acmBooktitle{Proceedings of the 2024 ACM SIGSAC Conference on Computer and Communications Security (CCS '24), October 14--18, 2024, Salt Lake City, UT, USA}
\acmDOI{10.1145/3658644.3690338}
\acmISBN{979-8-4007-0636-3/24/10}

%% These commands are for a PROCEEDINGS abstract or paper.
%\acmConference[Conference acronym 'XX]{Make sure to enter the correct
%  conference title from your rights confirmation emai}{June 03--05,
 % 2018}{Woodstock, NY}
%%
%%  Uncomment \acmBooktitle if the title of the proceedings is different
%%  from ``Proceedings of ...''!
%%
%%\acmBooktitle{Woodstock '18: ACM Symposium on Neural Gaze Detection,
%%  June 03--05, 2018, Woodstock, NY}
%\acmPrice{15.00}
%\acmISBN{978-1-4503-XXXX-X/18/06}


%%
%% Submission ID.
%% Use this when submitting an article to a sponsored event. You'll
%% receive a unique submission ID from the organizers
%% of the event, and this ID should be used as the parameter to this command.
%%\acmSubmissionID{123-A56-BU3}

%%
%% For managing citations, it is recommended to use bibliography
%% files in BibTeX format.
%%
%% You can then either use BibTeX with the ACM-Reference-Format style,
%% or BibLaTeX with the acmnumeric or acmauthoryear sytles, that include
%% support for advanced citation of software artefact from the
%% biblatex-software package, also separately available on CTAN.
%%
%% Look at the sample-*-biblatex.tex files for templates showcasing
%% the biblatex styles.
%%

%%
%% The majority of ACM publications use numbered citations and
%% references.  The command \citestyle{authoryear} switches to the
%% "author year" style.
%%
%% If you are preparing content for an event
%% sponsored by ACM SIGGRAPH, you must use the "author year" style of
%% citations and references.
%% Uncommenting
%% the next command will enable that style.
%%\citestyle{acmauthoryear}


%%Remove copyright
\settopmatter{printacmref=true}
% \setcopyright{none}
% \renewcommand\footnotetextcopyrightpermission[1]{}
% \pagestyle{plain}
\settopmatter{printfolios=false}
%%
%% end of the preamble, start of the body of the document source.
\begin{document}

%%
%% The "title" command has an optional parameter,
%% allowing the author to define a "short title" to be used in page headers.
\title{Demystifying RCE Vulnerabilities in LLM-Integrated Apps}

%%
%% The "author" command and its associated commands are used to define
%% the authors and their affiliations.
%% Of note is the shared affiliation of the first two authors, and the
%% "authornote" and "authornotemark" commands
%% used to denote shared contribution to the research.
\author{Tong Liu}
% \orcid{0009-0004-5804-6551}
% \affiliation{%
%     \institution{Chinese Academy of Sciences}
%     \department{Institute of Information Engineering}
%     }
% \affiliation{%
%     \institution{University of Chinese Academy of Sciences}
%     \department{School of Cyber Security}
%     \city{Beijing} 
%     \country{China}}
\affiliation{%
    \institution{IIE, CAS$^{\dag}$}
    \institution{School of Cyber Security, UCAS$^{\ddag}$}
    \city{Beijing} 
    \country{China}}
\email{liutong@iie.ac.cn}

\author{Zizhuang Deng}
%\orcid{xxxx}
\affiliation{%
    \institution{School of Cyber Science and Technology, Shandong University}
    \city{Qingdao}
    \country{China}}
\email{dengzz@sdu.edu.cn}

\author{Guozhu Meng$^*$}
% \orcid{xxx}
\affiliation{%
    \institution{IIE, CAS$^{\dag}$}
    \institution{School of Cyber Security, UCAS$^{\ddag}$}
    \city{Beijing} 
    \country{China}}
\email{mengguozhu@iie.ac.cn}

\author{Yuekang Li}
% \orcid{xxx}
\affiliation{%
    \institution{University of New South Wales}
    \city{Sydney} 
    \country{Australia}}
\email{yuekang.li@unsw.edu.au}

\author{Kai Chen}
% \orcid{xxx}
\affiliation{%
    \institution{IIE, CAS$^{\dag}$}
    \institution{School of Cyber Security, UCAS$^{\ddag}$}
    \city{Beijing} 
    \country{China}}
\email{chenkai@iie.ac.cn}

\thanks{$*$ Corresponding authors}
\thanks{${\dag}$ Institute of Information Engineering,  Chinese Academy of Sciences}
\thanks{${\ddag}$ University of Chinese Academy of Sciences}

%%
%% By default, the full list of authors will be used in the page
%% headers. Often, this list is too long, and will overlap
%% other information printed in the page headers. This command allows
%% the author to define a more concise list
%% of authors' names for this purpose.

%%
%% The abstract is a short summary of the work to be presented in the
%% article.
%-------------------------------------------------------------------------------
\begin{abstract}
%-------------------------------------------------------------------------------

Large Language Models (LLMs) show promise in transforming software development, with a growing interest in integrating them into more intelligent apps. Frameworks like LangChain aid LLM-integrated app development, offering code execution utility/APIs for custom actions. However, these capabilities theoretically introduce Remote Code Execution (RCE) vulnerabilities, enabling remote code execution through prompt injections. No prior research systematically investigates these frameworks' RCE vulnerabilities or their impact on applications and exploitation consequences. Therefore, there is a huge research gap in this field.



In this study, we propose \tool to detect, validate and exploit the RCE vulnerabilities in LLM-integrated frameworks and apps. To achieve this goal, we develop two novel techniques, including 1) a lightweight static analysis to construct call chains to identify RCE vulnerabilities in frameworks; 2) a systematical prompt-based exploitation method to verify and exploit the found vulnerabilities in LLM-integrated apps. This technique involves various strategies to control LLM outputs, trigger RCE vulnerabilities and launch subsequent attacks. Our research has uncovered a total of 20 vulnerabilities in 11 LLM-integrated frameworks, comprising 19 RCE vulnerabilities and 1 arbitrary file read/write vulnerability. Of these, 17 have been confirmed by the framework developers, with 13 vulnerabilities being assigned CVE IDs, 6 of which have a CVSS score of 9.8, and we were also awarded a bug bounty of \$1350. For the 51 apps potentially affected by RCE, we successfully executed attacks on 17 apps, 16 of which are vulnerable to RCE and 1 to SQL injection. Furthermore, we conduct a comprehensive analysis of these vulnerabilities and construct practical attacks to demonstrate the hazards in reality, \eg, app output hijacking, user data leakage, even the potential to take full control of systems. Last, we propose several mitigation measures for both framework and app developers to counteract such attacks. 
\end{abstract}

%%
%% The code below is generated by the tool at http://dl.acm.org/ccs.cfm.
%% Please copy and paste the code instead of the example below.
%%

\begin{CCSXML}
<ccs2012>
   <concept>
       <concept_id>10002978.10003022</concept_id>
       <concept_desc>Security and privacy~Software and application security</concept_desc>
       <concept_significance>500</concept_significance>
       </concept>
 </ccs2012>
\end{CCSXML}

\ccsdesc[500]{Security and privacy~Software and application security}

\keywords{Large Language Model, LLM-integrated Applications, RCE}

%%
%% This command processes the author and affiliation and title
%% information and builds the first part of the formatted document.
\maketitle

%----------------------------------INTRO-------------------------------------------
\input{intro}
%----------------------------------------------------------------------------------

%-----------------------------------BG---------------------------------------------
\input{background}
%----------------------------------------------------------------------------------

%-----------------------------------METHOD-----------------------------------------
\input{method}
%----------------------------------------------------------------------------------

%-----------------------------------EVAL-------------------------------------------
\input{eval}
%----------------------------------------------------------------------------------

\input{measurement}

\input{related}

\input{discuss}

\section{Conclusion}
We propose an efficient approach \tool{} to detect and validate RCE vulnerabilities in LLM-integrated frameworks and apps. 
\tool proceeds in three steps, where it first employs static analysis to detect RCE vulnerabilities existing in frameworks, then collects public LLM-integrated apps via white-box and black-box methods, and last launches a novel prompt attack to achieve RCE in these apps. 
\tool{} successfully identifies 20 vulnerabilities across 11 frameworks, obtaining 13 CVEs. 
In the context of automated app testing, \tool{} detects 17 vulnerable apps, with 16 instances achieving RCE. We provide detailed measurements for the mentioned vulnerabilities. 
Moreover, we perform a detailed hazard analysis of RCE vulnerabilities from the perspective of app hosts and benign app users. 
By exploiting these RCE vulnerabilities, we further develop new practical attacks that endanger both app hosts and benign app users. Additionally, we introduce practical mitigations for these RCE attacks.

\section*{acknowledgements}
We thank all the anonymous reviewers for their constructive feedback. The IIE authors are supported in part by NSFC (92270204), CAS Project for Young Scientists in Basic Research (Grant No. YSBR-118), Youth Innovation Promotion Association CAS and Beijing Nova Program.
% \newpage


\bibliographystyle{ACM-Reference-Format}
\bibliography{ref}

\input{appendix}
\end{document}
\endinput
%%
%% End of file `sample-sigconf.tex'.
