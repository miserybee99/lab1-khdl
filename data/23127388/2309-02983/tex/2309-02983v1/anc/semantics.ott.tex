% generated by Ott 0.32 from: semantics.ott
\newcommand{\ottdrule}[4][]{{\displaystyle\frac{\begin{array}{l}#2\end{array}}{#3}\quad\ottdrulename{#4}}}
\newcommand{\ottusedrule}[1]{\[#1\]}
\newcommand{\ottpremise}[1]{ #1 \\}
\newenvironment{ottdefnblock}[3][]{ \framebox{\mbox{#2}} \quad #3 \\[0pt]}{}
\newenvironment{ottfundefnblock}[3][]{ \framebox{\mbox{#2}} \quad #3 \\[0pt]\begin{displaymath}\begin{array}{l}}{\end{array}\end{displaymath}}
\newcommand{\ottfunclause}[2]{ #1 \equiv #2 \\}
\newcommand{\ottnt}[1]{\mathit{#1}}
\newcommand{\ottmv}[1]{\mathit{#1}}
\newcommand{\ottkw}[1]{\mathbf{#1}}
\newcommand{\ottsym}[1]{#1}
\newcommand{\ottcom}[1]{\text{#1}}
\newcommand{\ottdrulename}[1]{\textsc{#1}}
\newcommand{\ottcomplu}[5]{\overline{#1}^{\,#2\in #3 #4 #5}}
\newcommand{\ottcompu}[3]{\overline{#1}^{\,#2<#3}}
\newcommand{\ottcomp}[2]{\overline{#1}^{\,#2}}
\newcommand{\ottgrammartabular}[1]{\begin{supertabular}{llcllllll}#1\end{supertabular}}
\newcommand{\ottmetavartabular}[1]{\begin{supertabular}{ll}#1\end{supertabular}}
\newcommand{\ottrulehead}[3]{$#1$ & & $#2$ & & & \multicolumn{2}{l}{#3}}
\newcommand{\ottprodline}[6]{& & $#1$ & $#2$ & $#3 #4$ & $#5$ & $#6$}
\newcommand{\ottfirstprodline}[6]{\ottprodline{#1}{#2}{#3}{#4}{#5}{#6}}
\newcommand{\ottlongprodline}[2]{& & $#1$ & \multicolumn{4}{l}{$#2$}}
\newcommand{\ottfirstlongprodline}[2]{\ottlongprodline{#1}{#2}}
\newcommand{\ottbindspecprodline}[6]{\ottprodline{#1}{#2}{#3}{#4}{#5}{#6}}
\newcommand{\ottprodnewline}{\\}
\newcommand{\ottinterrule}{\\[5.0mm]}
\newcommand{\ottafterlastrule}{\\}
\usepackage{latexsym}
%\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{stmaryrd}
\providecommand{\kw}[1]{\texttt{\textbf{#1}%
}%
}
\providecommand{\startblock}{\texttt{\symbol{123}%
}%
}
\providecommand{\finishblock}{\texttt{\symbol{125}%
}%
}
\renewcommand{\bfdefault}{b}
\renewcommand{\mathbf}{\textbf}
\providecommand{\LocFormat}[1]{\mathtt{#1}%
}%
\providecommand{\EffectFormat}[1]{\mathbf{#1}%
}%
\providecommand{\ottlinebreakhack}{}
%% defining the tex representation in ott allows us to also use the
%% macros in the paper:

\newcommand{\ottmetavars}{
\ottmetavartabular{
 $ \ottmv{x} ,\, \ottmv{y} ,\, \ottmv{z} ,\, \ottmv{w} ,\, \texttt{self} $ & \ottcom{Variable and Field Names} \\
 $ \ottmv{C} $ & \ottcom{Class name} \\
 $ \ottmv{fnc} $ & \ottcom{Function name} \\
 $ \iota $ & \ottcom{Object ID} \\
 $ \ottmv{r} $ & \ottcom{Region ID} \\
 $ \ottmv{i} ,\, \ottmv{m} ,\, \ottmv{n} $ &  \\
}}

\newcommand{\ottR}{
\ottrulehead{\ottnt{R}}{::=}{\ottcom{Region}}\ottprodnewline
\ottfirstprodline{|}{\ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{)}}{}{}{}{}}

\newcommand{\ottRF}{
\ottrulehead{\ottnt{RF}}{::=}{\ottcom{Region frame}}\ottprodnewline
\ottfirstprodline{|}{\ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F}  \ottsym{)}}{}{}{}{}}

\newcommand{\ottRS}{
\ottrulehead{\ottnt{RS}}{::=}{\ottcom{Region frame}}\ottprodnewline
\ottfirstprodline{|}{ \ottnt{RF}  \mathop{::}  \ottnt{RS} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \varepsilon_{RS} }{}{}{}{}}

\newcommand{\ottrho}{
\ottrulehead{\rho}{::=}{\ottcom{region order}}\ottprodnewline
\ottfirstprodline{|}{ \ottmv{r}  \rhosep{ \ottmv{x} . \ottnt{f} }  \rho }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \varepsilon }{}{}{}{}}

\newcommand{\ottH}{
\ottrulehead{H  ,\ H_{\mathit{op} }  ,\ H_{\mathit{cl} }  ,\ H_{\mathit{fr} }}{::=}{\ottcom{Collection of tagged heaps}}\ottprodnewline
\ottfirstprodline{|}{\ottnt{R}}{}{}{}{}\ottprodnewline
\ottprodline{|}{H_{{\mathrm{1}}}  \ottsym{*}  H_{{\mathrm{2}}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \textsf{reachable\_regions} (  \ottnt{R} ,  H  ) }{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{(}  H  \ottsym{)}}{}{}{}{}}

\newcommand{\ottS}{
\ottrulehead{\ottnt{S}}{::=}{\ottcom{Store}}\ottprodnewline
\ottfirstprodline{|}{\ottnt{S}  \ottsym{,}  \iota  \mapsto  \ottnt{o}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \varepsilon_{S} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \varepsilon_{S} }{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{[}  \iota_{{\mathrm{1}}}  \mapsto  \ottnt{o_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \iota_{\ottmv{n}}  \mapsto  \ottnt{o_{\ottmv{n}}}  \ottsym{]}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{[}  \ottsym{]}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{S}  \ottsym{[}  \iota  \mapsto  \ottnt{o}  \ottsym{]}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{R}  \ottsym{.}  \ottnt{S}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{[}  \ottnt{S}  \ottsym{]}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{S}  \uplus  \ottnt{S'}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \ottnt{S} _{\mathit{op} } }{}{}{}{}}

\newcommand{\ottF}{
\ottrulehead{\ottnt{F}  ,\ \overline{f}}{::=}{\ottcom{Field mappings}}\ottprodnewline
\ottfirstprodline{|}{\ottnt{F}  \ottsym{,}  \ottnt{f}  \mapsto  \ottnt{v}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{F}  \ottsym{,}  \ottmv{x}  \mapsto  \ottnt{v}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{F}  \ottsym{,}  \ottmv{x}  \mapsto \, \mathbf{undef}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \varepsilon_{F} }{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{[}  \ottnt{f_{{\mathrm{1}}}}  \mapsto  \ottnt{v_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottnt{f_{\ottmv{n}}}  \mapsto  \ottnt{v_{\ottmv{n}}}  \ottsym{]}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{F}  \ottsym{[}  \ottmv{x}  \mapsto  \ottnt{v}  \ottsym{]}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ F_{i +  1} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ F_{n +  1} }{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{F}  +  \ottnt{F'}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ [  \ottmv{x}  \mapsto  \ottnt{v}  ~|~  \ottmv{i}  \in [ 1,  \ottmv{n}  ] ] }{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{(}  \ottnt{F}  \ottsym{)}} {\textsf{M}}{}{}{}}

\newcommand{\ottf}{
\ottrulehead{\ottnt{f}  ,\ \ottnt{g}}{::=}{\ottcom{field names}}\ottprodnewline
\ottfirstprodline{|}{ \texttt{val} }{}{}{}{}}

\newcommand{\otto}{
\ottrulehead{\ottnt{o}}{::=}{\ottcom{Objects}}\ottprodnewline
\ottfirstprodline{|}{\ottsym{(}  \#CL  \ottsym{,}  \ottnt{F}  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{(} \, \ottkw{\_} \, \ottsym{,}  \ottnt{F}  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{(}  \ottsym{\#}  \ottmv{C}  \ottsym{,} \, \ottkw{\_} \, \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{o}  \ottsym{[}  \ottnt{f}  \mapsto  \ottnt{v}  \ottsym{]}}{}{}{}{}}

\newcommand{\ottv}{
\ottrulehead{\ottnt{v}}{::=}{\ottcom{Values}}\ottprodnewline
\ottfirstprodline{|}{\ottsym{(}  \ottnt{k}  \ottsym{,}  \iota  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{(} \, \ottkw{\_} \, \ottsym{,}  \iota  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{(}  \ottnt{k}  \ottsym{,} \, \ottkw{\_} \, \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \ottnt{k}  \mathop{\odot}  \ottnt{v} }{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{(}  \ottnt{v}  \ottsym{)}} {\textsf{M}}{}{}{}\ottprodnewline
\ottprodline{|}{ \ensuremath{\begin{cases}  \ottnt{v}  & \text{if }  \ottnt{proposition}  \\  \ottnt{v'}  & \text{otherwise} \end{cases} } }{}{}{}{}}

\newcommand{\ottrcfg}{
\ottrulehead{\ottnt{rcfg}}{::=}{\ottcom{Region config}}\ottprodnewline
\ottfirstprodline{|}{\langle  \ottnt{RS}  \ottsym{;}  H_{{\mathrm{1}}}  \ottsym{;}  H_{{\mathrm{2}}}  \ottsym{;}  H_{{\mathrm{3}}}  \rangle}{}{}{}{}}

\newcommand{\ottccfg}{
\ottrulehead{\ottnt{ccfg}}{::=}{\ottcom{Command config}}\ottprodnewline
\ottfirstprodline{|}{\,\startblock\,  \ottnt{de}  \,\finishblock\,}{}{}{}{}}

\newcommand{\ottcfg}{
\ottrulehead{\ottnt{cfg}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\langle  \ottnt{ccfg} \, \ottnt{rcfg}  \rangle}{}{}{}{}}

\newcommand{\ottEff}{
\ottrulehead{\ottnt{Eff}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\mathit{enter} \, \ottsym{(}  \ottmv{w}  \ottsym{,}  \ottnt{k}  \ottsym{,}  \ottmv{y}  \ottsym{.}  \ottnt{f}  \ottsym{,}  \overline{bind}  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \textit{badenter}( \ottmv{y} . \ottnt{f} ) }{}{}{}{}\ottprodnewline
\ottprodline{|}{\mathit{exit} \, \ottsym{(}  \ottmv{x}  \ottsym{,}  \ottnt{use}  \ottsym{,}  \ottmv{y}  \ottsym{.}  \ottnt{f}  \ottsym{,}  \ottmv{w}  \ottsym{.}  \ottnt{f'}  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\mathit{load} \, \ottsym{(}  \ottmv{x}  \ottsym{,}  \ottmv{y}  \ottsym{.}  \ottnt{f}  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\mathit{swap} \, \ottsym{(}  \ottmv{x}  \ottsym{,}  \ottmv{y}  \ottsym{.}  \ottnt{f}  \ottsym{,}  \ottnt{use}  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \textit{halloc} (  \ottmv{x} ,  \ottnt{k} , \# \ottmv{C} ,  \overline{use}  ) }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \textit{salloc} (  \ottmv{x} ,  \ottnt{k} ,  \#CL ,  \overline{use}  ) }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \textit{freeze} (  \ottmv{x}  ,  \ottnt{use}  ) }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \textit{merge} (  \ottmv{x} ,  \ottnt{use}  ) }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \textit{cast} (  \ottmv{x} ,  \ottnt{use} ,  \ottnt{k} ~ \ottnt{CL}  ) }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \textit{nocast} (  \ottmv{x} ,  \ottnt{use} ,  \ottnt{k} ~ \ottnt{CL}  ) }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \textit{bind} (  \overline{bind}  ) }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \epsilon }{}{}{}{}}

\newcommand{\ottk}{
\ottrulehead{\ottnt{k}}{::=}{\ottcom{Capabilities}}\ottprodnewline
\ottfirstprodline{|}{ \textsf{iso} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \textsf{var} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \textsf{mut} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \textsf{imm} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \textsf{tmp} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \textsf{paused} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \ottnt{k}  \mathop{\odot}  \ottnt{k'} }{}{}{}{}}

\newcommand{\ottks}{
\ottrulehead{\ottnt{ks}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\ottnt{k_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottnt{k_{\ottmv{n}}}}{}{}{}{}}

\newcommand{\otte}{
\ottrulehead{\ottnt{e}}{::=}{\ottcom{Expressions}}\ottprodnewline
\ottfirstprodline{|}{\ottnt{use}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\kw{let}\, \, \ottmv{x}  \ottsym{=}  \ottnt{b} \, \kw{in}\, \, \ottnt{e}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{e}  \ottsym{[}  \overline{x}  \mapsto  \overline{x}'  \ottsym{]}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{e}  \ottsym{[}  \ottnt{alphas}  \ottsym{]}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\kw{if}\, \, \kw{typetest}\, \, \ottsym{(}  \ottnt{use}  \ottsym{,}  \ottnt{t}  \ottsym{)}  \,\startblock\,  \ottmv{y_{{\mathrm{1}}}}  \mathop{\texttt{=>} }  \ottnt{e_{{\mathrm{1}}}}  \,\finishblock\,  \,\startblock\,  \ottmv{y_{{\mathrm{2}}}}  \mathop{\texttt{=>} }  \ottnt{e_{{\mathrm{2}}}}  \,\finishblock\,}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \ottnt{e} _{ \mathit{body} } }{}{}{}{}}

\newcommand{\ottalphas}{
\ottrulehead{\ottnt{alphas}}{::=}{\ottcom{Alpha conversions}}\ottprodnewline
\ottfirstprodline{|}{\ottmv{x}  \mapsto  \ottmv{x'}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{alphas}  \ottsym{,}  \ottnt{alphas'}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottmv{x_{{\mathrm{1}}}}  \mapsto  \ottmv{x'_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{x_{\ottmv{n}}}  \mapsto  \ottmv{x'_{\ottmv{n}}}}{}{}{}{}}

\newcommand{\ottde}{
\ottrulehead{\ottnt{de}}{::=}{\ottcom{Dynamic expressions}}\ottprodnewline
\ottfirstprodline{|}{\ottnt{e}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{de}  \ottsym{[}  \ottnt{de'}  \ottsym{]}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\kw{let}\, \, \ottmv{x}  \ottsym{=}  \ottnt{db} \, \kw{in}\, \, \ottnt{e}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{Failure}}{}{}{}{}}

\newcommand{\ottdb}{
\ottrulehead{\ottnt{db}}{::=}{\ottcom{Dynamic bound expressions}}\ottprodnewline
\ottfirstprodline{|}{\ottnt{de}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{b}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathbf{entered}~ \ottnt{lval} ~ \ottnt{lval'} ~ \{  \ottnt{de}  \} }{}{}{}{}}

\newcommand{\ottuse}{
\ottrulehead{\ottnt{use}}{::=}{\ottcom{Variable use}}\ottprodnewline
\ottfirstprodline{|}{\ottmv{x}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\kw{drop}\, \, \ottmv{x}}{}{}{}{}}

\newcommand{\ottuses}{
\ottrulehead{\overline{use}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\ottnt{use_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottnt{use_{\ottmv{n}}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{use_{{\mathrm{1}}}} \, ... \, \ottnt{use_{\ottmv{n}}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{eps}}{}{}{}{}}

\newcommand{\ottxs}{
\ottrulehead{\overline{x}  ,\ \overline{y}  ,\ \overline{z}}{::=}{\ottcom{Many variables}}\ottprodnewline
\ottfirstprodline{|}{\ottmv{x_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{x_{\ottmv{n}}}}{}{}{}{}}

\newcommand{\ottbind}{
\ottrulehead{\ottnt{bind}}{::=}{\ottcom{Binding}}\ottprodnewline
\ottfirstprodline{|}{\ottmv{y}  \ottsym{=}  \ottnt{use}}{}{}{}{}}

\newcommand{\ottbinds}{
\ottrulehead{\overline{bind}}{::=}{\ottcom{Many binds}}\ottprodnewline
\ottfirstprodline{|}{\ottmv{z_{{\mathrm{1}}}}  \ottsym{=}  \ottnt{use_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{z_{\ottmv{n}}}  \ottsym{=}  \ottnt{use_{\ottmv{n}}}}{}{}{}{}}

\newcommand{\ottb}{
\ottrulehead{\ottnt{b}}{::=}{\ottcom{Bound expressions}}\ottprodnewline
\ottfirstprodline{|}{\ottsym{*}  \ottnt{lval}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{lval}  \ottsym{:=}  \ottnt{use}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{var} \, \ottnt{use}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottmv{fnc}  \ottsym{(}  \overline{use}  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\kw{new} \, \ottnt{k} \, \ottmv{C}  \ottsym{(}  \overline{use}  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\kw{new} \, \ottnt{k} \, \ottmv{C}  \ottsym{(}  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \kw{enter}~ \ottnt{lval} ~[  \overline{bind}  ]~\{  \ottmv{y} ~\texttt{=>}~ \ottnt{e}  \} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \kw{freeze}~ \ottnt{use} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \kw{merge}~ \ottnt{use} }{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{e}}{}{}{}{}}

\newcommand{\ottlval}{
\ottrulehead{\ottnt{lval}}{::=}{\ottcom{lvalues}}\ottprodnewline
\ottfirstprodline{|}{\ottmv{x}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottmv{x}  \ottsym{.}  \ottnt{f}}{}{}{}{}}

\newcommand{\ottCommandArrow}{
\ottrulehead{\ottnt{CommandArrow}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{ \xrightarrow{  \ottnt{Eff}  } }{}{}{}{}}

\newcommand{\ottRegionArrow}{
\ottrulehead{\ottnt{RegionArrow}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{ \xrightarrow{  \ottnt{Eff}  } }{}{}{}{}}

\newcommand{\ottTandemArrow}{
\ottrulehead{\ottnt{TandemArrow}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\rightarrow}{}{}{}{}}

\newcommand{\ottGamma}{
\ottrulehead{\Gamma}{::=}{\ottcom{Typing environment}}\ottprodnewline
\ottfirstprodline{|}{\Gamma  \ottsym{,}  \ottmv{x}  \ottsym{:}  \ottnt{t}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\Gamma  \ottsym{,}  \ottmv{x}  \ottsym{:} \, \mathbf{undef}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \varepsilon }{}{}{}{}\ottprodnewline
\ottprodline{|}{\Gamma  \ottsym{[}  \ottmv{x_{{\mathrm{1}}}}  \ottsym{:}  \ottnt{t_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{x_{\ottmv{n}}}  \ottsym{:}  \ottnt{t_{\ottmv{n}}}  \ottsym{]}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\Gamma  \ottsym{[}  \ottmv{x}  \ottsym{:} \, \mathbf{undef} \, \ottsym{]}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \Gamma_{i+1} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \Gamma_{n+1} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \Gamma_{{\mathrm{1}}}  \mathop{|}  \Gamma_{{\mathrm{2}}} }{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{(}  \Gamma  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottmv{x_{{\mathrm{1}}}}  \ottsym{:}  \ottnt{t_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{x_{\ottmv{n}}}  \ottsym{:}  \ottnt{t_{\ottmv{n}}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{f_{{\mathrm{1}}}}  \ottsym{:}  \ottnt{t_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottnt{f_{\ottmv{n}}}  \ottsym{:}  \ottnt{t_{\ottmv{n}}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\Gamma  \ottsym{,}  \Gamma'} {\textsf{M}}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{ftypes} \, \ottsym{(}  \ottnt{CL}  \ottsym{)}}{}{}{}{}}

\newcommand{\ottGammas}{
\ottrulehead{\overline{\Gamma}}{::=}{\ottcom{Many typing environments}}\ottprodnewline
\ottfirstprodline{|}{\overline{\Gamma}  \ottsym{::}  \Gamma}{}{}{}{}\ottprodnewline
\ottprodline{|}{\Gamma  \ottsym{::}  \overline{\Gamma}} {\textsf{M}}{}{}{}\ottprodnewline
\ottprodline{|}{ \Gamma  \underset{ \ottmv{x} . \ottnt{f} }{::}  \overline{\Gamma} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \overline{\Gamma}  \underset{ \ottmv{x} . \ottnt{f} }{::}  \Gamma }{}{}{}{}\ottprodnewline
\ottprodline{|}{\overline{\Gamma}  \ottsym{[}  \ottmv{x}  \ottsym{:}  \ottnt{t}  \ottsym{]}} {\textsf{M}}{}{}{}\ottprodnewline
\ottprodline{|}{\overline{\Gamma}  \ottsym{[}  \ottmv{x}  \ottsym{:} \, \mathbf{undef} \, \ottsym{]}} {\textsf{M}}{}{}{}\ottprodnewline
\ottprodline{|}{ \overline{\Gamma}  \mathop{|}  \overline{\Gamma}' } {\textsf{M}}{}{}{}\ottprodnewline
\ottprodline{|}{ \varepsilon_{\overline{\Gamma} } }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \varepsilon }{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{(}  \overline{\Gamma}  \ottsym{)}}{}{}{}{}}

\newcommand{\ottDelta}{
\ottrulehead{\Delta  ,\ \Delta_{RS}  ,\ \Delta_{op}  ,\ \Delta_{cl}  ,\ \Delta_{fr}}{::=}{\ottcom{Heap typing}}\ottprodnewline
\ottfirstprodline{|}{\Delta  \ottsym{,}  \iota  \ottsym{:}  \ottnt{CL}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \varepsilon_{\Delta} }{}{}{}{}\ottprodnewline
\ottprodline{|}{\Delta  \uplus  \Delta'}{}{}{}{}}

\newcommand{\ottPsi}{
\ottrulehead{\Psi  ,\ \Psi_{op}  ,\ \Psi_{cl}  ,\ \Psi_{fr}}{::=}{\ottcom{Region ids}}\ottprodnewline
\ottfirstprodline{|}{\ottmv{r}  \ottsym{,}  \Psi}{}{}{}{}\ottprodnewline
\ottprodline{|}{\Psi  \uplus  \Psi'}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottmv{r}} {\textsf{M}}{}{}{}\ottprodnewline
\ottprodline{|}{ \varepsilon_{\Psi} }{}{}{}{}}

\newcommand{\ottCL}{
\ottrulehead{\ottnt{CL}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{ C }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \texttt{Cell} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \texttt{Cell}[  \ottnt{t}  ] }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \top }{}{}{}{}}

\newcommand{\ottCLTag}{
\ottrulehead{\#CL}{::=}{}\ottprodnewline
\ottfirstprodline{|}{ \# \ottmv{C} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \texttt{\#Cell} }{}{}{}{}}

\newcommand{\ottt}{
\ottrulehead{\ottnt{t}  ,\ \ottnt{type}}{::=}{\ottcom{Types}}\ottprodnewline
\ottfirstprodline{|}{ \ottnt{k}  ~  \ottnt{CL} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \ottnt{t_{{\mathrm{1}}}}  \mathop{|}  \ottnt{t_{{\mathrm{2}}}} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathit{make\_temp} (  \ottnt{t}  ) }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathit{make\_mut} (  \ottnt{t}  ) }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathit{make\_iso} (  \ottnt{t}  ) }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathit{make\_imm} (  \ottnt{t}  ) }{}{}{}{}\ottprodnewline
\ottprodline{|}{\bot}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \ottnt{k}  \mathop{\odot}  \ottnt{t} }{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{(}  \ottnt{t}  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \ensuremath{\begin{cases}  \ottnt{t}  & \text{if }  \ottnt{proposition}  \\  \ottnt{t'}  & \text{otherwise} \end{cases} } }{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{\_}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{ftype} \, \ottsym{(}  \ottnt{CL}  \ottsym{,}  \ottnt{f}  \ottsym{)}}{}{}{}{}}

\newcommand{\ottts}{
\ottrulehead{\overline{t}  ,\ \overline{type}}{::=}{\ottcom{Many Types}}\ottprodnewline
\ottfirstprodline{|}{\ottnt{t_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottnt{t_{\ottmv{n}}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{t}  \ottsym{,}  \overline{type}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \varepsilon_{types} }{}{}{}{}}

\newcommand{\ottprec}{
\ottrulehead{\ottnt{prec}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{ \preceq_{ \ottnt{RS} } }{}{}{}{}}

\newcommand{\ottfdecls}{
\ottrulehead{\ottnt{fdecls}}{::=}{}}

\newcommand{\ottmdecls}{
\ottrulehead{\ottnt{mdecls}}{::=}{}}

\newcommand{\ottformula}{
\ottrulehead{\ottnt{formula}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\ottnt{judgement}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{(}  \ottnt{formula}  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\neg \, \ottnt{formula}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottcomp{\ottnt{formula_{\ottmv{i}}}}{\ottmv{i}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{formula_{{\mathrm{1}}}}  \lor  \ottnt{formula_{{\mathrm{2}}}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{formula_{{\mathrm{1}}}}  \land  \ottnt{formula_{{\mathrm{2}}}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{formula_{{\mathrm{1}}}}  \Rightarrow  \ottnt{formula_{{\mathrm{2}}}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{formula_{{\mathrm{1}}}}  \Leftrightarrow  \ottnt{formula_{{\mathrm{2}}}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \forall   \ottnt{quantifier}  . ~  \ottnt{formula'} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \exists   \ottnt{quantifier}  . ~  \ottnt{formula'} }{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{lookup}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{subst}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{proposition}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \ottnt{content}  \in  \ottnt{set} }{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{content} \, \not\in \, \ottnt{set}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \ottnt{formula}  \ottlinebreakhack }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \ottnt{formula}  \ottlinebreakhack }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \ottnt{formula}  \! }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \ottnt{formula}  \!\!\! }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \ottnt{formula}  \!\!\! }{}{}{}{}}

\newcommand{\ottlookup}{
\ottrulehead{\ottnt{lookup}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\Gamma  \ottsym{(}  \ottmv{x}  \ottsym{)}  \ottsym{=}  \ottnt{t}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{G} \, \ottsym{(}  \iota  \ottsym{)}  \ottsym{=}  \ottnt{t}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{G} \, \ottsym{(}  \ottnt{g}  \ottsym{)}  \ottsym{=}  \ottnt{t}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{V} \, \ottsym{(}  \ottmv{x}  \ottsym{)}  \ottsym{=}  \ottnt{v}}{}{}{}{}\ottprodnewline
\ottprodline{|}{H  \ottsym{(}  \iota  \ottsym{)}  \ottsym{=} \, \ottkw{obj}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \ottmv{x}  \in  \mathit{dom} ( \ottkw{G} ) }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \ottmv{x}  \not\in  \mathit{dom} ( \ottkw{G} ) }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \iota  \in  \mathit{dom} ( \ottkw{G} ) }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \iota  \not\in  \mathit{dom} ( \ottkw{G} ) }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \ottnt{set}  ( \ottnt{f} ) =  \ottnt{t} }{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{set}  \ottsym{(}  \ottnt{f}  \ottsym{)}  \ottsym{=}  \ottnt{v}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{set_{{\mathrm{1}}}} \, \ottnt{cmp\_op} \, \ottnt{set_{{\mathrm{2}}}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottmv{x} \, \mathit{fresh}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\overline{x} \, \mathit{fresh}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\iota \, \mathit{fresh}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottmv{r} \, \mathit{fresh}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{distinctLocks(}  \ottnt{e}  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathsf{load}( \ottnt{S} ,  \iota ) =  \ottnt{o} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathsf{cfg\_load}( \ottnt{RS} ,  H ,  \iota ) =  \ottnt{o} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathsf{stack\_load}( \ottnt{RS} ,  \iota ) =  \ottnt{o} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathsf{heap\_load}( H ,  \iota ) =  \ottnt{o} }{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{get} \, \ottsym{(}  \ottnt{F_{{\mathrm{1}}}}  \ottsym{,}  \ottnt{use}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottnt{v}  \ottsym{,}  \ottnt{F_{{\mathrm{2}}}}  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{F}  \ottsym{(}  \ottmv{x}  \ottsym{)}  \ottsym{=}  \ottnt{v}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{fnclookup} \, \ottsym{(}  \ottmv{fnc}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \overline{x}  \ottsym{)}  \rightarrow  \ottnt{e}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{mlookup} \, \ottsym{(}  \ottmv{C}  \ottsym{,}  \ottmv{m}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \texttt{self}  \ottsym{,}  \ottmv{x_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{x_{\ottmv{n}}}  \ottsym{)}  \rightarrow  \ottnt{e''}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{ftype} \, \ottsym{(}  \ottnt{CL}  \ottsym{,}  \ottnt{f}  \ottsym{)}  \ottsym{=}  \ottnt{t}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{mtype} \, \ottsym{(}  \ottmv{C}  \ottsym{,}  \ottmv{m}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \texttt{self}  \ottsym{:}  \ottnt{k}  \ottsym{,}  \ottmv{x_{{\mathrm{1}}}}  \ottsym{:}  \ottnt{t_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{x_{\ottmv{n}}}  \ottsym{:}  \ottnt{t_{\ottmv{n}}}  \ottsym{)}  \rightarrow  \ottnt{t}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{fnctype} \, \ottsym{(}  \ottmv{fnc}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \overline{type}  \ottsym{)}  \rightarrow  \ottnt{t}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathbf{class}~C~\{  \ottnt{fdecls}  \} \in \mathit{prog} }{}{}{}{}}

\newcommand{\ottsubst}{
\ottrulehead{\ottnt{subst}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\ottsym{V'}  \ottsym{=} \, \ottkw{V} \, \ottsym{[}  \ottmv{x}  \mapsto  \ottnt{v}  \ottsym{]}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{V'}  \ottsym{=} \, \ottkw{V} \, \ottsym{[}  \ottmv{x}  \mapsto  \ottnt{v}  \ottsym{]}  \ottsym{[}  \ottmv{y}  \mapsto  \ottnt{v'}  \ottsym{]}}{}{}{}{}\ottprodnewline
\ottprodline{|}{H'  \ottsym{=}  H  \ottsym{[}  \iota  \mapsto \, \ottkw{obj} \, \ottsym{]}}{}{}{}{}\ottprodnewline
\ottprodline{|}{H'  \ottsym{=}  H  \ottsym{[}  \iota  \mapsto  \ottsym{(}  \ottmv{C}  \ottsym{,}  \ottnt{F}  \ottsym{[}  \ottnt{f}  \mapsto  \ottnt{v}  \ottsym{]}  \ottsym{,} \, \ottkw{lockStatus} \, \ottsym{)}  \ottsym{]}}{}{}{}{}\ottprodnewline
\ottprodline{|}{H'  \ottsym{=}  H  \ottsym{[}  \iota  \mapsto  \ottsym{(}  \ottmv{C}  \ottsym{,}  \ottnt{F}  \ottsym{,} \, \ottkw{RL} \, \ottsym{[}  \ottmv{r}  \mapsto \, \ottkw{lockStatus} \, \ottsym{]}  \ottsym{)}  \ottsym{]}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{e'}  \ottsym{=}  \ottnt{e}  \ottsym{[}  \ottmv{x}  \mapsto  \ottmv{x'}  \ottsym{]}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{e'}  \ottsym{=}  \ottnt{e}  \ottsym{[}  \ottmv{x}  \mapsto  \ottmv{x'}  \ottsym{]}  \ottsym{[}  \ottmv{y}  \mapsto  \ottmv{y'}  \ottsym{]}}{}{}{}{}}

\newcommand{\ottmethodXXtype}{
\ottrulehead{\ottnt{method\_type}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\ottmv{x}  \ottsym{:}  \ottnt{t_{{\mathrm{1}}}}  \rightarrow  \ottnt{t_{{\mathrm{2}}}}}{}{}{}{}}

\newcommand{\ottquantifier}{
\ottrulehead{\ottnt{quantifier}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{ \ottnt{content}  \in  \ottnt{set} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \ottnt{content}  \notin  \ottnt{set} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \ottmv{i}  \in [1,  \ottmv{n}  ] }{}{}{}{}\ottprodnewline
\ottprodline{|}{\Delta  \ottsym{,}  \Psi}{}{}{}{}\ottprodnewline
\ottprodline{|}{\Gamma  \ottsym{,}  \ottnt{type}}{}{}{}{}}

\newcommand{\ottset}{
\ottrulehead{\ottnt{set}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\ottsym{(}  \ottnt{set}  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{set_{{\mathrm{1}}}} \, \cup \, \ottnt{set_{{\mathrm{2}}}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{set_{{\mathrm{1}}}}  \uplus  \ottnt{set_{{\mathrm{2}}}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{set_{{\mathrm{1}}}}  \cap  \ottnt{set_{{\mathrm{2}}}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\mathit{dom} \, \ottsym{(}  \Gamma  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\mathit{dom} \, \ottsym{(}  \ottnt{F}  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{vardom} \, \ottsym{(} \, \ottkw{G} \, \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\mathit{dom} \, \ottsym{(} \, \ottkw{V} \, \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{fields} \, \ottsym{(}  \ottnt{t}  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{fields} \, \ottsym{(}  \ottmv{C}  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{f_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottnt{f_{\ottmv{n}}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \{  \ottnt{content}  \} }{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{Ls}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{heldLocks} \, \ottsym{(} \, \ottkw{T} \, \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{locks} \, \ottsym{(}  \ottnt{e}  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathit{fv}( \ottnt{e} ) }{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{F}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \emptyset }{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{set_{{\mathrm{1}}}}  \ottsym{\mbox{$\backslash{}$}}  \ottnt{set_{{\mathrm{2}}}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\mathit{dom} \, \ottsym{(}  \ottnt{S}  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{H}{}{}{}{}\ottprodnewline
\ottprodline{|}{\Delta}{}{}{}{}\ottprodnewline
\ottprodline{|}{\overline{f}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{F}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{fdecls}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \{  \ottnt{ks}  \} }{}{}{}{}\ottprodnewline
\ottprodline{|}{\rho}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{t}}{}{}{}{}}

\newcommand{\ottcontent}{
\ottrulehead{\ottnt{content}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\ottmv{x}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\iota}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{f}  \ottsym{:}  \ottnt{t}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\iota  \ottsym{:}  \ottnt{CL}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{L}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{Md}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{Msig}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{R}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{k}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottmv{r}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{t}}{}{}{}{}}

\newcommand{\ottproposition}{
\ottrulehead{\ottnt{proposition}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\ottnt{e}  \ottsym{=}  \ottnt{e'}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{b}  \ottsym{=}  \ottnt{b'}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{db}  \ottsym{=}  \ottnt{db'}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{RS_{{\mathrm{1}}}}  \ottsym{=}  \ottnt{RS_{{\mathrm{2}}}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{RF_{{\mathrm{1}}}}  \ottsym{=}  \ottnt{RF_{{\mathrm{2}}}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{H  \ottsym{=}  H'}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{R}  \ottsym{=}  \ottnt{R'}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{S}  \ottsym{=}  \ottnt{S'}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{o}  \ottsym{=}  \ottnt{o'}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{v}  \ottsym{=}  \ottnt{v'}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{k}  \ottsym{=}  \ottnt{k'}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\overline{x}  \ottsym{=}  \overline{x}'}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \ottnt{k} \neq \ottnt{k'} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \ottmv{x} \neq \ottmv{y} }{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{t}  \ottsym{=}  \ottnt{t'}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \ottnt{t} \not<: \ottnt{t'} }{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{F}  \ottsym{=}  \ottnt{F'}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{CF} \, \ottsym{=}  \ottsym{CF'}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathsf{stack\_store} (  \ottnt{RS}  ,  \iota  ,  \ottnt{o}  ) =  \ottnt{RS'} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathsf{frame\_store} (  \ottnt{RF}  ,  \iota  ,  \ottnt{o}  ) =  \ottnt{RF'} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathsf{heap\_store} (  H  ,  \iota  ,  \ottnt{o}  ) =  H' }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathsf{store} (  \ottnt{S}  ,  \iota  ,  \ottnt{o}  ) =  \ottnt{S'} }{}{}{}{}\ottprodnewline
\ottprodline{|}{\Gamma_{{\mathrm{1}}}  \ottsym{=}  \Gamma_{{\mathrm{2}}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\Delta  \ottsym{=}  \Delta'}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \textsf{cap}(  \ottnt{k}  ,  \ottnt{t}  ) }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \textsf{cap}( \{ \ottnt{ks} \},  \ottnt{t}  ) }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \textsf{cap}( \{ \ottnt{ks} \}^c,  \ottnt{t}  ) }{}{}{}{}\ottprodnewline
\ottprodline{|}{\mathit{readable} \, \ottsym{(}  \ottnt{k}  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \textsf{open}(  \ottnt{k}  ) }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathbf{effect}(  \ottmv{x} ,  \ottnt{db} ) =  \ottnt{Eff} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathsf{is\_drop} (  \ottnt{use}  ) }{}{}{}{}\ottprodnewline
\ottprodline{|}{\overline{use}  \ottsym{=}  \overline{use}'}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \ottnt{proposition}  \text{~~where~~}  \ottnt{proposition'} }{}{}{}{}\ottprodnewline
\ottprodline{|}{\overline{type}  \ottsym{=}  \overline{type}'}{}{}{}{}\ottprodnewline
\ottprodline{|}{\Psi  \ottsym{=}  \Psi'}{}{}{}{}\ottprodnewline
\ottprodline{|}{\mathsf{capability\_ok} \, \ottsym{(}  \overline{\Gamma}  \ottsym{,}  \ottnt{rcfg}  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\mathsf{topology\_ok} \, \ottsym{(}  \overline{\Gamma}  \ottsym{,}  \ottnt{rcfg}  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\mathsf{entrypoints\_ok} \, \ottsym{(}  \overline{\Gamma}  \ottsym{,}  \ottnt{rcfg}  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{classtype} \, \ottsym{(}  \ottnt{t}  \ottsym{)}}{}{}{}{}}

\newcommand{\ottterminals}{
\ottrulehead{\ottnt{terminals}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{ \kw{class} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \kw{interface} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \kw{implements} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \kw{extends} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \kw{let}\, }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \kw{in}\, }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \kw{if}\, }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \kw{drop}\, }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \kw{typetest}\, }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \kw{Unit} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \kw{def} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \kw{new} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \kw{finish} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \kw{async} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \kw{null} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \kw{lock} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathit{fresh} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \neg }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mapsto }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \rhd }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \hookrightarrow }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \rightarrow }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \leftarrow }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mapsto }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \vdash }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \dashv }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \lor }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \land }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathop{\texttt{=>} } }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \Rightarrow }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \Leftarrow }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \Leftrightarrow }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \not\in }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \forall }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \exists }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \nexists }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \not\forall }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \cup }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \cap }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \uplus }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \langle }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \rangle }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \,\startblock\, }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \,\finishblock\, }{}{}{}{}\ottprodnewline
\ottprodline{|}{ + }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \preceq }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \geq }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \bullet }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \bot }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathbf{undef} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathit{dom} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathit{enter} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathit{exit} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathit{load} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathit{swap} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathit{halloc} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathit{salloc} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathit{ralloc} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathbf{freeze} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathbf{merge} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathbf{cast} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathbf{nocast} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathit{cap} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathit{readable} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \texttt{val} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathsf{capability\_ok} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathsf{topology\_ok} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \mathsf{entrypoints\_ok} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ < }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \leq }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \subtag }{}{}{}{}}

\newcommand{\ottcmpXXop}{
\ottrulehead{\ottnt{cmp\_op}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{ \equiv }{}{}{}{}\ottprodnewline
\ottprodline{|}{ = }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \neq }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \subset }{}{}{}{}}

\newcommand{\ottTandem}{
\ottrulehead{\ottnt{Tandem}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\ottnt{cfg} \, \ottnt{TandemArrow} \, \ottnt{cfg'}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\vdash  \ottnt{cfg}}{}{}{}{}}

\newcommand{\ottRegion}{
\ottrulehead{\ottnt{Region}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\ottnt{rcfg} \, \ottnt{RegionArrow} \, \ottnt{rcfg'}}{}{}{}{}}

\newcommand{\ottCommand}{
\ottrulehead{\ottnt{Command}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\ottnt{de} \, \ottnt{CommandArrow} \, \ottnt{de'}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\Gamma  \vdash  \ottnt{e}  \ottsym{:}  \ottnt{t}  \dashv  \Gamma'}{}{}{}{}\ottprodnewline
\ottprodline{|}{\Gamma  \vdash  \ottnt{b}  \ottsym{:}  \ottnt{t}  \dashv  \Gamma'}{}{}{}{}\ottprodnewline
\ottprodline{|}{\overline{\Gamma}  \vdash  \ottnt{de}  \ottsym{:}  \ottnt{t}  \dashv  \Gamma'}{}{}{}{}\ottprodnewline
\ottprodline{|}{\overline{\Gamma}  \vdash  \ottnt{db}  \ottsym{:}  \ottnt{t}  \dashv  \Gamma'}{}{}{}{}}

\newcommand{\ottTyping}{
\ottrulehead{\ottnt{Typing}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\vdash  \Gamma}{}{}{}{}\ottprodnewline
\ottprodline{|}{\vdash  \overline{\Gamma}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\vdash  \ottnt{k}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\vdash  \ottnt{t}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{t_{{\mathrm{1}}}}  \ottsym{<:}  \ottnt{t_{{\mathrm{2}}}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\#CL  \subtag  \ottnt{CL}}{}{}{}{}}

\newcommand{\ottWellFormedness}{
\ottrulehead{\ottnt{WellFormedness}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\overline{\Gamma}  \vdash  \ottnt{ccfg}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\overline{\Gamma}  \vdash  \ottnt{rcfg}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\overline{\Gamma}  \vdash  \ottnt{de}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\overline{\Gamma}  \ottsym{;}  \Delta  \ottsym{;}  \Psi  \vdash  \ottnt{rcfg}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\overline{\Gamma}  \ottsym{;}  \Delta  \ottsym{;}  \Delta'  \ottsym{;}  \Psi  \vdash  \ottnt{RS}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\vdash  \Delta}{}{}{}{}\ottprodnewline
\ottprodline{|}{\Delta  \ottsym{;}  \Delta'  \ottsym{;}  \Psi  \vdash  H}{}{}{}{}\ottprodnewline
\ottprodline{|}{\Delta  \ottsym{;}  \Delta'  \vdash  \ottnt{S}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\Delta  \ottsym{;}  \Gamma  \vdash  \ottnt{F}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\overline{\Gamma}  \vdash  \ottnt{Eff}  \dashv  \overline{\Gamma}'}{}{}{}{}}

\newcommand{\ottOrder}{
\ottrulehead{\ottnt{Order}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\rho  \vdash  \ottmv{r} \, < \, \ottmv{r'}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\rho  \vdash  \ottmv{r} \, \leq \, \ottmv{r'}}{}{}{}{}}

\newcommand{\ottjudgement}{
\ottrulehead{\ottnt{judgement}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\ottnt{Tandem}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{Region}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{Command}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{Typing}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{WellFormedness}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{Order}}{}{}{}{}}

\newcommand{\ottuserXXsyntax}{
\ottrulehead{\ottnt{user\_syntax}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\ottmv{x}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottmv{C}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottmv{fnc}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\iota}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottmv{r}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottmv{i}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{R}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{RF}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{RS}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\rho}{}{}{}{}\ottprodnewline
\ottprodline{|}{H}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{S}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{F}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{f}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{o}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{v}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{rcfg}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{ccfg}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{cfg}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{Eff}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{k}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{ks}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{e}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{alphas}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{de}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{db}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{use}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\overline{use}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\overline{x}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{bind}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\overline{bind}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{b}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{lval}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{CommandArrow}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{RegionArrow}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{TandemArrow}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\Gamma}{}{}{}{}\ottprodnewline
\ottprodline{|}{\overline{\Gamma}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\Delta}{}{}{}{}\ottprodnewline
\ottprodline{|}{\Psi}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{CL}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\#CL}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{t}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\overline{t}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{prec}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{fdecls}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{mdecls}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{formula}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{lookup}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{subst}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{method\_type}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{quantifier}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{set}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{content}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{proposition}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{terminals}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{cmp\_op}}{}{}{}{}}

\newcommand{\ottgrammar}{\ottgrammartabular{
\ottR\ottinterrule
\ottRF\ottinterrule
\ottRS\ottinterrule
\ottrho\ottinterrule
\ottH\ottinterrule
\ottS\ottinterrule
\ottF\ottinterrule
\ottf\ottinterrule
\otto\ottinterrule
\ottv\ottinterrule
\ottrcfg\ottinterrule
\ottccfg\ottinterrule
\ottcfg\ottinterrule
\ottEff\ottinterrule
\ottk\ottinterrule
\ottks\ottinterrule
\otte\ottinterrule
\ottalphas\ottinterrule
\ottde\ottinterrule
\ottdb\ottinterrule
\ottuse\ottinterrule
\ottuses\ottinterrule
\ottxs\ottinterrule
\ottbind\ottinterrule
\ottbinds\ottinterrule
\ottb\ottinterrule
\ottlval\ottinterrule
\ottCommandArrow\ottinterrule
\ottRegionArrow\ottinterrule
\ottTandemArrow\ottinterrule
\ottGamma\ottinterrule
\ottGammas\ottinterrule
\ottDelta\ottinterrule
\ottPsi\ottinterrule
\ottCL\ottinterrule
\ottCLTag\ottinterrule
\ottt\ottinterrule
\ottts\ottinterrule
\ottprec\ottinterrule
\ottfdecls\ottinterrule
\ottmdecls\ottinterrule
\ottformula\ottinterrule
\ottlookup\ottinterrule
\ottsubst\ottinterrule
\ottmethodXXtype\ottinterrule
\ottquantifier\ottinterrule
\ottset\ottinterrule
\ottcontent\ottinterrule
\ottproposition\ottinterrule
\ottterminals\ottinterrule
\ottcmpXXop\ottinterrule
\ottTandem\ottinterrule
\ottRegion\ottinterrule
\ottCommand\ottinterrule
\ottTyping\ottinterrule
\ottWellFormedness\ottinterrule
\ottOrder\ottinterrule
\ottjudgement\ottinterrule
\ottuserXXsyntax\ottafterlastrule
}}

% defnss
% defns Tandem
%% defn step
\newcommand{\ottdruletandemXXstep}[1]{\ottdrule[#1]{%
\ottpremise{\ottnt{de} \,  \xrightarrow{  \ottnt{Eff}  }  \, \ottnt{de'}}%
\ottpremise{\ottnt{rcfg} \,  \xrightarrow{  \ottnt{Eff}  }  \, \ottnt{rcfg'}}%
}{
\langle  \,\startblock\,  \ottnt{de}  \,\finishblock\, \, \ottnt{rcfg}  \rangle \, \rightarrow \, \langle  \,\startblock\,  \ottnt{de'}  \,\finishblock\, \, \ottnt{rcfg'}  \rangle}{%
{\ottdrulename{tandem\_step}}{}%
}}

\newcommand{\ottdefntandemXXstep}[1]{\begin{ottdefnblock}[#1]{$\ottnt{cfg} \, \ottnt{TandemArrow} \, \ottnt{cfg'}$}{}
\ottusedrule{\ottdruletandemXXstep{}}
\end{ottdefnblock}}

%% defn wf
\newcommand{\ottdruletandemXXwf}[1]{\ottdrule[#1]{%
\ottpremise{\overline{\Gamma}  \vdash  \,\startblock\,  \ottnt{de}  \,\finishblock\,}%
\ottpremise{\overline{\Gamma}  \vdash  \ottnt{rcfg}}%
}{
\vdash  \langle  \,\startblock\,  \ottnt{de}  \,\finishblock\, \, \ottnt{rcfg}  \rangle}{%
{\ottdrulename{tandem\_wf}}{}%
}}

\newcommand{\ottdefntandemXXwf}[1]{\begin{ottdefnblock}[#1]{$\vdash  \ottnt{cfg}$}{}
\ottusedrule{\ottdruletandemXXwf{}}
\end{ottdefnblock}}


\newcommand{\ottdefnsTandem}{
\ottdefntandemXXstep{}\ottdefntandemXXwf{}}

% defns Region
%% defn step
\newcommand{\ottdruleregionXXeps}[1]{\ottdrule[#1]{%
}{
\ottnt{rcfg} \,  \xrightarrow{   \epsilon   }  \, \ottnt{rcfg}}{%
{\ottdrulename{region\_eps}}{}%
}}


\newcommand{\ottdruleregionXXload}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x} \, \mathit{fresh}}%
\ottpremise{ \ottnt{F}  \ottsym{(}  \ottmv{y}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottnt{k}  \ottsym{,}  \iota  \ottsym{)}  \ottlinebreakhack }%
\ottpremise{  \mathsf{cfg\_load}(  \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F}  \ottsym{)}  \mathop{::}  \ottnt{RS}  ,  H_{\mathit{op} }  \ottsym{*}  H_{\mathit{fr} } ,  \iota ) =  \ottnt{o}  \ottsym{[}  \ottnt{f}  \mapsto  \ottnt{v}  \ottsym{]}   \ottlinebreakhack }%
\ottpremise{\ottnt{F'}  \ottsym{=}  \ottnt{F}  \ottsym{,}  \ottmv{x}  \mapsto  \ottsym{(}   \ottnt{k}  \mathop{\odot}  \ottnt{v}   \ottsym{)}}%
}{
\langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F}  \ottsym{)}  \mathop{::}  \ottnt{RS}   \ottsym{;}  H_{\mathit{op} }  \ottsym{;}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle \,  \xrightarrow{  \mathit{load} \, \ottsym{(}  \ottmv{x}  \ottsym{,}  \ottmv{y}  \ottsym{.}  \ottnt{f}  \ottsym{)}  }  \, \langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F'}  \ottsym{)}  \mathop{::}  \ottnt{RS}   \ottsym{;}  H_{\mathit{op} }  \ottsym{;}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle}{%
{\ottdrulename{region\_load}}{}%
}}


\newcommand{\ottdruleregionXXswapXXtemp}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x} \, \mathit{fresh}}%
\ottpremise{\ottkw{get} \, \ottsym{(}  \ottnt{F}  \ottsym{,}  \ottnt{use}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottnt{v}  \ottsym{,}  \ottnt{F'}  \ottsym{)}}%
\ottpremise{\ottnt{F'}  \ottsym{(}  \ottmv{y}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottnt{k}  \ottsym{,}  \iota  \ottsym{)}}%
\ottpremise{  \mathsf{load}( \ottnt{S} ,  \iota ) =  \ottnt{o}  \ottsym{[}  \ottnt{f}  \mapsto  \ottnt{v'}  \ottsym{]}   \ottlinebreakhack }%
\ottpremise{\ottnt{o'}  \ottsym{=}  \ottnt{o}  \ottsym{[}  \ottnt{f}  \mapsto  \ottnt{v}  \ottsym{]}}%
\ottpremise{ \mathsf{store} (  \ottnt{S}  ,  \iota  ,  \ottnt{o'}  ) =  \ottnt{S'} }%
\ottpremise{\ottnt{F''}  \ottsym{=}  \ottnt{F'}  \ottsym{,}  \ottmv{x}  \mapsto  \ottnt{v'}}%
}{
\langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F}  \ottsym{)}  \mathop{::}  \ottnt{RS}   \ottsym{;}  H_{\mathit{op} }  \ottsym{;}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle \,  \xrightarrow{  \mathit{swap} \, \ottsym{(}  \ottmv{x}  \ottsym{,}  \ottmv{y}  \ottsym{.}  \ottnt{f}  \ottsym{,}  \ottnt{use}  \ottsym{)}  }  \, \langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S'}  \ottsym{,}  \ottnt{F''}  \ottsym{)}  \mathop{::}  \ottnt{RS}   \ottsym{;}  H_{\mathit{op} }  \ottsym{;}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle}{%
{\ottdrulename{region\_swap\_temp}}{}%
}}


\newcommand{\ottdruleregionXXswapXXheap}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x} \, \mathit{fresh}}%
\ottpremise{\ottkw{get} \, \ottsym{(}  \ottnt{F}  \ottsym{,}  \ottnt{use}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottnt{v}  \ottsym{,}  \ottnt{F'}  \ottsym{)}}%
\ottpremise{\ottnt{F'}  \ottsym{(}  \ottmv{y}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottnt{k}  \ottsym{,}  \iota  \ottsym{)}}%
\ottpremise{  \mathsf{load}( \ottnt{S'} ,  \iota ) =  \ottnt{o}  \ottsym{[}  \ottnt{f}  \mapsto  \ottnt{v'}  \ottsym{]}   \ottlinebreakhack }%
\ottpremise{\ottnt{o'}  \ottsym{=}  \ottnt{o}  \ottsym{[}  \ottnt{f}  \mapsto  \ottnt{v}  \ottsym{]}}%
\ottpremise{ \mathsf{store} (  \ottnt{S'}  ,  \iota  ,  \ottnt{o'}  ) =  \ottnt{S''} }%
\ottpremise{\ottnt{F''}  \ottsym{=}  \ottnt{F'}  \ottsym{,}  \ottmv{x}  \mapsto  \ottnt{v'}}%
}{
\langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F}  \ottsym{)}  \mathop{::}  \ottnt{RS}   \ottsym{;}  \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S'}  \ottsym{)}  \ottsym{*}  H_{\mathit{op} }  \ottsym{;}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle \,  \xrightarrow{  \mathit{swap} \, \ottsym{(}  \ottmv{x}  \ottsym{,}  \ottmv{y}  \ottsym{.}  \ottnt{f}  \ottsym{,}  \ottnt{use}  \ottsym{)}  }  \, \langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S'}  \ottsym{,}  \ottnt{F''}  \ottsym{)}  \mathop{::}  \ottnt{RS}   \ottsym{;}  \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S''}  \ottsym{)}  \ottsym{*}  H_{\mathit{op} }  \ottsym{;}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle}{%
{\ottdrulename{region\_swap\_heap}}{}%
}}


\newcommand{\ottdruleregionXXallocXXheapXXmut}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x} \, \mathit{fresh}}%
\ottpremise{ \forall    \ottmv{i}  \in [1,  \ottmv{n}  ]   . ~  \ottkw{get} \, \ottsym{(}  \ottnt{F_{\ottmv{i}}}  \ottsym{,}  \ottnt{use_{\ottmv{i}}}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottnt{v_{\ottmv{i}}}  \ottsym{,}   F_{i +  1}   \ottsym{)} }%
\ottpremise{ \ottkw{fields} \, \ottsym{(}  \ottmv{C}  \ottsym{)} \,  =  \, \ottnt{f_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottnt{f_{\ottmv{n}}}  \ottlinebreakhack }%
\ottpremise{\ottnt{o}  \ottsym{=}  \ottsym{(}   \# \ottmv{C}   \ottsym{,}  \ottsym{[}  \ottnt{f_{{\mathrm{1}}}}  \mapsto  \ottnt{v_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottnt{f_{\ottmv{n}}}  \mapsto  \ottnt{v_{\ottmv{n}}}  \ottsym{]}  \ottsym{)}}%
\ottpremise{\iota \, \mathit{fresh}}%
\ottpremise{\ottnt{S''}  \ottsym{=}  \ottnt{S'}  \ottsym{,}  \iota  \mapsto  \ottnt{o}}%
\ottpremise{\ottnt{F'}  \ottsym{=}   F_{n +  1}   \ottsym{,}  \ottmv{x}  \mapsto  \ottsym{(}   \textsf{mut}   \ottsym{,}  \iota  \ottsym{)}}%
}{
\langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F_{{\mathrm{1}}}}  \ottsym{)}  \mathop{::}  \ottnt{RS}   \ottsym{;}  \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S'}  \ottsym{)}  \ottsym{*}  H_{\mathit{op} }  \ottsym{;}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle \,  \xrightarrow{   \textit{halloc} (  \ottmv{x} ,   \textsf{mut}  , \# \ottmv{C} ,  \ottnt{use_{{\mathrm{1}}}} \, ... \, \ottnt{use_{\ottmv{n}}}  )   }  \, \langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F'}  \ottsym{)}  \mathop{::}  \ottnt{RS}   \ottsym{;}  \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S''}  \ottsym{)}  \ottsym{*}  H_{\mathit{op} }  \ottsym{;}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle}{%
{\ottdrulename{region\_alloc\_heap\_mut}}{}%
}}


\newcommand{\ottdruleregionXXallocXXheapXXiso}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x} \, \mathit{fresh}}%
\ottpremise{ \forall    \ottmv{i}  \in [1,  \ottmv{n}  ]   . ~  \ottkw{get} \, \ottsym{(}  \ottnt{F_{\ottmv{i}}}  \ottsym{,}  \ottnt{use_{\ottmv{i}}}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottnt{v_{\ottmv{i}}}  \ottsym{,}   F_{i +  1}   \ottsym{)} }%
\ottpremise{ \ottkw{fields} \, \ottsym{(}  \ottmv{C}  \ottsym{)} \,  =  \, \ottnt{f_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottnt{f_{\ottmv{n}}}  \ottlinebreakhack }%
\ottpremise{\ottnt{o}  \ottsym{=}  \ottsym{(}   \# \ottmv{C}   \ottsym{,}  \ottsym{[}  \ottnt{f_{{\mathrm{1}}}}  \mapsto  \ottnt{v_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottnt{f_{\ottmv{n}}}  \mapsto  \ottnt{v_{\ottmv{n}}}  \ottsym{]}  \ottsym{)}}%
\ottpremise{\iota \, \mathit{fresh}}%
\ottpremise{\ottmv{r'} \, \mathit{fresh}}%
\ottpremise{\ottnt{F'}  \ottsym{=}   F_{n +  1}   \ottsym{,}  \ottmv{x}  \mapsto  \ottsym{(}   \textsf{iso}   \ottsym{,}  \iota  \ottsym{)}}%
}{
\langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F_{{\mathrm{1}}}}  \ottsym{)}  \mathop{::}  \ottnt{RS}   \ottsym{;}  H_{\mathit{op} }  \ottsym{;}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle \,  \xrightarrow{   \textit{halloc} (  \ottmv{x} ,   \textsf{iso}  , \# \ottmv{C} ,  \ottnt{use_{{\mathrm{1}}}} \, ... \, \ottnt{use_{\ottmv{n}}}  )   }  \, \langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F'}  \ottsym{)}  \mathop{::}  \ottnt{RS}   \ottsym{;}  H_{\mathit{op} }  \ottsym{;}  \ottsym{(}  \ottmv{r'}  \ottsym{,}  \ottsym{[}  \iota  \mapsto  \ottnt{o}  \ottsym{]}  \ottsym{)}  \ottsym{*}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle}{%
{\ottdrulename{region\_alloc\_heap\_iso}}{}%
}}


\newcommand{\ottdruleregionXXallocXXtemp}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x} \, \mathit{fresh}}%
\ottpremise{ \ottnt{k}  \in   \{   \textsf{tmp}   \ottsym{,}   \textsf{var}   \}  }%
\ottpremise{ \forall    \ottmv{i}  \in [1,  \ottmv{n}  ]   . ~  \ottkw{get} \, \ottsym{(}  \ottnt{F_{\ottmv{i}}}  \ottsym{,}  \ottnt{use_{\ottmv{i}}}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottnt{v_{\ottmv{i}}}  \ottsym{,}   F_{i +  1}   \ottsym{)} }%
\ottpremise{ \ottkw{fields} \, \ottsym{(}  \ottmv{C}  \ottsym{)} \,  =  \, \ottnt{f_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottnt{f_{\ottmv{n}}}  \ottlinebreakhack }%
\ottpremise{\ottnt{o}  \ottsym{=}  \ottsym{(}  \#CL  \ottsym{,}  \ottsym{[}  \ottnt{f_{{\mathrm{1}}}}  \mapsto  \ottnt{v_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottnt{f_{\ottmv{n}}}  \mapsto  \ottnt{v_{\ottmv{n}}}  \ottsym{]}  \ottsym{)}}%
\ottpremise{\iota \, \mathit{fresh}}%
\ottpremise{\ottnt{S'}  \ottsym{=}  \ottnt{S}  \ottsym{[}  \iota  \mapsto  \ottnt{o}  \ottsym{]}}%
\ottpremise{\ottnt{F'}  \ottsym{=}   F_{n +  1}   \ottsym{,}  \ottmv{x}  \mapsto  \ottsym{(}  \ottnt{k}  \ottsym{,}  \iota  \ottsym{)}}%
}{
\langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F_{{\mathrm{1}}}}  \ottsym{)}  \mathop{::}  \ottnt{RS}   \ottsym{;}  H_{\mathit{op} }  \ottsym{;}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle \,  \xrightarrow{   \textit{salloc} (  \ottmv{x} ,  \ottnt{k} ,  \#CL ,  \ottnt{use_{{\mathrm{1}}}} \, ... \, \ottnt{use_{\ottmv{n}}}  )   }  \, \langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S'}  \ottsym{,}  \ottnt{F'}  \ottsym{)}  \mathop{::}  \ottnt{RS}   \ottsym{;}  H_{\mathit{op} }  \ottsym{;}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle}{%
{\ottdrulename{region\_alloc\_temp}}{}%
}}


\newcommand{\ottdruleregionXXfreeze}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x} \, \mathit{fresh}}%
\ottpremise{\ottkw{get} \, \ottsym{(}  \ottnt{F}  \ottsym{,}  \ottnt{use}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottsym{(}  \ottnt{k}  \ottsym{,}  \iota  \ottsym{)}  \ottsym{,}  \ottnt{F'}  \ottsym{)}}%
\ottpremise{  \iota  \in  \mathit{dom} \, \ottsym{(}  \ottnt{R}  \ottsym{.}  \ottnt{S}  \ottsym{)}   \ottlinebreakhack }%
\ottpremise{H  \ottsym{=}   \textsf{reachable\_regions} (  \ottnt{R} ,  \ottsym{(}  H  \ottsym{*}  H_{\mathit{cl} }  \ottsym{)}  \ottsym{*}  H_{\mathit{op} }  ) }%
\ottpremise{\ottnt{F''}  \ottsym{=}  \ottnt{F'}  \ottsym{,}  \ottmv{x}  \mapsto  \ottsym{(}   \textsf{imm}   \ottsym{,}  \iota  \ottsym{)}}%
}{
\langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F}  \ottsym{)}  \mathop{::}  \ottnt{RS}   \ottsym{;}  H_{\mathit{op} }  \ottsym{;}  \ottnt{R}  \ottsym{*}  \ottsym{(}  H  \ottsym{*}  H_{\mathit{cl} }  \ottsym{)}  \ottsym{;}  H_{\mathit{fr} }  \rangle \,  \xrightarrow{   \textit{freeze} (  \ottmv{x}  ,  \ottnt{use}  )   }  \, \langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F''}  \ottsym{)}  \mathop{::}  \ottnt{RS}   \ottsym{;}  H_{\mathit{op} }  \ottsym{;}  H_{\mathit{cl} }  \ottsym{;}  \ottsym{(}  \ottnt{R}  \ottsym{*}  H  \ottsym{)}  \ottsym{*}  H_{\mathit{fr} }  \rangle}{%
{\ottdrulename{region\_freeze}}{}%
}}


\newcommand{\ottdruleregionXXmerge}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x} \, \mathit{fresh}}%
\ottpremise{\ottkw{get} \, \ottsym{(}  \ottnt{F}  \ottsym{,}  \ottnt{use}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottsym{(}  \ottnt{k}  \ottsym{,}  \iota  \ottsym{)}  \ottsym{,}  \ottnt{F'}  \ottsym{)}}%
\ottpremise{  \iota  \in  \mathit{dom} \, \ottsym{(}  \ottnt{R}  \ottsym{.}  \ottnt{S}  \ottsym{)}   \ottlinebreakhack }%
\ottpremise{\ottnt{R'}  \ottsym{=}  \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S'}  \uplus  \ottnt{R}  \ottsym{.}  \ottnt{S}  \ottsym{)}}%
\ottpremise{\ottnt{F''}  \ottsym{=}  \ottnt{F'}  \ottsym{,}  \ottmv{x}  \mapsto  \ottsym{(}   \textsf{mut}   \ottsym{,}  \iota  \ottsym{)}}%
}{
\langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F}  \ottsym{)}  \mathop{::}  \ottnt{RS}   \ottsym{;}  \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S'}  \ottsym{)}  \ottsym{*}  H_{\mathit{op} }  \ottsym{;}  \ottnt{R}  \ottsym{*}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle \,  \xrightarrow{   \textit{merge} (  \ottmv{x} ,  \ottnt{use}  )   }  \, \langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F''}  \ottsym{)}  \mathop{::}  \ottnt{RS}   \ottsym{;}  \ottnt{R'}  \ottsym{*}  H_{\mathit{op} }  \ottsym{;}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle}{%
{\ottdrulename{region\_merge}}{}%
}}


\newcommand{\ottdruleregionXXcast}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x} \, \mathit{fresh}}%
\ottpremise{ \ottkw{get} \, \ottsym{(}  \ottnt{F}  \ottsym{,}  \ottnt{use}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottsym{(}  \ottnt{k}  \ottsym{,}  \iota  \ottsym{)}  \ottsym{,}  \ottnt{F'}  \ottsym{)}  \ottlinebreakhack }%
\ottpremise{  \mathsf{cfg\_load}(  \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F'}  \ottsym{)}  \mathop{::}  \ottnt{RS}  ,  H_{\mathit{op} }  \ottsym{*}  H_{\mathit{cl} }  \ottsym{*}  H_{\mathit{fr} } ,  \iota ) =  \ottsym{(}  \ottsym{\#}  \ottmv{C}  \ottsym{,} \, \ottkw{\_} \, \ottsym{)}   \ottlinebreakhack }%
\ottpremise{\ottnt{F''}  \ottsym{=}  \ottnt{F'}  \ottsym{,}  \ottmv{x}  \mapsto  \ottsym{(}  \ottnt{k}  \ottsym{,}  \iota  \ottsym{)}}%
}{
\langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F}  \ottsym{)}  \mathop{::}  \ottnt{RS}   \ottsym{;}  H_{\mathit{op} }  \ottsym{;}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle \,  \xrightarrow{   \textit{cast} (  \ottmv{x} ,  \ottnt{use} ,  \ottnt{k} ~  C   )   }  \, \langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F''}  \ottsym{)}  \mathop{::}  \ottnt{RS}   \ottsym{;}  H_{\mathit{op} }  \ottsym{;}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle}{%
{\ottdrulename{region\_cast}}{}%
}}


\newcommand{\ottdruleregionXXnocast}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x} \, \mathit{fresh}}%
\ottpremise{ \ottkw{get} \, \ottsym{(}  \ottnt{F}  \ottsym{,}  \ottnt{use}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottsym{(}  \ottnt{k}  \ottsym{,}  \iota  \ottsym{)}  \ottsym{,}  \ottnt{F'}  \ottsym{)}  \ottlinebreakhack }%
\ottpremise{  \mathsf{cfg\_load}(  \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F'}  \ottsym{)}  \mathop{::}  \ottnt{RS}  ,  H_{\mathit{op} }  \ottsym{*}  H_{\mathit{cl} }  \ottsym{*}  H_{\mathit{fr} } ,  \iota ) =  \ottsym{(}  \ottsym{\#}  \ottmv{C}  \ottsym{,} \, \ottkw{\_} \, \ottsym{)}   \ottlinebreakhack }%
\ottpremise{\ottnt{F''}  \ottsym{=}  \ottnt{F'}  \ottsym{,}  \ottmv{x}  \mapsto  \ottsym{(}  \ottnt{k}  \ottsym{,}  \iota  \ottsym{)}}%
}{
\langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F}  \ottsym{)}  \mathop{::}  \ottnt{RS}   \ottsym{;}  H_{\mathit{op} }  \ottsym{;}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle \,  \xrightarrow{   \textit{nocast} (  \ottmv{x} ,  \ottnt{use} ,  \ottnt{k} ~  C   )   }  \, \langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F''}  \ottsym{)}  \mathop{::}  \ottnt{RS}   \ottsym{;}  H_{\mathit{op} }  \ottsym{;}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle}{%
{\ottdrulename{region\_nocast}}{}%
}}


\newcommand{\ottdruleregionXXenterXXok}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{w} \, \mathit{fresh}}%
\ottpremise{ \forall    \ottmv{i}  \in [1,  \ottmv{n}  ]   . ~  \ottmv{z_{\ottmv{i}}} \, \mathit{fresh} }%
\ottpremise{  \forall    \ottmv{i}  \in [1,  \ottmv{n}  ]   . ~  \ottkw{get} \, \ottsym{(}  \ottnt{F_{\ottmv{i}}}  \ottsym{,}  \ottnt{use_{\ottmv{i}}}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottsym{(}  \ottnt{k_{\ottmv{i}}}  \ottsym{,}  \iota_{\ottmv{i}}  \ottsym{)}  \ottsym{,}   F_{i +  1}   \ottsym{)}   \ottlinebreakhack }%
\ottpremise{  \forall    \ottmv{i}  \in [1,  \ottmv{n}  ]   . ~  \ottnt{v'_{\ottmv{i}}}  \ottsym{=}   \ensuremath{\begin{cases}  \ottsym{(}  \ottnt{k_{\ottmv{i}}}  \ottsym{,}  \iota_{\ottmv{i}}  \ottsym{)}  & \text{if }  \ottnt{k_{\ottmv{i}}}  \ottsym{=}   \textsf{iso}   \\  \ottsym{(}    \textsf{paused}   \mathop{\odot}  \ottnt{k_{\ottmv{i}}}   \ottsym{,}  \iota_{\ottmv{i}}  \ottsym{)}  & \text{otherwise} \end{cases} }    \ottlinebreakhack }%
\ottpremise{\ottnt{F}  \ottsym{=}   [  \ottmv{z_{\ottmv{i}}}  \mapsto  \ottnt{v'_{\ottmv{i}}}  ~|~  \ottmv{i}  \in [ 1,  \ottmv{n}  ] ] }%
\ottpremise{ F_{n +  1}   \ottsym{(}  \ottmv{y}  \ottsym{)}  \ottsym{=}  \ottsym{(} \, \ottkw{\_} \, \ottsym{,}  \iota  \ottsym{)}}%
\ottpremise{  \mathsf{cfg\_load}(  \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F_{{\mathrm{1}}}}  \ottsym{)}  \mathop{::}  \ottnt{RS}  ,  H_{\mathit{op} } ,  \iota ) =  \ottnt{o}  \ottsym{[}  \ottnt{f}  \mapsto  \ottsym{(} \, \ottkw{\_} \, \ottsym{,}  \iota'  \ottsym{)}  \ottsym{]}   \ottlinebreakhack }%
\ottpremise{ \iota'  \in  \mathit{dom} \, \ottsym{(}  \ottnt{S'}  \ottsym{)} }%
\ottpremise{\iota'' \, \mathit{fresh}}%
\ottpremise{\ottnt{F'}  \ottsym{=}  \ottnt{F}  \ottsym{,}  \ottmv{w}  \mapsto  \ottsym{(}  \ottnt{k}  \ottsym{,}  \iota''  \ottsym{)}}%
\ottpremise{\ottnt{RF}  \ottsym{=}  \ottsym{(}  \ottmv{r'}  \ottsym{,}  \ottsym{[}  \iota''  \mapsto  \ottsym{(}   \texttt{\#Cell}   \ottsym{,}  \ottsym{[}   \texttt{val}   \mapsto  \ottsym{(}   \textsf{mut}   \ottsym{,}  \iota'  \ottsym{)}  \ottsym{]}  \ottsym{)}  \ottsym{]}  \ottsym{,}  \ottnt{F'}  \ottsym{)}}%
}{
\langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F_{{\mathrm{1}}}}  \ottsym{)}  \mathop{::}  \ottnt{RS}   \ottsym{;}  H_{\mathit{op} }  \ottsym{;}  \ottsym{(}  \ottmv{r'}  \ottsym{,}  \ottnt{S'}  \ottsym{)}  \ottsym{*}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle \,  \xrightarrow{  \mathit{enter} \, \ottsym{(}  \ottmv{w}  \ottsym{,}  \ottnt{k}  \ottsym{,}  \ottmv{y}  \ottsym{.}  \ottnt{f}  \ottsym{,}  \ottmv{z_{{\mathrm{1}}}}  \ottsym{=}  \ottnt{use_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{z_{\ottmv{n}}}  \ottsym{=}  \ottnt{use_{\ottmv{n}}}  \ottsym{)}  }  \, \langle   \ottnt{RF}  \mathop{::}   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}   F_{n +  1}   \ottsym{)}  \mathop{::}  \ottnt{RS}    \ottsym{;}  \ottsym{(}  \ottmv{r'}  \ottsym{,}  \ottnt{S'}  \ottsym{)}  \ottsym{*}  H_{\mathit{op} }  \ottsym{;}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle}{%
{\ottdrulename{region\_enter\_ok}}{}%
}}


\newcommand{\ottdruleregionXXenterXXfail}[1]{\ottdrule[#1]{%
\ottpremise{ \forall    \ottmv{i}  \in [1,  \ottmv{n}  ]   . ~  \ottkw{get} \, \ottsym{(}  \ottnt{F_{\ottmv{i}}}  \ottsym{,}  \ottnt{use_{\ottmv{i}}}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottsym{(}  \ottnt{k_{\ottmv{i}}}  \ottsym{,}  \iota_{\ottmv{i}}  \ottsym{)}  \ottsym{,}   F_{i +  1}   \ottsym{)} }%
\ottpremise{  F_{n +  1}   \ottsym{(}  \ottmv{y}  \ottsym{)}  \ottsym{=}  \ottsym{(} \, \ottkw{\_} \, \ottsym{,}  \iota  \ottsym{)}  \ottlinebreakhack }%
\ottpremise{ \mathsf{cfg\_load}(  \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F}  \ottsym{)}  \mathop{::}  \ottnt{RS}  ,  H_{\mathit{op} } ,  \iota ) =  \ottnt{o}  \ottsym{[}  \ottnt{f}  \mapsto  \ottsym{(} \, \ottkw{\_} \, \ottsym{,}  \iota'  \ottsym{)}  \ottsym{]} }%
\ottpremise{ \forall    \ottnt{R'}  \in  H_{\mathit{cl} }   . ~  \iota' \, \not\in \, \mathit{dom} \, \ottsym{(}  \ottnt{R'}  \ottsym{.}  \ottnt{S}  \ottsym{)} }%
}{
\langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F}  \ottsym{)}  \mathop{::}  \ottnt{RS}   \ottsym{;}  H_{\mathit{op} }  \ottsym{;}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle \,  \xrightarrow{   \textit{badenter}( \ottmv{y} . \ottnt{f} )   }  \, \langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F}  \ottsym{)}  \mathop{::}  \ottnt{RS}   \ottsym{;}  H_{\mathit{op} }  \ottsym{;}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle}{%
{\ottdrulename{region\_enter\_fail}}{}%
}}


\newcommand{\ottdruleregionXXexitXXtemp}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x} \, \mathit{fresh}}%
\ottpremise{\ottkw{get} \, \ottsym{(}  \ottnt{F'}  \ottsym{,}  \ottnt{use}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottnt{v}  \ottsym{,}  \ottnt{F''}  \ottsym{)}}%
\ottpremise{ \ottnt{F''}  \ottsym{(}  \ottmv{z}  \ottsym{)}  \ottsym{=}  \ottsym{(} \, \ottkw{\_} \, \ottsym{,}  \iota'  \ottsym{)}  \ottlinebreakhack }%
\ottpremise{  \mathsf{load}( \ottnt{S'} ,  \iota' ) =  \ottnt{o'}  \ottsym{[}  \ottnt{f'}  \mapsto  \ottsym{(} \, \ottkw{\_} \, \ottsym{,}  \iota''  \ottsym{)}  \ottsym{]}   \ottlinebreakhack }%
\ottpremise{\ottnt{F}  \ottsym{(}  \ottmv{y}  \ottsym{)}  \ottsym{=}  \ottsym{(} \, \ottkw{\_} \, \ottsym{,}  \iota  \ottsym{)}}%
\ottpremise{  \mathsf{stack\_load}(  \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F}  \ottsym{)}  \mathop{::}  \ottnt{RS}  ,  \iota ) =  \ottnt{o}  \ottsym{[}  \ottnt{f}  \mapsto  \ottsym{(}  \ottnt{k}  \ottsym{,} \, \ottkw{\_} \, \ottsym{)}  \ottsym{]}   \ottlinebreakhack }%
\ottpremise{ \mathsf{stack\_store} (   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F}  \ottsym{)}  \mathop{::}  \ottnt{RS}   ,  \iota  ,  \ottnt{o}  \ottsym{[}  \ottnt{f}  \mapsto  \ottsym{(}  \ottnt{k}  \ottsym{,}  \iota''  \ottsym{)}  \ottsym{]}  ) =   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S''}  \ottsym{,}  \ottnt{F}  \ottsym{)}  \mathop{::}  \ottnt{RS'}  }%
\ottpremise{\ottnt{F'''}  \ottsym{=}  \ottnt{F}  \ottsym{,}  \ottmv{x}  \mapsto  \ottnt{v}}%
}{
\langle   \ottsym{(}  \ottmv{r'}  \ottsym{,}  \ottnt{S'}  \ottsym{,}  \ottnt{F'}  \ottsym{)}  \mathop{::}   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F}  \ottsym{)}  \mathop{::}  \ottnt{RS}    \ottsym{;}  \ottsym{(}  \ottmv{r}  \ottsym{,}   \ottnt{S} _{\mathit{op} }   \ottsym{)}  \ottsym{*}  H_{\mathit{op} }  \ottsym{;}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle \,  \xrightarrow{  \mathit{exit} \, \ottsym{(}  \ottmv{x}  \ottsym{,}  \ottnt{use}  \ottsym{,}  \ottmv{y}  \ottsym{.}  \ottnt{f}  \ottsym{,}  \ottmv{z}  \ottsym{.}  \ottnt{f'}  \ottsym{)}  }  \, \langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S''}  \ottsym{,}  \ottnt{F'''}  \ottsym{)}  \mathop{::}  \ottnt{RS'}   \ottsym{;}  H_{\mathit{op} }  \ottsym{;}  \ottsym{(}  \ottmv{r}  \ottsym{,}   \ottnt{S} _{\mathit{op} }   \ottsym{)}  \ottsym{*}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle}{%
{\ottdrulename{region\_exit\_temp}}{}%
}}


\newcommand{\ottdruleregionXXexitXXheap}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x} \, \mathit{fresh}}%
\ottpremise{\ottkw{get} \, \ottsym{(}  \ottnt{F'}  \ottsym{,}  \ottnt{use}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottnt{v}  \ottsym{,}  \ottnt{F''}  \ottsym{)}}%
\ottpremise{ \ottnt{F''}  \ottsym{(}  \ottmv{z}  \ottsym{)}  \ottsym{=}  \ottsym{(} \, \ottkw{\_} \, \ottsym{,}  \iota'  \ottsym{)}  \ottlinebreakhack }%
\ottpremise{  \mathsf{load}( \ottnt{S'} ,  \iota' ) =  \ottnt{o'}  \ottsym{[}  \ottnt{f'}  \mapsto  \ottsym{(} \, \ottkw{\_} \, \ottsym{,}  \iota''  \ottsym{)}  \ottsym{]}   \ottlinebreakhack }%
\ottpremise{\ottnt{F}  \ottsym{(}  \ottmv{y}  \ottsym{)}  \ottsym{=}  \ottsym{(} \, \ottkw{\_} \, \ottsym{,}  \iota  \ottsym{)}}%
\ottpremise{  \mathsf{heap\_load}( H_{\mathit{op} } ,  \iota ) =  \ottnt{o}  \ottsym{[}  \ottnt{f}  \mapsto  \ottsym{(}  \ottnt{k}  \ottsym{,} \, \ottkw{\_} \, \ottsym{)}  \ottsym{]}   \ottlinebreakhack }%
\ottpremise{ \mathsf{heap\_store} (  H_{\mathit{op} }  ,  \iota  ,  \ottnt{o}  \ottsym{[}  \ottnt{f}  \mapsto  \ottsym{(}  \ottnt{k}  \ottsym{,}  \iota''  \ottsym{)}  \ottsym{]}  ) =  H_{\mathit{op} }' }%
\ottpremise{\ottnt{F'''}  \ottsym{=}  \ottnt{F}  \ottsym{,}  \ottmv{x}  \mapsto  \ottnt{v}}%
}{
\langle   \ottsym{(}  \ottmv{r'}  \ottsym{,}  \ottnt{S'}  \ottsym{,}  \ottnt{F'}  \ottsym{)}  \mathop{::}   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F}  \ottsym{)}  \mathop{::}  \ottnt{RS}    \ottsym{;}  \ottsym{(}  \ottmv{r'}  \ottsym{,}   \ottnt{S} _{\mathit{op} }   \ottsym{)}  \ottsym{*}  H_{\mathit{op} }  \ottsym{;}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle \,  \xrightarrow{  \mathit{exit} \, \ottsym{(}  \ottmv{x}  \ottsym{,}  \ottnt{use}  \ottsym{,}  \ottmv{y}  \ottsym{.}  \ottnt{f}  \ottsym{,}  \ottmv{z}  \ottsym{.}  \ottnt{f'}  \ottsym{)}  }  \, \langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F'''}  \ottsym{)}  \mathop{::}  \ottnt{RS}   \ottsym{;}  H_{\mathit{op} }'  \ottsym{;}  \ottsym{(}  \ottmv{r'}  \ottsym{,}   \ottnt{S} _{\mathit{op} }   \ottsym{)}  \ottsym{*}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle}{%
{\ottdrulename{region\_exit\_heap}}{}%
}}


\newcommand{\ottdruleregionXXbind}[1]{\ottdrule[#1]{%
\ottpremise{ \forall    \ottmv{i}  \in [1,  \ottmv{n}  ]   . ~  \ottmv{x_{\ottmv{i}}} \, \mathit{fresh} }%
\ottpremise{ \forall    \ottmv{i}  \in [1,  \ottmv{n}  ]   . ~  \ottkw{get} \, \ottsym{(}  \ottnt{F_{\ottmv{i}}}  \ottsym{,}  \ottnt{use_{\ottmv{i}}}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottnt{v_{\ottmv{i}}}  \ottsym{,}   F_{i +  1}   \ottsym{)} }%
\ottpremise{\ottnt{F'}  \ottsym{=}   F_{n +  1}   +   [  \ottmv{x_{\ottmv{i}}}  \mapsto  \ottnt{v_{\ottmv{i}}}  ~|~  \ottmv{i}  \in [ 1,  \ottmv{n}  ] ] }%
}{
\langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F_{{\mathrm{1}}}}  \ottsym{)}  \mathop{::}  \ottnt{RS}   \ottsym{;}  H_{\mathit{op} }  \ottsym{;}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle \,  \xrightarrow{   \textit{bind} (  \ottmv{x_{{\mathrm{1}}}}  \ottsym{=}  \ottnt{use_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{x_{\ottmv{n}}}  \ottsym{=}  \ottnt{use_{\ottmv{n}}}  )   }  \, \langle   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F'}  \ottsym{)}  \mathop{::}  \ottnt{RS}   \ottsym{;}  H_{\mathit{op} }  \ottsym{;}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle}{%
{\ottdrulename{region\_bind}}{}%
}}

\newcommand{\ottdefnregionXXstep}[1]{\begin{ottdefnblock}[#1]{$\ottnt{rcfg} \, \ottnt{RegionArrow} \, \ottnt{rcfg'}$}{}
\ottusedrule{\ottdruleregionXXeps{}}
\ottusedrule{\ottdruleregionXXload{}}
\ottusedrule{\ottdruleregionXXswapXXtemp{}}
\ottusedrule{\ottdruleregionXXswapXXheap{}}
\ottusedrule{\ottdruleregionXXallocXXheapXXmut{}}
\ottusedrule{\ottdruleregionXXallocXXheapXXiso{}}
\ottusedrule{\ottdruleregionXXallocXXtemp{}}
\ottusedrule{\ottdruleregionXXfreeze{}}
\ottusedrule{\ottdruleregionXXmerge{}}
\ottusedrule{\ottdruleregionXXcast{}}
\ottusedrule{\ottdruleregionXXnocast{}}
\ottusedrule{\ottdruleregionXXenterXXok{}}
\ottusedrule{\ottdruleregionXXenterXXfail{}}
\ottusedrule{\ottdruleregionXXexitXXtemp{}}
\ottusedrule{\ottdruleregionXXexitXXheap{}}
\ottusedrule{\ottdruleregionXXbind{}}
\end{ottdefnblock}}


\newcommand{\ottdefnsRegion}{
\ottdefnregionXXstep{}}

% defns Command
%% defn exp_step
\newcommand{\ottdrulecmdXXletXXeff}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x'} \, \mathit{fresh}}%
\ottpremise{ \mathbf{effect}(  \ottmv{x'} ,  \ottnt{db} ) =  \ottnt{Eff} }%
}{
\kw{let}\, \, \ottmv{x}  \ottsym{=}  \ottnt{db} \, \kw{in}\, \, \ottnt{e} \,  \xrightarrow{  \ottnt{Eff}  }  \, \ottnt{e}  \ottsym{[}  \ottmv{x}  \mapsto  \ottmv{x'}  \ottsym{]}}{%
{\ottdrulename{cmd\_let\_eff}}{}%
}}


\newcommand{\ottdrulecmdXXenterXXfieldXXfail}[1]{\ottdrule[#1]{%
}{
\kw{let}\, \, \ottmv{x}  \ottsym{=}   \kw{enter}~ \ottmv{y}  \ottsym{.}  \ottnt{f} ~[  \ottmv{z_{{\mathrm{1}}}}  \ottsym{=}  \ottnt{use_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{z_{\ottmv{n}}}  \ottsym{=}  \ottnt{use_{\ottmv{n}}}  ]~\{  \ottmv{w} ~\texttt{=>}~ \ottnt{e}  \}  \, \kw{in}\, \, \ottnt{e'} \,  \xrightarrow{   \textit{badenter}( \ottmv{y} . \ottnt{f} )   }  \, \ottkw{Failure}}{%
{\ottdrulename{cmd\_enter\_field\_fail}}{}%
}}


\newcommand{\ottdrulecmdXXenterXXvarXXfail}[1]{\ottdrule[#1]{%
}{
\kw{let}\, \, \ottmv{x}  \ottsym{=}   \kw{enter}~ \ottmv{y} ~[  \ottmv{z_{{\mathrm{1}}}}  \ottsym{=}  \ottnt{use_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{z_{\ottmv{n}}}  \ottsym{=}  \ottnt{use_{\ottmv{n}}}  ]~\{  \ottmv{w} ~\texttt{=>}~ \ottnt{e}  \}  \, \kw{in}\, \, \ottnt{e'} \,  \xrightarrow{   \textit{badenter}( \ottmv{y} .  \texttt{val}  )   }  \, \ottkw{Failure}}{%
{\ottdrulename{cmd\_enter\_var\_fail}}{}%
}}


\newcommand{\ottdrulecmdXXenterXXfield}[1]{\ottdrule[#1]{%
\ottpremise{ \ottnt{db_{{\mathrm{1}}}}  \ottsym{=}   \kw{enter}~ \ottmv{y}  \ottsym{.}  \ottnt{f} ~[  \ottmv{z_{{\mathrm{1}}}}  \ottsym{=}  \ottnt{use_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{z_{\ottmv{n}}}  \ottsym{=}  \ottnt{use_{\ottmv{n}}}  ]~\{  \ottmv{w} ~\texttt{=>}~ \ottnt{e}  \}   \ottlinebreakhack }%
\ottpremise{ \ottnt{db_{{\mathrm{2}}}}  \ottsym{=}   \mathbf{entered}~ \ottmv{y}  \ottsym{.}  \ottnt{f} ~ \ottmv{w'}  \ottsym{.}   \texttt{val}  ~ \{  \ottnt{e}  \ottsym{[}  \ottmv{w}  \mapsto  \ottmv{w'}  \ottsym{,}  \ottmv{z_{{\mathrm{1}}}}  \mapsto  \ottmv{z'_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{z_{\ottmv{n}}}  \mapsto  \ottmv{z'_{\ottmv{n}}}  \ottsym{]}  \}   \ottlinebreakhack }%
\ottpremise{\ottmv{w'} \, \mathit{fresh}}%
\ottpremise{\ottmv{z'_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{z'_{\ottmv{n}}} \, \mathit{fresh}}%
}{
\kw{let}\, \, \ottmv{x}  \ottsym{=}  \ottnt{db_{{\mathrm{1}}}} \, \kw{in}\, \, \ottnt{e'} \,  \xrightarrow{  \mathit{enter} \, \ottsym{(}  \ottmv{w'}  \ottsym{,}   \textsf{tmp}   \ottsym{,}  \ottmv{y}  \ottsym{.}  \ottnt{f}  \ottsym{,}  \ottmv{z'_{{\mathrm{1}}}}  \ottsym{=}  \ottnt{use_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{z'_{\ottmv{n}}}  \ottsym{=}  \ottnt{use_{\ottmv{n}}}  \ottsym{)}  }  \, \kw{let}\, \, \ottmv{x}  \ottsym{=}  \ottnt{db_{{\mathrm{2}}}} \, \kw{in}\, \, \ottnt{e'}}{%
{\ottdrulename{cmd\_enter\_field}}{}%
}}


\newcommand{\ottdrulecmdXXenterXXvar}[1]{\ottdrule[#1]{%
\ottpremise{ \ottnt{db_{{\mathrm{1}}}}  \ottsym{=}   \kw{enter}~ \ottmv{y} ~[  \ottmv{z_{{\mathrm{1}}}}  \ottsym{=}  \ottnt{use_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{z_{\ottmv{n}}}  \ottsym{=}  \ottnt{use_{\ottmv{n}}}  ]~\{  \ottmv{w} ~\texttt{=>}~ \ottnt{e}  \}   \ottlinebreakhack }%
\ottpremise{ \ottnt{db_{{\mathrm{2}}}}  \ottsym{=}   \mathbf{entered}~ \ottmv{y}  \ottsym{.}  \ottnt{f} ~ \ottmv{w'}  \ottsym{.}   \texttt{val}  ~ \{  \ottnt{e}  \ottsym{[}  \ottmv{w}  \mapsto  \ottmv{w'}  \ottsym{,}  \ottmv{z_{{\mathrm{1}}}}  \mapsto  \ottmv{z'_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{z_{\ottmv{n}}}  \mapsto  \ottmv{z'_{\ottmv{n}}}  \ottsym{]}  \}   \ottlinebreakhack }%
\ottpremise{\ottmv{w'} \, \mathit{fresh}}%
\ottpremise{\ottmv{z'_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{z'_{\ottmv{n}}} \, \mathit{fresh}}%
}{
\kw{let}\, \, \ottmv{x}  \ottsym{=}  \ottnt{db_{{\mathrm{1}}}} \, \kw{in}\, \, \ottnt{e'} \,  \xrightarrow{  \mathit{enter} \, \ottsym{(}  \ottmv{w'}  \ottsym{,}   \textsf{var}   \ottsym{,}  \ottmv{y}  \ottsym{.}   \texttt{val}   \ottsym{,}  \ottmv{z'_{{\mathrm{1}}}}  \ottsym{=}  \ottnt{use_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{z'_{\ottmv{n}}}  \ottsym{=}  \ottnt{use_{\ottmv{n}}}  \ottsym{)}  }  \, \kw{let}\, \, \ottmv{x}  \ottsym{=}  \ottnt{db_{{\mathrm{2}}}} \, \kw{in}\, \, \ottnt{e'}}{%
{\ottdrulename{cmd\_enter\_var}}{}%
}}


\newcommand{\ottdrulecmdXXexit}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x'} \, \mathit{fresh}}%
}{
\kw{let}\, \, \ottmv{x}  \ottsym{=}   \mathbf{entered}~ \ottmv{y}  \ottsym{.}  \ottnt{f} ~ \ottmv{w'}  \ottsym{.}   \texttt{val}  ~ \{  \ottnt{use}  \}  \, \kw{in}\, \, \ottnt{e} \,  \xrightarrow{  \mathit{exit} \, \ottsym{(}  \ottmv{x'}  \ottsym{,}  \ottnt{use}  \ottsym{,}  \ottmv{y}  \ottsym{.}  \ottnt{f}  \ottsym{,}  \ottmv{w'}  \ottsym{.}   \texttt{val}   \ottsym{)}  }  \, \ottnt{e}  \ottsym{[}  \ottmv{x}  \mapsto  \ottmv{x'}  \ottsym{]}}{%
{\ottdrulename{cmd\_exit}}{}%
}}


\newcommand{\ottdrulecmdXXifXXtypetestXXtrue}[1]{\ottdrule[#1]{%
\ottpremise{ \ottnt{k}  ~  \ottnt{CL}   \ottsym{<:}  \ottnt{t}}%
\ottpremise{\ottmv{y'} \, \mathit{fresh}}%
}{
\kw{if}\, \, \kw{typetest}\, \, \ottsym{(}  \ottnt{use}  \ottsym{,}  \ottnt{t}  \ottsym{)}  \,\startblock\,  \ottmv{y}  \mathop{\texttt{=>} }  \ottnt{e_{{\mathrm{1}}}}  \,\finishblock\,  \,\startblock\,  \ottmv{y}  \mathop{\texttt{=>} }  \ottnt{e_{{\mathrm{2}}}}  \,\finishblock\, \,  \xrightarrow{   \textit{cast} (  \ottmv{y'} ,  \ottnt{use} ,  \ottnt{k} ~ \ottnt{CL}  )   }  \, \ottnt{e_{{\mathrm{1}}}}  \ottsym{[}  \ottmv{y}  \mapsto  \ottmv{y'}  \ottsym{]}}{%
{\ottdrulename{cmd\_if\_typetest\_true}}{}%
}}


\newcommand{\ottdrulecmdXXifXXtypetestXXfalse}[1]{\ottdrule[#1]{%
\ottpremise{  \ottnt{k}  ~  \ottnt{CL}  \not<: \ottnt{t} }%
\ottpremise{\ottmv{y'} \, \mathit{fresh}}%
}{
\kw{if}\, \, \kw{typetest}\, \, \ottsym{(}  \ottnt{use}  \ottsym{,}  \ottnt{t}  \ottsym{)}  \,\startblock\,  \ottmv{y}  \mathop{\texttt{=>} }  \ottnt{e_{{\mathrm{1}}}}  \,\finishblock\,  \,\startblock\,  \ottmv{y}  \mathop{\texttt{=>} }  \ottnt{e_{{\mathrm{2}}}}  \,\finishblock\, \,  \xrightarrow{   \textit{nocast} (  \ottmv{y'} ,  \ottnt{use} ,  \ottnt{k} ~ \ottnt{CL}  )   }  \, \ottnt{e_{{\mathrm{2}}}}  \ottsym{[}  \ottmv{y}  \mapsto  \ottmv{y'}  \ottsym{]}}{%
{\ottdrulename{cmd\_if\_typetest\_false}}{}%
}}


\newcommand{\ottdrulecmdXXcall}[1]{\ottdrule[#1]{%
\ottpremise{\ottkw{fnclookup} \, \ottsym{(}  \ottmv{fnc}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottmv{x_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{x_{\ottmv{n}}}  \ottsym{)}  \rightarrow   \ottnt{e} _{ \mathit{body} } }%
\ottpremise{ \ottmv{x'_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{x'_{\ottmv{n}}} \, \mathit{fresh}  \ottlinebreakhack }%
\ottpremise{\overline{x}  \ottsym{=}  \ottmv{x_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{x_{\ottmv{n}}}}%
\ottpremise{\overline{x}'  \ottsym{=}  \ottmv{x'_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{x'_{\ottmv{n}}}}%
}{
\kw{let}\, \, \ottmv{x}  \ottsym{=}  \ottmv{fnc}  \ottsym{(}  \ottnt{use_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottnt{use_{\ottmv{n}}}  \ottsym{)} \, \kw{in}\, \, \ottnt{e} \,  \xrightarrow{   \textit{bind} (  \ottmv{x'_{{\mathrm{1}}}}  \ottsym{=}  \ottnt{use_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{x'_{\ottmv{n}}}  \ottsym{=}  \ottnt{use_{\ottmv{n}}}  )   }  \, \kw{let}\, \, \ottmv{x}  \ottsym{=}   \ottnt{e} _{ \mathit{body} }   \ottsym{[}  \overline{x}  \mapsto  \overline{x}'  \ottsym{]} \, \kw{in}\, \, \ottnt{e}}{%
{\ottdrulename{cmd\_call}}{}%
}}


\newcommand{\ottdrulecmdXXec}[1]{\ottdrule[#1]{%
\ottpremise{\ottnt{de'} \,  \xrightarrow{  \ottnt{Eff}  }  \, \ottnt{de''}}%
}{
\ottnt{de}  \ottsym{[}  \ottnt{de'}  \ottsym{]} \,  \xrightarrow{  \ottnt{Eff}  }  \, \ottnt{de}  \ottsym{[}  \ottnt{de''}  \ottsym{]}}{%
{\ottdrulename{cmd\_ec}}{}%
}}


\newcommand{\ottdrulecmdXXecXXfail}[1]{\ottdrule[#1]{%
}{
\ottnt{de}  \ottsym{[}  \ottkw{Failure}  \ottsym{]} \,  \xrightarrow{   \epsilon   }  \, \ottkw{Failure}}{%
{\ottdrulename{cmd\_ec\_fail}}{}%
}}

\newcommand{\ottdefncmdXXexpXXstep}[1]{\begin{ottdefnblock}[#1]{$\ottnt{de} \, \ottnt{CommandArrow} \, \ottnt{de'}$}{}
\ottusedrule{\ottdrulecmdXXletXXeff{}}
\ottusedrule{\ottdrulecmdXXenterXXfieldXXfail{}}
\ottusedrule{\ottdrulecmdXXenterXXvarXXfail{}}
\ottusedrule{\ottdrulecmdXXenterXXfield{}}
\ottusedrule{\ottdrulecmdXXenterXXvar{}}
\ottusedrule{\ottdrulecmdXXexit{}}
\ottusedrule{\ottdrulecmdXXifXXtypetestXXtrue{}}
\ottusedrule{\ottdrulecmdXXifXXtypetestXXfalse{}}
\ottusedrule{\ottdrulecmdXXcall{}}
\ottusedrule{\ottdrulecmdXXec{}}
\ottusedrule{\ottdrulecmdXXecXXfail{}}
\end{ottdefnblock}}

%% defn typing_
\newcommand{\ottdrulecmdXXtyXXuseXXkeep}[1]{\ottdrule[#1]{%
\ottpremise{\vdash  \Gamma_{{\mathrm{1}}}}%
\ottpremise{ \Gamma_{{\mathrm{1}}}  \ottsym{(}  \ottmv{x}  \ottsym{)}  \ottsym{=}   \ottnt{k}  ~  \ottnt{CL}   \ottlinebreakhack }%
\ottpremise{ \ottnt{k} \neq  \textsf{iso}  }%
\ottpremise{ \ottnt{k} \neq  \textsf{var}  }%
}{
\Gamma_{{\mathrm{1}}}  \vdash  \ottmv{x}  \ottsym{:}   \ottnt{k}  ~  \ottnt{CL}   \dashv  \Gamma_{{\mathrm{1}}}}{%
{\ottdrulename{cmd\_ty\_use\_keep}}{}%
}}


\newcommand{\ottdrulecmdXXtyXXuseXXvaralias}[1]{\ottdrule[#1]{%
\ottpremise{\vdash  \Gamma_{{\mathrm{1}}}  \ottsym{[}  \ottmv{x}  \ottsym{:}    \textsf{var}   ~  \ottnt{CL}   \ottsym{]}}%
}{
\Gamma_{{\mathrm{1}}}  \ottsym{[}  \ottmv{x}  \ottsym{:}    \textsf{var}   ~  \ottnt{CL}   \ottsym{]}  \vdash  \ottmv{x}  \ottsym{:}    \textsf{tmp}   ~  \ottnt{CL}   \dashv  \Gamma_{{\mathrm{1}}}  \ottsym{[}  \ottmv{x}  \ottsym{:}    \textsf{tmp}   ~  \ottnt{CL}   \ottsym{]}}{%
{\ottdrulename{cmd\_ty\_use\_varalias}}{}%
}}


\newcommand{\ottdrulecmdXXtyXXuseXXdrop}[1]{\ottdrule[#1]{%
\ottpremise{\vdash  \Gamma_{{\mathrm{1}}}}%
\ottpremise{ \Gamma_{{\mathrm{1}}}  \ottsym{=}  \Gamma  \ottsym{[}  \ottmv{x}  \ottsym{:}  \ottnt{t}  \ottsym{]}  \ottlinebreakhack }%
\ottpremise{\Gamma_{{\mathrm{2}}}  \ottsym{=}  \Gamma  \ottsym{[}  \ottmv{x}  \ottsym{:} \, \mathbf{undef} \, \ottsym{]}}%
}{
\Gamma_{{\mathrm{1}}}  \vdash  \kw{drop}\, \, \ottmv{x}  \ottsym{:}  \ottnt{t}  \dashv  \Gamma_{{\mathrm{2}}}}{%
{\ottdrulename{cmd\_ty\_use\_drop}}{}%
}}


\newcommand{\ottdrulecmdXXtyXXlet}[1]{\ottdrule[#1]{%
\ottpremise{\Gamma_{{\mathrm{1}}}  \vdash  \ottnt{b}  \ottsym{:}  \ottnt{t_{{\mathrm{1}}}}  \dashv  \Gamma_{{\mathrm{2}}}}%
\ottpremise{ \ottmv{x} \, \not\in \, \mathit{dom} \, \ottsym{(}  \Gamma_{{\mathrm{2}}}  \ottsym{)}  \ottlinebreakhack }%
\ottpremise{\Gamma_{{\mathrm{2}}}  \ottsym{,}  \ottmv{x}  \ottsym{:}  \ottnt{t_{{\mathrm{1}}}}  \vdash  \ottnt{e}  \ottsym{:}  \ottnt{t_{{\mathrm{2}}}}  \dashv  \Gamma_{{\mathrm{3}}}  \ottsym{,}  \ottmv{x}  \ottsym{:}  \ottkw{\_}}%
}{
\Gamma_{{\mathrm{1}}}  \vdash  \kw{let}\, \, \ottmv{x}  \ottsym{=}  \ottnt{b} \, \kw{in}\, \, \ottnt{e}  \ottsym{:}  \ottnt{t_{{\mathrm{2}}}}  \dashv  \Gamma_{{\mathrm{3}}}}{%
{\ottdrulename{cmd\_ty\_let}}{}%
}}


\newcommand{\ottdrulecmdXXtyXXtypetest}[1]{\ottdrule[#1]{%
\ottpremise{\Gamma  \vdash  \ottnt{use}  \ottsym{:}  \ottnt{t'}  \dashv  \Gamma'}%
\ottpremise{ \ottkw{classtype} \, \ottsym{(}  \ottnt{t}  \ottsym{)}  \ottlinebreakhack }%
\ottpremise{\Gamma'  \ottsym{,}  \ottmv{y}  \ottsym{:}  \ottnt{t}  \vdash  \ottnt{e_{{\mathrm{1}}}}  \ottsym{:}  \ottnt{t_{{\mathrm{1}}}}  \dashv  \Gamma_{{\mathrm{1}}}  \ottsym{,}  \ottmv{y}  \ottsym{:}  \ottkw{\_}}%
\ottpremise{\Gamma'  \ottsym{,}  \ottmv{y}  \ottsym{:}  \ottnt{t'}  \vdash  \ottnt{e_{{\mathrm{2}}}}  \ottsym{:}  \ottnt{t_{{\mathrm{2}}}}  \dashv  \Gamma_{{\mathrm{2}}}  \ottsym{,}  \ottmv{y}  \ottsym{:}  \ottkw{\_}}%
}{
\Gamma  \vdash  \kw{if}\, \, \kw{typetest}\, \, \ottsym{(}  \ottnt{use}  \ottsym{,}  \ottnt{t}  \ottsym{)}  \,\startblock\,  \ottmv{y}  \mathop{\texttt{=>} }  \ottnt{e_{{\mathrm{1}}}}  \,\finishblock\,  \,\startblock\,  \ottmv{y}  \mathop{\texttt{=>} }  \ottnt{e_{{\mathrm{2}}}}  \,\finishblock\,  \ottsym{:}   \ottnt{t_{{\mathrm{1}}}}  \mathop{|}  \ottnt{t_{{\mathrm{2}}}}   \dashv   \Gamma_{{\mathrm{1}}}  \mathop{|}  \Gamma_{{\mathrm{2}}} }{%
{\ottdrulename{cmd\_ty\_typetest}}{}%
}}

\newcommand{\ottdefncmdXXtypingXX}[1]{\begin{ottdefnblock}[#1]{$\Gamma  \vdash  \ottnt{e}  \ottsym{:}  \ottnt{t}  \dashv  \Gamma'$}{}
\ottusedrule{\ottdrulecmdXXtyXXuseXXkeep{}}
\ottusedrule{\ottdrulecmdXXtyXXuseXXvaralias{}}
\ottusedrule{\ottdrulecmdXXtyXXuseXXdrop{}}
\ottusedrule{\ottdrulecmdXXtyXXlet{}}
\ottusedrule{\ottdrulecmdXXtyXXtypetest{}}
\end{ottdefnblock}}

%% defn typing_b_
\newcommand{\ottdrulecmdXXtyXXderefXXfield}[1]{\ottdrule[#1]{%
\ottpremise{ \Gamma  \ottsym{(}  \ottmv{x}  \ottsym{)}  \ottsym{=}   \ottnt{k}  ~  \ottnt{CL}   \ottlinebreakhack }%
\ottpremise{ \ottkw{ftype} \, \ottsym{(}  \ottnt{CL}  \ottsym{,}  \ottnt{f}  \ottsym{)}  \ottsym{=}  \ottnt{t}  \ottlinebreakhack }%
\ottpremise{\vdash   \ottnt{k}  \mathop{\odot}  \ottnt{t} }%
}{
\Gamma  \vdash  \ottsym{*}  \ottmv{x}  \ottsym{.}  \ottnt{f}  \ottsym{:}  \ottsym{(}   \ottnt{k}  \mathop{\odot}  \ottnt{t}   \ottsym{)}  \dashv  \Gamma}{%
{\ottdrulename{cmd\_ty\_deref\_field}}{}%
}}


\newcommand{\ottdrulecmdXXtyXXderefXXvar}[1]{\ottdrule[#1]{%
\ottpremise{\Gamma  \ottsym{(}  \ottmv{x}  \ottsym{)}  \ottsym{=}    \textsf{var}   ~   \texttt{Cell}[  \ottnt{t}  ]  }%
\ottpremise{\vdash    \textsf{var}   \mathop{\odot}  \ottnt{t} }%
}{
\Gamma  \vdash  \ottsym{*}  \ottmv{x}  \ottsym{:}  \ottsym{(}    \textsf{var}   \mathop{\odot}  \ottnt{t}   \ottsym{)}  \dashv  \Gamma}{%
{\ottdrulename{cmd\_ty\_deref\_var}}{}%
}}


\newcommand{\ottdrulecmdXXtyXXassign}[1]{\ottdrule[#1]{%
\ottpremise{\Gamma_{{\mathrm{1}}}  \vdash  \ottnt{use}  \ottsym{:}  \ottnt{t}  \dashv  \Gamma_{{\mathrm{2}}}}%
\ottpremise{ \Gamma_{{\mathrm{2}}}  \ottsym{(}  \ottmv{x}  \ottsym{)}  \ottsym{=}   \ottnt{k}  ~  \ottnt{CL}   \ottlinebreakhack }%
\ottpremise{\ottkw{ftype} \, \ottsym{(}  \ottnt{CL}  \ottsym{,}  \ottnt{f}  \ottsym{)}  \ottsym{=}  \ottnt{t}}%
\ottpremise{ \ottnt{k}  \in   \{   \textsf{mut}   \ottsym{,}   \textsf{tmp}   \}  }%
}{
\Gamma_{{\mathrm{1}}}  \vdash  \ottmv{x}  \ottsym{.}  \ottnt{f}  \ottsym{:=}  \ottnt{use}  \ottsym{:}  \ottnt{t}  \dashv  \Gamma_{{\mathrm{2}}}}{%
{\ottdrulename{cmd\_ty\_assign}}{}%
}}


\newcommand{\ottdrulecmdXXtyXXassignXXvar}[1]{\ottdrule[#1]{%
\ottpremise{\Gamma_{{\mathrm{1}}}  \vdash  \ottnt{use}  \ottsym{:}  \ottnt{t_{{\mathrm{1}}}}  \dashv  \Gamma_{{\mathrm{2}}}  \ottsym{[}  \ottmv{x}  \ottsym{:}    \textsf{var}   ~   \texttt{Cell}[  \ottnt{t_{{\mathrm{2}}}}  ]    \ottsym{]}}%
}{
\Gamma_{{\mathrm{1}}}  \vdash  \ottmv{x}  \ottsym{:=}  \ottnt{use}  \ottsym{:}  \ottnt{t_{{\mathrm{2}}}}  \dashv  \Gamma_{{\mathrm{2}}}  \ottsym{[}  \ottmv{x}  \ottsym{:}    \textsf{var}   ~   \texttt{Cell}[  \ottnt{t_{{\mathrm{1}}}}  ]    \ottsym{]}}{%
{\ottdrulename{cmd\_ty\_assign\_var}}{}%
}}


\newcommand{\ottdrulecmdXXtyXXcreateXXvar}[1]{\ottdrule[#1]{%
\ottpremise{\Gamma_{{\mathrm{1}}}  \vdash  \ottnt{use}  \ottsym{:}  \ottnt{t}  \dashv  \Gamma_{{\mathrm{2}}}}%
}{
\Gamma_{{\mathrm{1}}}  \vdash  \ottkw{var} \, \ottnt{use}  \ottsym{:}    \textsf{var}   ~   \texttt{Cell}[  \ottnt{t}  ]    \dashv  \Gamma_{{\mathrm{2}}}}{%
{\ottdrulename{cmd\_ty\_create\_var}}{}%
}}


\newcommand{\ottdrulecmdXXtyXXcall}[1]{\ottdrule[#1]{%
\ottpremise{ \ottkw{fnctype} \, \ottsym{(}  \ottmv{fnc}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottnt{t_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottnt{t_{\ottmv{n}}}  \ottsym{)}  \rightarrow  \ottnt{t}  \ottlinebreakhack }%
\ottpremise{ \forall    \ottmv{i}  \in [1,  \ottmv{n}  ]   . ~  \Gamma_{\ottmv{i}}  \vdash  \ottnt{use_{\ottmv{i}}}  \ottsym{:}  \ottnt{t_{\ottmv{i}}}  \dashv   \Gamma_{i+1}  }%
}{
\Gamma_{{\mathrm{1}}}  \vdash  \ottmv{fnc}  \ottsym{(}  \ottnt{use_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottnt{use_{\ottmv{n}}}  \ottsym{)}  \ottsym{:}  \ottnt{t}  \dashv   \Gamma_{n+1} }{%
{\ottdrulename{cmd\_ty\_call}}{}%
}}


\newcommand{\ottdrulecmdXXtyXXnew}[1]{\ottdrule[#1]{%
\ottpremise{\vdash  \Gamma_{{\mathrm{1}}}}%
\ottpremise{\vdash   \ottnt{k}  ~   C  }%
\ottpremise{  \ottnt{k}  \in   \{   \textsf{mut}   \ottsym{,}   \textsf{tmp}   \ottsym{,}   \textsf{iso}   \}    \ottlinebreakhack }%
\ottpremise{\ottkw{ftypes} \, \ottsym{(}   C   \ottsym{)}  \ottsym{=}  \ottnt{f_{{\mathrm{1}}}}  \ottsym{:}  \ottnt{t_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottnt{f_{\ottmv{n}}}  \ottsym{:}  \ottnt{t_{\ottmv{n}}}}%
\ottpremise{  \forall    \ottmv{i}  \in [1,  \ottmv{n}  ]   . ~  \ottsym{(}  \Gamma_{\ottmv{i}}  \vdash  \ottnt{use_{\ottmv{i}}}  \ottsym{:}  \ottnt{t'_{\ottmv{i}}}  \dashv   \Gamma_{i+1}   \land  \ottnt{t'_{\ottmv{i}}}  \ottsym{<:}  \ottnt{t_{\ottmv{i}}}  \ottsym{)}   \ottlinebreakhack }%
\ottpremise{\ottnt{k}  \ottsym{=}   \textsf{iso}   \Rightarrow   \forall    \ottmv{i}  \in [1,  \ottmv{n}  ]   . ~   \textsf{cap}( \{  \textsf{iso}   \ottsym{,}   \textsf{imm}  \},  \ottnt{t'_{\ottmv{i}}}  )  }%
}{
\Gamma_{{\mathrm{1}}}  \vdash  \kw{new} \, \ottnt{k} \, \ottmv{C}  \ottsym{(}  \ottnt{use_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottnt{use_{\ottmv{n}}}  \ottsym{)}  \ottsym{:}   \ottnt{k}  ~   C    \dashv   \Gamma_{n+1} }{%
{\ottdrulename{cmd\_ty\_new}}{}%
}}


\newcommand{\ottdrulecmdXXtyXXenter}[1]{\ottdrule[#1]{%
\ottpremise{ \forall    \ottmv{i}  \in [1,  \ottmv{n}  ]   . ~  \Gamma_{\ottmv{i}}  \vdash  \ottnt{use_{\ottmv{i}}}  \ottsym{:}  \ottnt{t_{\ottmv{i}}}  \dashv   \Gamma_{i+1}  }%
\ottpremise{  \Gamma_{n+1}   \ottsym{(}  \ottmv{x}  \ottsym{)}  \ottsym{=}   \ottnt{k}  ~  \ottnt{CL}   \ottlinebreakhack }%
\ottpremise{ \textsf{open}(  \ottnt{k}  ) }%
\ottpremise{\ottkw{ftype} \, \ottsym{(}  \ottnt{CL}  \ottsym{,}  \ottnt{f}  \ottsym{)}  \ottsym{=}  \ottnt{t}}%
\ottpremise{  \textsf{cap}(   \textsf{iso}   ,  \ottnt{t}  )   \ottlinebreakhack }%
\ottpremise{  \Gamma'  \ottsym{=}  \ottmv{y_{{\mathrm{1}}}}  \ottsym{:}  \ottnt{t'_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{y_{\ottmv{n}}}  \ottsym{:}  \ottnt{t'_{\ottmv{n}}}  \text{~~where~~}  \ottnt{t'_{\ottmv{i}}}  \ottsym{=}   \ensuremath{\begin{cases}  \ottnt{t_{\ottmv{i}}}  & \text{if }   \textsf{cap}(   \textsf{iso}   ,  \ottnt{t_{\ottmv{i}}}  )   \\    \textsf{paused}   \mathop{\odot}  \ottnt{t_{\ottmv{i}}}   & \text{otherwise} \end{cases} }    \ottlinebreakhack }%
\ottpremise{\ottnt{t'}  \ottsym{=}   \mathit{make\_mut} (  \ottnt{t}  ) }%
\ottpremise{\Gamma'  \ottsym{,}  \ottmv{z}  \ottsym{:}    \textsf{tmp}   ~   \texttt{Cell}[  \ottnt{t'}  ]    \vdash  \ottnt{e}  \ottsym{:}  \ottnt{t''}  \dashv  \Gamma''  \ottsym{,}  \ottmv{z}  \ottsym{:}    \textsf{tmp}   ~   \texttt{Cell}[  \ottnt{t'}  ]  }%
\ottpremise{ \textsf{cap}( \{  \textsf{iso}   \ottsym{,}   \textsf{imm}  \},  \ottnt{t''}  ) }%
}{
\Gamma_{{\mathrm{1}}}  \vdash   \kw{enter}~ \ottmv{x}  \ottsym{.}  \ottnt{f} ~[  \ottmv{y_{{\mathrm{1}}}}  \ottsym{=}  \ottnt{use_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{y_{\ottmv{n}}}  \ottsym{=}  \ottnt{use_{\ottmv{n}}}  ]~\{  \ottmv{z} ~\texttt{=>}~ \ottnt{e}  \}   \ottsym{:}  \ottnt{t''}  \dashv   \Gamma_{n+1} }{%
{\ottdrulename{cmd\_ty\_enter}}{}%
}}


\newcommand{\ottdrulecmdXXtyXXenterXXvar}[1]{\ottdrule[#1]{%
\ottpremise{ \forall    \ottmv{i}  \in [1,  \ottmv{n}  ]   . ~  \Gamma_{\ottmv{i}}  \vdash  \ottnt{use_{\ottmv{i}}}  \ottsym{:}  \ottnt{t_{\ottmv{i}}}  \dashv   \Gamma_{i+1}  }%
\ottpremise{\Gamma  \ottsym{[}  \ottmv{x}  \ottsym{:}    \textsf{var}   ~   \texttt{Cell}[  \ottnt{t}  ]    \ottsym{]}  \ottsym{=}   \Gamma_{n+1} }%
\ottpremise{  \textsf{cap}(   \textsf{iso}   ,  \ottnt{t}  )   \ottlinebreakhack }%
\ottpremise{  \Gamma'  \ottsym{=}  \ottmv{y_{{\mathrm{1}}}}  \ottsym{:}  \ottnt{t'_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{y_{\ottmv{n}}}  \ottsym{:}  \ottnt{t'_{\ottmv{n}}}  \text{~~where~~}  \ottnt{t'_{\ottmv{i}}}  \ottsym{=}   \ensuremath{\begin{cases}  \ottnt{t_{\ottmv{i}}}  & \text{if }   \textsf{cap}(   \textsf{iso}   ,  \ottnt{t_{\ottmv{i}}}  )   \\    \textsf{paused}   \mathop{\odot}  \ottnt{t_{\ottmv{i}}}   & \text{otherwise} \end{cases} }    \ottlinebreakhack }%
\ottpremise{ \Gamma'  \ottsym{,}  \ottmv{z}  \ottsym{:}    \textsf{var}   ~   \texttt{Cell}[   \mathit{make\_mut} (  \ottnt{t}  )   ]    \vdash  \ottnt{e}  \ottsym{:}  \ottnt{t''}  \dashv  \Gamma''  \ottsym{,}  \ottmv{z}  \ottsym{:}    \textsf{var}   ~   \texttt{Cell}[  \ottnt{t'}  ]    \ottlinebreakhack }%
\ottpremise{ \textsf{cap}(   \textsf{mut}   ,  \ottnt{t'}  ) }%
\ottpremise{ \textsf{cap}( \{  \textsf{iso}   \ottsym{,}   \textsf{imm}  \},  \ottnt{t''}  ) }%
}{
\Gamma_{{\mathrm{1}}}  \vdash   \kw{enter}~ \ottmv{x} ~[  \ottmv{y_{{\mathrm{1}}}}  \ottsym{=}  \ottnt{use_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{y_{\ottmv{n}}}  \ottsym{=}  \ottnt{use_{\ottmv{n}}}  ]~\{  \ottmv{z} ~\texttt{=>}~ \ottnt{e}  \}   \ottsym{:}  \ottnt{t''}  \dashv  \Gamma  \ottsym{[}  \ottmv{x}  \ottsym{:}    \textsf{var}   ~   \texttt{Cell}[   \mathit{make\_iso} (  \ottnt{t'}  )   ]    \ottsym{]}}{%
{\ottdrulename{cmd\_ty\_enter\_var}}{}%
}}


\newcommand{\ottdrulecmdXXtyXXfreeze}[1]{\ottdrule[#1]{%
\ottpremise{\Gamma_{{\mathrm{1}}}  \vdash  \ottnt{use}  \ottsym{:}    \textsf{iso}   ~  \ottnt{CL}   \dashv  \Gamma_{{\mathrm{2}}}}%
}{
\Gamma_{{\mathrm{1}}}  \vdash   \kw{freeze}~ \ottnt{use}   \ottsym{:}    \textsf{imm}   ~  \ottnt{CL}   \dashv  \Gamma_{{\mathrm{2}}}}{%
{\ottdrulename{cmd\_ty\_freeze}}{}%
}}


\newcommand{\ottdrulecmdXXtyXXmerge}[1]{\ottdrule[#1]{%
\ottpremise{\Gamma_{{\mathrm{1}}}  \vdash  \ottnt{use}  \ottsym{:}    \textsf{iso}   ~  \ottnt{CL}   \dashv  \Gamma_{{\mathrm{2}}}}%
}{
\Gamma_{{\mathrm{1}}}  \vdash   \kw{merge}~ \ottnt{use}   \ottsym{:}    \textsf{mut}   ~  \ottnt{CL}   \dashv  \Gamma_{{\mathrm{2}}}}{%
{\ottdrulename{cmd\_ty\_merge}}{}%
}}


\newcommand{\ottdrulecmdXXtyXXsplit}[1]{\ottdrule[#1]{%
\ottpremise{\Gamma_{{\mathrm{1}}}  \ottsym{[}  \ottmv{x}  \ottsym{:}  \ottnt{t}  \ottsym{]}  \vdash  \ottnt{b}  \ottsym{:}  \ottnt{t_{{\mathrm{1}}}}  \dashv  \Gamma_{{\mathrm{2}}}}%
\ottpremise{\Gamma_{{\mathrm{1}}}  \ottsym{[}  \ottmv{x}  \ottsym{:}  \ottnt{t'}  \ottsym{]}  \vdash  \ottnt{b}  \ottsym{:}  \ottnt{t'_{{\mathrm{1}}}}  \dashv  \Gamma'_{{\mathrm{2}}}}%
}{
\Gamma_{{\mathrm{1}}}  \ottsym{[}  \ottmv{x}  \ottsym{:}   \ottnt{t}  \mathop{|}  \ottnt{t'}   \ottsym{]}  \vdash  \ottnt{b}  \ottsym{:}   \ottnt{t_{{\mathrm{1}}}}  \mathop{|}  \ottnt{t'_{{\mathrm{1}}}}   \dashv   \Gamma_{{\mathrm{2}}}  \mathop{|}  \Gamma'_{{\mathrm{2}}} }{%
{\ottdrulename{cmd\_ty\_split}}{}%
}}


\newcommand{\ottdrulecmdXXtyXXsub}[1]{\ottdrule[#1]{%
\ottpremise{\Gamma_{{\mathrm{1}}}  \vdash  \ottnt{b}  \ottsym{:}  \ottnt{t_{{\mathrm{1}}}}  \dashv  \Gamma_{{\mathrm{2}}}}%
\ottpremise{\ottnt{t_{{\mathrm{1}}}}  \ottsym{<:}  \ottnt{t_{{\mathrm{2}}}}}%
}{
\Gamma_{{\mathrm{1}}}  \vdash  \ottnt{b}  \ottsym{:}  \ottnt{t_{{\mathrm{2}}}}  \dashv  \Gamma_{{\mathrm{2}}}}{%
{\ottdrulename{cmd\_ty\_sub}}{}%
}}

\newcommand{\ottdefncmdXXtypingXXbXX}[1]{\begin{ottdefnblock}[#1]{$\Gamma  \vdash  \ottnt{b}  \ottsym{:}  \ottnt{t}  \dashv  \Gamma'$}{}
\ottusedrule{\ottdrulecmdXXtyXXderefXXfield{}}
\ottusedrule{\ottdrulecmdXXtyXXderefXXvar{}}
\ottusedrule{\ottdrulecmdXXtyXXassign{}}
\ottusedrule{\ottdrulecmdXXtyXXassignXXvar{}}
\ottusedrule{\ottdrulecmdXXtyXXcreateXXvar{}}
\ottusedrule{\ottdrulecmdXXtyXXcall{}}
\ottusedrule{\ottdrulecmdXXtyXXnew{}}
\ottusedrule{\ottdrulecmdXXtyXXenter{}}
\ottusedrule{\ottdrulecmdXXtyXXenterXXvar{}}
\ottusedrule{\ottdrulecmdXXtyXXfreeze{}}
\ottusedrule{\ottdrulecmdXXtyXXmerge{}}
\ottusedrule{\ottdrulecmdXXtyXXsplit{}}
\ottusedrule{\ottdrulecmdXXtyXXsub{}}
\end{ottdefnblock}}

%% defn typing_dynexp_
\newcommand{\ottdrulecmdXXdynXXtyXXexpr}[1]{\ottdrule[#1]{%
\ottpremise{\Gamma  \vdash  \ottnt{e}  \ottsym{:}  \ottnt{t}  \dashv  \Gamma'}%
}{
 \varepsilon   \ottsym{::}  \Gamma  \vdash  \ottnt{e}  \ottsym{:}  \ottnt{t}  \dashv  \Gamma'}{%
{\ottdrulename{cmd\_dyn\_ty\_expr}}{}%
}}


\newcommand{\ottdrulecmdXXdynXXtyXXlet}[1]{\ottdrule[#1]{%
\ottpremise{\overline{\Gamma}  \ottsym{::}  \Gamma  \vdash  \ottnt{db}  \ottsym{:}  \ottnt{t}  \dashv  \Gamma'}%
\ottpremise{\Gamma'  \ottsym{,}  \ottmv{x}  \ottsym{:}  \ottnt{t}  \vdash  \ottnt{e}  \ottsym{:}  \ottnt{t'}  \dashv  \Gamma''  \ottsym{,}  \ottmv{x}  \ottsym{:}  \ottkw{\_}}%
}{
\overline{\Gamma}  \ottsym{::}  \Gamma  \vdash  \kw{let}\, \, \ottmv{x}  \ottsym{=}  \ottnt{db} \, \kw{in}\, \, \ottnt{e}  \ottsym{:}  \ottnt{t'}  \dashv  \Gamma''}{%
{\ottdrulename{cmd\_dyn\_ty\_let}}{}%
}}


\newcommand{\ottdrulecmdXXdynXXtyXXfailure}[1]{\ottdrule[#1]{%
}{
\overline{\Gamma}  \ottsym{::}  \Gamma  \vdash  \ottkw{Failure}  \ottsym{:}  \ottnt{t}  \dashv  \Gamma}{%
{\ottdrulename{cmd\_dyn\_ty\_failure}}{}%
}}

\newcommand{\ottdefncmdXXtypingXXdynexpXX}[1]{\begin{ottdefnblock}[#1]{$\overline{\Gamma}  \vdash  \ottnt{de}  \ottsym{:}  \ottnt{t}  \dashv  \Gamma'$}{}
\ottusedrule{\ottdrulecmdXXdynXXtyXXexpr{}}
\ottusedrule{\ottdrulecmdXXdynXXtyXXlet{}}
\ottusedrule{\ottdrulecmdXXdynXXtyXXfailure{}}
\end{ottdefnblock}}

%% defn typing_dynbound
\newcommand{\ottdrulecmdXXdynXXtyXXentered}[1]{\ottdrule[#1]{%
\ottpremise{ \textsf{open}(  \ottnt{k}  ) }%
\ottpremise{\ottkw{ftype} \, \ottsym{(}  \ottnt{CL}  \ottsym{,}  \ottnt{f}  \ottsym{)}  \ottsym{=}  \ottnt{t}}%
\ottpremise{  \textsf{cap}(   \textsf{iso}   ,  \ottnt{t}  )   \ottlinebreakhack }%
\ottpremise{\overline{\Gamma}  \ottsym{::}  \Gamma_{{\mathrm{1}}}  \vdash  \ottnt{de}  \ottsym{:}  \ottnt{t'}  \dashv  \Gamma'_{{\mathrm{1}}}  \ottsym{[}  \ottmv{y}  \ottsym{:}   \ottnt{k'}  ~   \texttt{Cell}[  \ottnt{t''}  ]    \ottsym{]}}%
\ottpremise{  \textsf{cap}( \{  \textsf{iso}   \ottsym{,}   \textsf{imm}  \},  \ottnt{t'}  )   \ottlinebreakhack }%
\ottpremise{ \ottnt{k'}  \in   \{   \textsf{tmp}   \ottsym{,}   \textsf{var}   \}  }%
\ottpremise{  \textsf{cap}(   \textsf{mut}   ,  \ottnt{t''}  )   \ottlinebreakhack }%
\ottpremise{ \ottnt{k''}  ~  \ottnt{CL''}   \ottsym{=}   \ensuremath{\begin{cases}    \textsf{var}   ~   \texttt{Cell}[   \mathit{make\_iso} (  \ottnt{t''}  )   ]    & \text{if }   \ottnt{k}  ~  \ottnt{CL}   \ottsym{=}    \textsf{var}   ~   \texttt{Cell}[  \ottkw{\_}  ]    \\   \ottnt{k}  ~  \ottnt{CL}   & \text{otherwise} \end{cases} } }%
}{
 \overline{\Gamma}  \ottsym{::}  \Gamma_{{\mathrm{1}}}  \underset{ \ottmv{x} . \ottnt{f} }{::}  \ottsym{(}  \Gamma_{{\mathrm{2}}}  \ottsym{[}  \ottmv{x}  \ottsym{:}   \ottnt{k}  ~  \ottnt{CL}   \ottsym{]}  \ottsym{)}   \vdash   \mathbf{entered}~ \ottmv{x}  \ottsym{.}  \ottnt{f} ~ \ottmv{y}  \ottsym{.}   \texttt{val}  ~ \{  \ottnt{de}  \}   \ottsym{:}  \ottnt{t'}  \dashv  \Gamma_{{\mathrm{2}}}  \ottsym{[}  \ottmv{x}  \ottsym{:}   \ottnt{k''}  ~  \ottnt{CL''}   \ottsym{]}}{%
{\ottdrulename{cmd\_dyn\_ty\_entered}}{}%
}}


\newcommand{\ottdrulecmdXXdynXXtyXXsub}[1]{\ottdrule[#1]{%
\ottpremise{\overline{\Gamma}  \vdash  \ottnt{b}  \ottsym{:}  \ottnt{t_{{\mathrm{1}}}}  \dashv  \Gamma_{{\mathrm{2}}}}%
\ottpremise{\ottnt{t_{{\mathrm{1}}}}  \ottsym{<:}  \ottnt{t_{{\mathrm{2}}}}}%
}{
\overline{\Gamma}  \vdash  \ottnt{b}  \ottsym{:}  \ottnt{t_{{\mathrm{2}}}}  \dashv  \Gamma_{{\mathrm{2}}}}{%
{\ottdrulename{cmd\_dyn\_ty\_sub}}{}%
}}


\newcommand{\ottdrulecmdXXdynXXtyXXsplit}[1]{\ottdrule[#1]{%
\ottpremise{\overline{\Gamma}  \ottsym{[}  \ottmv{x}  \ottsym{:}  \ottnt{t}  \ottsym{]}  \vdash  \ottnt{b}  \ottsym{:}  \ottnt{t_{{\mathrm{1}}}}  \dashv  \Gamma_{{\mathrm{2}}}}%
\ottpremise{\overline{\Gamma}  \ottsym{[}  \ottmv{x}  \ottsym{:}  \ottnt{t'}  \ottsym{]}  \vdash  \ottnt{b}  \ottsym{:}  \ottnt{t'_{{\mathrm{1}}}}  \dashv  \Gamma'_{{\mathrm{2}}}}%
}{
\overline{\Gamma}  \ottsym{[}  \ottmv{x}  \ottsym{:}   \ottnt{t}  \mathop{|}  \ottnt{t'}   \ottsym{]}  \vdash  \ottnt{b}  \ottsym{:}   \ottnt{t_{{\mathrm{1}}}}  \mathop{|}  \ottnt{t'_{{\mathrm{1}}}}   \dashv   \Gamma_{{\mathrm{2}}}  \mathop{|}  \Gamma'_{{\mathrm{2}}} }{%
{\ottdrulename{cmd\_dyn\_ty\_split}}{}%
}}

\newcommand{\ottdefncmdXXtypingXXdynbound}[1]{\begin{ottdefnblock}[#1]{$\overline{\Gamma}  \vdash  \ottnt{db}  \ottsym{:}  \ottnt{t}  \dashv  \Gamma'$}{}
\ottusedrule{\ottdrulecmdXXdynXXtyXXentered{}}
\ottusedrule{\ottdrulecmdXXdynXXtyXXsub{}}
\ottusedrule{\ottdrulecmdXXdynXXtyXXsplit{}}
\end{ottdefnblock}}


\newcommand{\ottdefnsCommand}{
\ottdefncmdXXexpXXstep{}\ottdefncmdXXtypingXX{}\ottdefncmdXXtypingXXbXX{}\ottdefncmdXXtypingXXdynexpXX{}\ottdefncmdXXtypingXXdynbound{}}

% defns Typing
%% defn wf_gamma_
\newcommand{\ottdrulewfXXctxXXcons}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x} \, \not\in \, \mathit{dom} \, \ottsym{(}  \Gamma  \ottsym{)}}%
\ottpremise{\vdash  \ottnt{t}}%
\ottpremise{\vdash  \Gamma}%
}{
\vdash  \Gamma  \ottsym{,}  \ottmv{x}  \ottsym{:}  \ottnt{t}}{%
{\ottdrulename{wf\_ctx\_cons}}{}%
}}


\newcommand{\ottdrulewfXXctxXXconsXXundef}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x} \, \not\in \, \mathit{dom} \, \ottsym{(}  \Gamma  \ottsym{)}}%
\ottpremise{\vdash  \Gamma}%
}{
\vdash  \Gamma  \ottsym{,}  \ottmv{x}  \ottsym{:} \, \mathbf{undef}}{%
{\ottdrulename{wf\_ctx\_cons\_undef}}{}%
}}


\newcommand{\ottdrulewfXXctxXXempty}[1]{\ottdrule[#1]{%
}{
\vdash   \varepsilon }{%
{\ottdrulename{wf\_ctx\_empty}}{}%
}}

\newcommand{\ottdefnwfXXgammaXX}[1]{\begin{ottdefnblock}[#1]{$\vdash  \Gamma$}{}
\ottusedrule{\ottdrulewfXXctxXXcons{}}
\ottusedrule{\ottdrulewfXXctxXXconsXXundef{}}
\ottusedrule{\ottdrulewfXXctxXXempty{}}
\end{ottdefnblock}}

%% defn wf_gammas_
\newcommand{\ottdrulewfXXdynXXctxXXcons}[1]{\ottdrule[#1]{%
\ottpremise{\vdash  \Gamma_{{\mathrm{1}}}}%
\ottpremise{\vdash  \Gamma_{{\mathrm{2}}}}%
\ottpremise{\Gamma_{{\mathrm{2}}}  \ottsym{(}  \ottmv{x}  \ottsym{)}  \ottsym{=}  \ottnt{t}}%
\ottpremise{ \vdash  \overline{\Gamma}  \ottlinebreakhack }%
\ottpremise{ \forall     \ottnt{k}  ~   C    \in  \ottnt{t}   . ~  \ottsym{(}  \ottkw{ftype} \, \ottsym{(}   C   \ottsym{,}  \ottnt{f}  \ottsym{)}  \ottsym{=}  \ottnt{t'}  \land   \textsf{cap}(   \textsf{iso}   ,  \ottnt{t'}  )   \ottsym{)} }%
}{
\vdash   \Gamma_{{\mathrm{1}}}  \underset{ \ottmv{x} . \ottnt{f} }{::}  \Gamma_{{\mathrm{2}}}  \ottsym{::}  \overline{\Gamma} }{%
{\ottdrulename{wf\_dyn\_ctx\_cons}}{}%
}}


\newcommand{\ottdrulewfXXdynXXctxXXempty}[1]{\ottdrule[#1]{%
\ottpremise{\vdash  \Gamma}%
}{
\vdash   \Gamma  \underset{ \ottmv{x} . \ottnt{f} }{::}   \varepsilon  }{%
{\ottdrulename{wf\_dyn\_ctx\_empty}}{}%
}}

\newcommand{\ottdefnwfXXgammasXX}[1]{\begin{ottdefnblock}[#1]{$\vdash  \overline{\Gamma}$}{}
\ottusedrule{\ottdrulewfXXdynXXctxXXcons{}}
\ottusedrule{\ottdrulewfXXdynXXctxXXempty{}}
\end{ottdefnblock}}

%% defn wf_cap
\newcommand{\ottdrulecapXXmut}[1]{\ottdrule[#1]{%
}{
\vdash   \textsf{mut} }{%
{\ottdrulename{cap\_mut}}{}%
}}


\newcommand{\ottdrulecapXXvar}[1]{\ottdrule[#1]{%
}{
\vdash   \textsf{var} }{%
{\ottdrulename{cap\_var}}{}%
}}


\newcommand{\ottdrulecapXXtmp}[1]{\ottdrule[#1]{%
}{
\vdash   \textsf{tmp} }{%
{\ottdrulename{cap\_tmp}}{}%
}}


\newcommand{\ottdrulecapXXimm}[1]{\ottdrule[#1]{%
}{
\vdash   \textsf{imm} }{%
{\ottdrulename{cap\_imm}}{}%
}}


\newcommand{\ottdrulecapXXpaused}[1]{\ottdrule[#1]{%
}{
\vdash   \textsf{paused} }{%
{\ottdrulename{cap\_paused}}{}%
}}


\newcommand{\ottdrulecapXXiso}[1]{\ottdrule[#1]{%
}{
\vdash   \textsf{iso} }{%
{\ottdrulename{cap\_iso}}{}%
}}

\newcommand{\ottdefnwfXXcap}[1]{\begin{ottdefnblock}[#1]{$\vdash  \ottnt{k}$}{}
\ottusedrule{\ottdrulecapXXmut{}}
\ottusedrule{\ottdrulecapXXvar{}}
\ottusedrule{\ottdrulecapXXtmp{}}
\ottusedrule{\ottdrulecapXXimm{}}
\ottusedrule{\ottdrulecapXXpaused{}}
\ottusedrule{\ottdrulecapXXiso{}}
\end{ottdefnblock}}

%% defn wf_type
\newcommand{\ottdruletyXXclass}[1]{\ottdrule[#1]{%
\ottpremise{ \ottnt{k} \neq  \textsf{var}  }%
\ottpremise{  \mathbf{class}~C~\{  \ottnt{fdecls}  \} \in \mathit{prog}   \ottlinebreakhack }%
\ottpremise{ \forall    \ottnt{f}  \ottsym{:}  \ottnt{t}  \in  \ottnt{fdecls}   . ~   \forall     \ottnt{k'}  ~   C    \in  \ottnt{t}   . ~  \ottsym{(}  \ottnt{k'}  \ottsym{=}   \textsf{iso}   \lor  \vdash   \ottnt{k}  \mathop{\odot}  \ottnt{k'}   \ottsym{)}  }%
}{
\vdash   \ottnt{k}  ~   C  }{%
{\ottdrulename{ty\_class}}{}%
}}


\newcommand{\ottdruletyXXcell}[1]{\ottdrule[#1]{%
\ottpremise{\vdash  \ottnt{t}}%
}{
\vdash   \ottnt{k}  ~   \texttt{Cell}[  \ottnt{t}  ]  }{%
{\ottdrulename{ty\_cell}}{}%
}}


\newcommand{\ottdruletyXXdisj}[1]{\ottdrule[#1]{%
\ottpremise{\vdash  \ottnt{t_{{\mathrm{1}}}}}%
\ottpremise{\vdash  \ottnt{t_{{\mathrm{2}}}}}%
}{
\vdash   \ottnt{t_{{\mathrm{1}}}}  \mathop{|}  \ottnt{t_{{\mathrm{2}}}} }{%
{\ottdrulename{ty\_disj}}{}%
}}

\newcommand{\ottdefnwfXXtype}[1]{\begin{ottdefnblock}[#1]{$\vdash  \ottnt{t}$}{}
\ottusedrule{\ottdruletyXXclass{}}
\ottusedrule{\ottdruletyXXcell{}}
\ottusedrule{\ottdruletyXXdisj{}}
\end{ottdefnblock}}

%% defn subtype
\newcommand{\ottdrulesubXXrefl}[1]{\ottdrule[#1]{%
\ottpremise{\vdash  \ottnt{t}}%
}{
\ottnt{t}  \ottsym{<:}  \ottnt{t}}{%
{\ottdrulename{sub\_refl}}{}%
}}


\newcommand{\ottdrulesubXXdisjXXrightXXOne}[1]{\ottdrule[#1]{%
\ottpremise{\ottnt{t_{{\mathrm{1}}}}  \ottsym{<:}  \ottnt{t_{{\mathrm{2}}}}}%
}{
\ottnt{t_{{\mathrm{1}}}}  \ottsym{<:}   \ottnt{t_{{\mathrm{2}}}}  \mathop{|}  \ottnt{t_{{\mathrm{3}}}} }{%
{\ottdrulename{sub\_disj\_right\_1}}{}%
}}


\newcommand{\ottdrulesubXXdisjXXrightXXTwo}[1]{\ottdrule[#1]{%
\ottpremise{\ottnt{t_{{\mathrm{1}}}}  \ottsym{<:}  \ottnt{t_{{\mathrm{3}}}}}%
}{
\ottnt{t_{{\mathrm{1}}}}  \ottsym{<:}   \ottnt{t_{{\mathrm{2}}}}  \mathop{|}  \ottnt{t_{{\mathrm{3}}}} }{%
{\ottdrulename{sub\_disj\_right\_2}}{}%
}}


\newcommand{\ottdrulesubXXdisjXXleft}[1]{\ottdrule[#1]{%
\ottpremise{\ottnt{t_{{\mathrm{1}}}}  \ottsym{<:}  \ottnt{t_{{\mathrm{3}}}}}%
\ottpremise{\ottnt{t_{{\mathrm{2}}}}  \ottsym{<:}  \ottnt{t_{{\mathrm{3}}}}}%
}{
 \ottnt{t_{{\mathrm{1}}}}  \mathop{|}  \ottnt{t_{{\mathrm{2}}}}   \ottsym{<:}  \ottnt{t_{{\mathrm{3}}}}}{%
{\ottdrulename{sub\_disj\_left}}{}%
}}


\newcommand{\ottdrulesubXXcell}[1]{\ottdrule[#1]{%
\ottpremise{\ottnt{t_{{\mathrm{1}}}}  \ottsym{<:}  \ottnt{t_{{\mathrm{2}}}}}%
\ottpremise{\ottnt{t_{{\mathrm{2}}}}  \ottsym{<:}  \ottnt{t_{{\mathrm{1}}}}}%
}{
 \ottnt{k}  ~   \texttt{Cell}[  \ottnt{t_{{\mathrm{1}}}}  ]    \ottsym{<:}   \ottnt{k}  ~   \texttt{Cell}[  \ottnt{t_{{\mathrm{2}}}}  ]  }{%
{\ottdrulename{sub\_cell}}{}%
}}

\newcommand{\ottdefnsubtype}[1]{\begin{ottdefnblock}[#1]{$\ottnt{t_{{\mathrm{1}}}}  \ottsym{<:}  \ottnt{t_{{\mathrm{2}}}}$}{}
\ottusedrule{\ottdrulesubXXrefl{}}
\ottusedrule{\ottdrulesubXXdisjXXrightXXOne{}}
\ottusedrule{\ottdrulesubXXdisjXXrightXXTwo{}}
\ottusedrule{\ottdrulesubXXdisjXXleft{}}
\ottusedrule{\ottdrulesubXXcell{}}
\end{ottdefnblock}}

%% defn subtag
\newcommand{\ottdrulesubtagXXclass}[1]{\ottdrule[#1]{%
}{
 \# \ottmv{C}   \subtag   C }{%
{\ottdrulename{subtag\_class}}{}%
}}


\newcommand{\ottdrulesubtagXXcell}[1]{\ottdrule[#1]{%
}{
 \texttt{\#Cell}   \subtag   \texttt{Cell}[  \ottnt{t}  ] }{%
{\ottdrulename{subtag\_cell}}{}%
}}

\newcommand{\ottdefnsubtag}[1]{\begin{ottdefnblock}[#1]{$\#CL  \subtag  \ottnt{CL}$}{}
\ottusedrule{\ottdrulesubtagXXclass{}}
\ottusedrule{\ottdrulesubtagXXcell{}}
\end{ottdefnblock}}


\newcommand{\ottdefnsTyping}{
\ottdefnwfXXgammaXX{}\ottdefnwfXXgammasXX{}\ottdefnwfXXcap{}\ottdefnwfXXtype{}\ottdefnsubtype{}\ottdefnsubtag{}}

% defns WellFormedness
%% defn wf_ccfg
\newcommand{\ottdrulewfXXccfg}[1]{\ottdrule[#1]{%
\ottpremise{ \exists   \Gamma'  \ottsym{,}  \ottnt{t}  . ~  \overline{\Gamma}  \vdash  \ottnt{de}  \ottsym{:}  \ottnt{t}  \dashv  \Gamma' }%
}{
\overline{\Gamma}  \vdash  \,\startblock\,  \ottnt{de}  \,\finishblock\,}{%
{\ottdrulename{wf\_ccfg}}{}%
}}

\newcommand{\ottdefnwfXXwfXXccfg}[1]{\begin{ottdefnblock}[#1]{$\overline{\Gamma}  \vdash  \ottnt{ccfg}$}{}
\ottusedrule{\ottdrulewfXXccfg{}}
\end{ottdefnblock}}

%% defn wf_rcfg
\newcommand{\ottdrulewfXXrcfg}[1]{\ottdrule[#1]{%
\ottpremise{  \exists   \Delta  \ottsym{,}  \Psi  . ~  \overline{\Gamma}  \ottsym{;}  \Delta  \ottsym{;}  \Psi  \vdash  \ottnt{rcfg}   \ottlinebreakhack }%
\ottpremise{ \mathsf{capability\_ok} \, \ottsym{(}  \overline{\Gamma}  \ottsym{,}  \ottnt{rcfg}  \ottsym{)}  \ottlinebreakhack }%
\ottpremise{\mathsf{topology\_ok} \, \ottsym{(}  \overline{\Gamma}  \ottsym{,}  \ottnt{rcfg}  \ottsym{)}}%
}{
\overline{\Gamma}  \vdash  \ottnt{rcfg}}{%
{\ottdrulename{wf\_rcfg}}{}%
}}

\newcommand{\ottdefnwfXXwfXXrcfg}[1]{\begin{ottdefnblock}[#1]{$\overline{\Gamma}  \vdash  \ottnt{rcfg}$}{}
\ottusedrule{\ottdrulewfXXrcfg{}}
\end{ottdefnblock}}

%% defn wf_de
\newcommand{\ottdrulewfXXde}[1]{\ottdrule[#1]{%
\ottpremise{ \exists   \Gamma'  \ottsym{,}  \ottnt{t}  . ~  \overline{\Gamma}  \vdash  \ottnt{de}  \ottsym{:}  \ottnt{t}  \dashv  \Gamma' }%
}{
\overline{\Gamma}  \vdash  \ottnt{de}}{%
{\ottdrulename{wf\_de}}{}%
}}

\newcommand{\ottdefnwfXXwfXXde}[1]{\begin{ottdefnblock}[#1]{$\overline{\Gamma}  \vdash  \ottnt{de}$}{}
\ottusedrule{\ottdrulewfXXde{}}
\end{ottdefnblock}}

%% defn wf_psi_delta_rcfg
\newcommand{\ottdrulewfXXtyXXrcfg}[1]{\ottdrule[#1]{%
\ottpremise{\Delta_{RS}  \uplus  \Delta_{op}  \uplus  \Delta_{cl}  \uplus  \Delta_{fr}  \ottsym{=}  \Delta}%
\ottpremise{\Psi_{op}  \uplus  \Psi_{cl}  \uplus  \Psi_{fr}  \ottsym{=}  \Psi}%
\ottpremise{ \overline{\Gamma}  \ottsym{;}  \Delta  \ottsym{;}  \Delta_{RS}  \ottsym{;}  \Psi_{op}  \vdash  \ottnt{RS}  \ottlinebreakhack }%
\ottpremise{\Delta  \ottsym{;}  \Delta_{op}  \ottsym{;}  \Psi_{op}  \vdash  H_{\mathit{op} }}%
\ottpremise{\Delta  \ottsym{;}  \Delta_{cl}  \ottsym{;}  \Psi_{cl}  \vdash  H_{\mathit{cl} }}%
\ottpremise{\Delta  \ottsym{;}  \Delta_{fr}  \ottsym{;}  \Psi_{fr}  \vdash  H_{\mathit{fr} }}%
}{
\overline{\Gamma}  \ottsym{;}  \Delta  \ottsym{;}  \Psi  \vdash  \langle  \ottnt{RS}  \ottsym{;}  H_{\mathit{op} }  \ottsym{;}  H_{\mathit{cl} }  \ottsym{;}  H_{\mathit{fr} }  \rangle}{%
{\ottdrulename{wf\_ty\_rcfg}}{}%
}}

\newcommand{\ottdefnwfXXwfXXpsiXXdeltaXXrcfg}[1]{\begin{ottdefnblock}[#1]{$\overline{\Gamma}  \ottsym{;}  \Delta  \ottsym{;}  \Psi  \vdash  \ottnt{rcfg}$}{}
\ottusedrule{\ottdrulewfXXtyXXrcfg{}}
\end{ottdefnblock}}

%% defn wf_rs
\newcommand{\ottdrulewfXXrsXXcons}[1]{\ottdrule[#1]{%
\ottpremise{\Delta'  \ottsym{=}  \Delta_{{\mathrm{1}}}  \uplus  \Delta_{{\mathrm{2}}}}%
\ottpremise{ \Delta  \ottsym{;}  \Delta_{{\mathrm{1}}}  \vdash  \ottnt{S}  \ottlinebreakhack }%
\ottpremise{\Delta  \ottsym{;}  \Gamma  \vdash  \ottnt{F}}%
\ottpremise{\overline{\Gamma}  \ottsym{;}  \Delta  \ottsym{;}  \Delta_{{\mathrm{2}}}  \ottsym{;}  \Psi  \vdash  \ottnt{RS}}%
}{
\Gamma  \ottsym{::}  \overline{\Gamma}  \ottsym{;}  \Delta  \ottsym{;}  \Delta'  \ottsym{;}  \ottmv{r}  \ottsym{,}  \Psi  \vdash   \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{,}  \ottnt{F}  \ottsym{)}  \mathop{::}  \ottnt{RS} }{%
{\ottdrulename{wf\_rs\_cons}}{}%
}}


\newcommand{\ottdrulewfXXrsXXnil}[1]{\ottdrule[#1]{%
\ottpremise{\vdash  \Delta}%
}{
 \varepsilon_{\overline{\Gamma} }   \ottsym{;}  \Delta  \ottsym{;}   \varepsilon_{\Delta}   \ottsym{;}   \varepsilon_{\Psi}   \vdash   \varepsilon_{RS} }{%
{\ottdrulename{wf\_rs\_nil}}{}%
}}

\newcommand{\ottdefnwfXXwfXXrs}[1]{\begin{ottdefnblock}[#1]{$\overline{\Gamma}  \ottsym{;}  \Delta  \ottsym{;}  \Delta'  \ottsym{;}  \Psi  \vdash  \ottnt{RS}$}{}
\ottusedrule{\ottdrulewfXXrsXXcons{}}
\ottusedrule{\ottdrulewfXXrsXXnil{}}
\end{ottdefnblock}}

%% defn wf_delta

\newcommand{\ottdefnwfXXwfXXdelta}[1]{\begin{ottdefnblock}[#1]{$\vdash  \Delta$}{}
\end{ottdefnblock}}

%% defn wf_H
\newcommand{\ottdrulewfXXheapXXprod}[1]{\ottdrule[#1]{%
\ottpremise{\Delta_{{\mathrm{1}}}  \uplus  \Delta_{{\mathrm{2}}}  \ottsym{=}  \Delta'}%
\ottpremise{ \Psi_{{\mathrm{1}}}  \uplus  \Psi_{{\mathrm{2}}}  \ottsym{=}  \Psi  \ottlinebreakhack }%
\ottpremise{\Delta  \ottsym{;}  \Delta_{{\mathrm{1}}}  \ottsym{;}  \Psi_{{\mathrm{1}}}  \vdash  H_{{\mathrm{1}}}}%
\ottpremise{\Delta  \ottsym{;}  \Delta_{{\mathrm{2}}}  \ottsym{;}  \Psi_{{\mathrm{2}}}  \vdash  H_{{\mathrm{2}}}}%
}{
\Delta  \ottsym{;}  \Delta'  \ottsym{;}  \Psi  \vdash  H_{{\mathrm{1}}}  \ottsym{*}  H_{{\mathrm{2}}}}{%
{\ottdrulename{wf\_heap\_prod}}{}%
}}


\newcommand{\ottdrulewfXXheapXXsing}[1]{\ottdrule[#1]{%
\ottpremise{\Delta  \ottsym{;}  \Delta'  \vdash  \ottnt{S}}%
}{
\Delta  \ottsym{;}  \Delta'  \ottsym{;}  \ottmv{r}  \vdash  \ottsym{(}  \ottmv{r}  \ottsym{,}  \ottnt{S}  \ottsym{)}}{%
{\ottdrulename{wf\_heap\_sing}}{}%
}}

\newcommand{\ottdefnwfXXwfXXH}[1]{\begin{ottdefnblock}[#1]{$\Delta  \ottsym{;}  \Delta'  \ottsym{;}  \Psi  \vdash  H$}{}
\ottusedrule{\ottdrulewfXXheapXXprod{}}
\ottusedrule{\ottdrulewfXXheapXXsing{}}
\end{ottdefnblock}}

%% defn wf_subheap
\newcommand{\ottdrulewfXXsubheapXXcons}[1]{\ottdrule[#1]{%
\ottpremise{ \iota  \ottsym{:}  \ottnt{CL}  \in  \Delta }%
\ottpremise{\#CL  \subtag  \ottnt{CL}}%
\ottpremise{\Delta  \ottsym{;}  \ottkw{ftypes} \, \ottsym{(}  \ottnt{CL}  \ottsym{)}  \vdash  \ottnt{F}}%
\ottpremise{\Delta  \ottsym{;}  \Delta'  \vdash  \ottnt{S}}%
}{
\Delta  \ottsym{;}  \Delta'  \ottsym{,}  \iota  \ottsym{:}  \ottnt{CL}  \vdash  \ottnt{S}  \ottsym{,}  \iota  \mapsto  \ottsym{(}  \#CL  \ottsym{,}  \ottnt{F}  \ottsym{)}}{%
{\ottdrulename{wf\_subheap\_cons}}{}%
}}


\newcommand{\ottdrulewfXXsubheapXXnil}[1]{\ottdrule[#1]{%
}{
\Delta  \ottsym{;}   \varepsilon_{\Delta}   \vdash   \varepsilon_{S} }{%
{\ottdrulename{wf\_subheap\_nil}}{}%
}}

\newcommand{\ottdefnwfXXwfXXsubheap}[1]{\begin{ottdefnblock}[#1]{$\Delta  \ottsym{;}  \Delta'  \vdash  \ottnt{S}$}{}
\ottusedrule{\ottdrulewfXXsubheapXXcons{}}
\ottusedrule{\ottdrulewfXXsubheapXXnil{}}
\end{ottdefnblock}}

%% defn wf_F
\newcommand{\ottdrulewfXXvarsXXcons}[1]{\ottdrule[#1]{%
\ottpremise{ \iota  \ottsym{:}  \ottnt{CL}  \in  \Delta }%
\ottpremise{ \ottnt{k}  ~  \ottnt{CL}   \ottsym{<:}  \ottnt{t}}%
\ottpremise{\ottmv{x} \, \not\in \, \mathit{dom} \, \ottsym{(}  \ottnt{F}  \ottsym{)}}%
}{
\Delta  \ottsym{;}  \Gamma  \ottsym{,}  \ottmv{x}  \ottsym{:}  \ottnt{t}  \vdash  \ottnt{F}  \ottsym{,}  \ottmv{x}  \mapsto  \ottsym{(}  \ottnt{k}  \ottsym{,}  \iota  \ottsym{)}}{%
{\ottdrulename{wf\_vars\_cons}}{}%
}}


\newcommand{\ottdrulewfXXvarsXXconsXXundef}[1]{\ottdrule[#1]{%
\ottpremise{\Delta  \ottsym{;}  \Gamma  \vdash  \ottnt{F}}%
\ottpremise{\ottmv{x} \, \not\in \, \mathit{dom} \, \ottsym{(}  \ottnt{F}  \ottsym{)}}%
}{
\Delta  \ottsym{;}  \Gamma  \ottsym{,}  \ottmv{x}  \ottsym{:} \, \mathbf{undef}  \vdash  \ottnt{F}  \ottsym{,}  \ottmv{x}  \mapsto \, \mathbf{undef}}{%
{\ottdrulename{wf\_vars\_cons\_undef}}{}%
}}


\newcommand{\ottdrulewfXXvarsXXnil}[1]{\ottdrule[#1]{%
}{
\Delta  \ottsym{;}   \varepsilon   \vdash   \varepsilon_{F} }{%
{\ottdrulename{wf\_vars\_nil}}{}%
}}

\newcommand{\ottdefnwfXXwfXXF}[1]{\begin{ottdefnblock}[#1]{$\Delta  \ottsym{;}  \Gamma  \vdash  \ottnt{F}$}{}
\ottusedrule{\ottdrulewfXXvarsXXcons{}}
\ottusedrule{\ottdrulewfXXvarsXXconsXXundef{}}
\ottusedrule{\ottdrulewfXXvarsXXnil{}}
\end{ottdefnblock}}

%% defn wf_eff
\newcommand{\ottdrulewfXXeffXXeps}[1]{\ottdrule[#1]{%
}{
\overline{\Gamma}  \vdash   \epsilon   \dashv  \overline{\Gamma}}{%
{\ottdrulename{wf\_eff\_eps}}{}%
}}


\newcommand{\ottdrulewfXXeffXXenter}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{w} \, \mathit{fresh}}%
\ottpremise{ \forall    \ottmv{i}  \in [1,  \ottmv{n}  ]   . ~  \ottmv{x_{\ottmv{i}}} \, \mathit{fresh} }%
\ottpremise{  \forall    \ottmv{i}  \in [1,  \ottmv{n}  ]   . ~  \Gamma_{\ottmv{i}}  \vdash  \ottnt{use_{\ottmv{i}}}  \ottsym{:}  \ottnt{t_{\ottmv{i}}}  \dashv   \Gamma_{i+1}    \ottlinebreakhack }%
\ottpremise{ \Gamma_{n+1}   \ottsym{(}  \ottmv{y}  \ottsym{)}  \ottsym{=}   \ottnt{k'}  ~  \ottnt{CL} }%
\ottpremise{ \textsf{open}(  \ottnt{k'}  ) }%
\ottpremise{\ottkw{ftype} \, \ottsym{(}  \ottnt{CL}  \ottsym{,}  \ottnt{f}  \ottsym{)}  \ottsym{=}  \ottnt{t}}%
\ottpremise{  \textsf{cap}(   \textsf{iso}   ,  \ottnt{t}  )   \ottlinebreakhack }%
\ottpremise{ \ottnt{k}  \in   \{   \textsf{tmp}   \ottsym{,}   \textsf{var}   \}  }%
\ottpremise{\ottnt{k}  \ottsym{=}   \textsf{var}   \Rightarrow  \ottnt{k'}  \ottsym{=}   \textsf{var} }%
\ottpremise{ \ottnt{t'}  \ottsym{=}   \mathit{make\_mut} (  \ottnt{t}  )   \ottlinebreakhack }%
\ottpremise{  \Gamma  \ottsym{=}  \ottmv{y_{{\mathrm{1}}}}  \ottsym{:}  \ottnt{t'_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{y_{\ottmv{n}}}  \ottsym{:}  \ottnt{t'_{\ottmv{n}}}  \text{~~where~~}  \ottnt{t'_{\ottmv{i}}}  \ottsym{=}   \ensuremath{\begin{cases}  \ottnt{t_{\ottmv{i}}}  & \text{if }   \textsf{cap}(   \textsf{iso}   ,  \ottnt{t_{\ottmv{i}}}  )   \\    \textsf{paused}   \mathop{\odot}  \ottnt{t_{\ottmv{i}}}   & \text{otherwise} \end{cases} }    \ottlinebreakhack }%
\ottpremise{\Gamma'  \ottsym{=}  \Gamma  \ottsym{,}  \ottmv{z}  \ottsym{:}   \ottnt{k}  ~   \texttt{Cell}[  \ottnt{t'}  ]  }%
}{
\Gamma_{{\mathrm{1}}}  \ottsym{::}  \overline{\Gamma}  \vdash  \mathit{enter} \, \ottsym{(}  \ottmv{w}  \ottsym{,}  \ottnt{k}  \ottsym{,}  \ottmv{y}  \ottsym{.}  \ottnt{f}  \ottsym{,}  \ottmv{x_{{\mathrm{1}}}}  \ottsym{=}  \ottnt{use_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{x_{\ottmv{n}}}  \ottsym{=}  \ottnt{use_{\ottmv{n}}}  \ottsym{)}  \dashv  \Gamma'  \ottsym{::}   \Gamma_{n+1}   \ottsym{::}  \overline{\Gamma}}{%
{\ottdrulename{wf\_eff\_enter}}{}%
}}


\newcommand{\ottdrulewfXXeffXXbadenter}[1]{\ottdrule[#1]{%
\ottpremise{\Gamma  \ottsym{(}  \ottmv{y}  \ottsym{)}  \ottsym{=}   \ottnt{k}  ~  \ottnt{CL} }%
\ottpremise{  \textsf{open}(  \ottnt{k}  )   \ottlinebreakhack }%
\ottpremise{\ottkw{ftype} \, \ottsym{(}  \ottnt{CL}  \ottsym{,}  \ottnt{f}  \ottsym{)}  \ottsym{=}  \ottnt{t}}%
\ottpremise{ \textsf{cap}(   \textsf{iso}   ,  \ottnt{t}  ) }%
}{
\Gamma_{{\mathrm{1}}}  \ottsym{::}  \overline{\Gamma}  \vdash   \textit{badenter}( \ottmv{y} . \ottnt{f} )   \dashv  \Gamma_{{\mathrm{1}}}  \ottsym{::}  \overline{\Gamma}}{%
{\ottdrulename{wf\_eff\_badenter}}{}%
}}


\newcommand{\ottdrulewfXXeffXXexit}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x} \, \mathit{fresh}}%
\ottpremise{ \textsf{open}(  \ottnt{k}  ) }%
\ottpremise{\Gamma'  \vdash  \ottnt{use}  \ottsym{:}  \ottnt{t}  \dashv  \Gamma''}%
\ottpremise{  \textsf{cap}( \{  \textsf{iso}   \ottsym{,}   \textsf{imm}  \},  \ottnt{t}  )   \ottlinebreakhack }%
\ottpremise{\Gamma''  \ottsym{(}  \ottmv{w}  \ottsym{)}  \ottsym{=}   \ottnt{k'}  ~  \ottnt{CL'} }%
\ottpremise{\ottkw{ftype} \, \ottsym{(}  \ottnt{CL'}  \ottsym{,}  \ottnt{g}  \ottsym{)}  \ottsym{=}  \ottnt{t'}}%
\ottpremise{  \textsf{cap}(   \textsf{mut}   ,  \ottnt{t'}  )   \ottlinebreakhack }%
\ottpremise{ \ottnt{k'}  \in   \{   \textsf{tmp}   \ottsym{,}   \textsf{var}   \}  }%
\ottpremise{  \textsf{cap}(   \textsf{iso}   ,  \ottkw{ftype} \, \ottsym{(}  \ottnt{CL}  \ottsym{,}  \ottnt{f}  \ottsym{)}  )   \ottlinebreakhack }%
\ottpremise{ \ottnt{k''}  ~  \ottnt{CL''}   \ottsym{=}   \ensuremath{\begin{cases}    \textsf{var}   ~   \texttt{Cell}[   \mathit{make\_iso} (  \ottnt{t'}  )   ]    & \text{if }   \ottnt{k}  ~  \ottnt{CL}   \ottsym{=}    \textsf{var}   ~   \texttt{Cell}[  \ottkw{\_}  ]    \\   \ottnt{k}  ~  \ottnt{CL}   & \text{otherwise} \end{cases} } }%
}{
 \Gamma'  \underset{ \ottmv{y} . \ottnt{f} }{::}  \Gamma  \ottsym{[}  \ottmv{y}  \ottsym{:}   \ottnt{k}  ~  \ottnt{CL}   \ottsym{]}  \ottsym{::}  \overline{\Gamma}   \vdash  \mathit{exit} \, \ottsym{(}  \ottmv{x}  \ottsym{,}  \ottnt{use}  \ottsym{,}  \ottmv{y}  \ottsym{.}  \ottnt{f}  \ottsym{,}  \ottmv{w}  \ottsym{.}  \ottnt{g}  \ottsym{)}  \dashv  \Gamma  \ottsym{[}  \ottmv{y}  \ottsym{:}   \ottnt{k''}  ~  \ottnt{CL''}   \ottsym{]}  \ottsym{,}  \ottmv{x}  \ottsym{:}  \ottnt{t}  \ottsym{::}  \overline{\Gamma}}{%
{\ottdrulename{wf\_eff\_exit}}{}%
}}


\newcommand{\ottdrulewfXXeffXXload}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x} \, \mathit{fresh}}%
\ottpremise{\Gamma  \ottsym{(}  \ottmv{y}  \ottsym{)}  \ottsym{=}   \ottnt{k}  ~  \ottnt{CL} }%
\ottpremise{ \ottkw{ftype} \, \ottsym{(}  \ottnt{CL}  \ottsym{,}  \ottnt{f}  \ottsym{)}  \ottsym{=}  \ottnt{t}  \ottlinebreakhack }%
\ottpremise{ \ottnt{k} \neq  \textsf{iso}  }%
\ottpremise{\vdash   \ottnt{k}  \mathop{\odot}  \ottnt{t} }%
}{
\Gamma  \ottsym{::}  \overline{\Gamma}  \vdash  \mathit{load} \, \ottsym{(}  \ottmv{x}  \ottsym{,}  \ottmv{y}  \ottsym{.}  \ottnt{f}  \ottsym{)}  \dashv  \Gamma  \ottsym{,}  \ottmv{x}  \ottsym{:}   \ottnt{k}  \mathop{\odot}  \ottnt{t}   \ottsym{::}  \overline{\Gamma}}{%
{\ottdrulename{wf\_eff\_load}}{}%
}}


\newcommand{\ottdrulewfXXeffXXswapXXclass}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x} \, \mathit{fresh}}%
\ottpremise{\Gamma  \vdash  \ottnt{use}  \ottsym{:}  \ottnt{t}  \dashv  \Gamma'}%
\ottpremise{ \textsf{cap}( \{  \textsf{var}  \}^c,  \ottnt{t}  ) }%
\ottpremise{ \Gamma'  \ottsym{(}  \ottmv{y}  \ottsym{)}  \ottsym{=}   \ottnt{k}  ~  \ottnt{CL}   \ottlinebreakhack }%
\ottpremise{ \ottnt{k}  \in   \{   \textsf{mut}   \ottsym{,}   \textsf{tmp}   \}  }%
\ottpremise{\ottkw{ftype} \, \ottsym{(}  \ottnt{CL}  \ottsym{,}  \ottnt{f}  \ottsym{)}  \ottsym{=}  \ottnt{t}}%
}{
\Gamma  \ottsym{::}  \overline{\Gamma}  \vdash  \mathit{swap} \, \ottsym{(}  \ottmv{x}  \ottsym{,}  \ottmv{y}  \ottsym{.}  \ottnt{f}  \ottsym{,}  \ottnt{use}  \ottsym{)}  \dashv  \Gamma'  \ottsym{,}  \ottmv{x}  \ottsym{:}  \ottnt{t}  \ottsym{::}  \overline{\Gamma}}{%
{\ottdrulename{wf\_eff\_swap\_class}}{}%
}}


\newcommand{\ottdrulewfXXeffXXswapXXvar}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x} \, \mathit{fresh}}%
\ottpremise{\Gamma  \vdash  \ottnt{use}  \ottsym{:}  \ottnt{t}  \dashv  \Gamma'  \ottsym{[}  \ottmv{y}  \ottsym{:}    \textsf{var}   ~   \texttt{Cell}[  \ottnt{t'}  ]    \ottsym{]}}%
\ottpremise{ \textsf{cap}( \{  \textsf{var}  \}^c,  \ottnt{t}  ) }%
}{
\Gamma  \ottsym{::}  \overline{\Gamma}  \vdash  \mathit{swap} \, \ottsym{(}  \ottmv{x}  \ottsym{,}  \ottmv{y}  \ottsym{.}   \texttt{val}   \ottsym{,}  \ottnt{use}  \ottsym{)}  \dashv  \Gamma'  \ottsym{[}  \ottmv{y}  \ottsym{:}    \textsf{var}   ~   \texttt{Cell}[  \ottnt{t}  ]    \ottsym{]}  \ottsym{,}  \ottmv{x}  \ottsym{:}  \ottnt{t'}  \ottsym{::}  \overline{\Gamma}}{%
{\ottdrulename{wf\_eff\_swap\_var}}{}%
}}


\newcommand{\ottdrulewfXXeffXXhallocXXmut}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x} \, \mathit{fresh}}%
\ottpremise{\vdash    \textsf{mut}   ~   C  }%
\ottpremise{ \ottkw{ftypes} \, \ottsym{(}   C   \ottsym{)}  \ottsym{=}  \ottnt{f_{{\mathrm{1}}}}  \ottsym{:}  \ottnt{t_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottnt{f_{\ottmv{n}}}  \ottsym{:}  \ottnt{t_{\ottmv{n}}}  \ottlinebreakhack }%
\ottpremise{ \forall    \ottmv{i}  \in [1,  \ottmv{n}  ]   . ~  \Gamma_{\ottmv{i}}  \vdash  \ottnt{use_{\ottmv{i}}}  \ottsym{:}  \ottnt{t_{\ottmv{i}}}  \dashv   \Gamma_{i+1}  }%
}{
\Gamma_{{\mathrm{1}}}  \ottsym{::}  \overline{\Gamma}  \vdash   \textit{halloc} (  \ottmv{x} ,   \textsf{mut}  , \# \ottmv{C} ,  \ottnt{use_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottnt{use_{\ottmv{n}}}  )   \dashv   \Gamma_{n+1}   \ottsym{,}  \ottmv{x}  \ottsym{:}    \textsf{mut}   ~   C    \ottsym{::}  \overline{\Gamma}}{%
{\ottdrulename{wf\_eff\_halloc\_mut}}{}%
}}


\newcommand{\ottdrulewfXXeffXXhallocXXiso}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x} \, \mathit{fresh}}%
\ottpremise{\vdash    \textsf{iso}   ~   C  }%
\ottpremise{ \ottkw{ftypes} \, \ottsym{(}   C   \ottsym{)}  \ottsym{=}  \ottnt{f_{{\mathrm{1}}}}  \ottsym{:}  \ottnt{t_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottnt{f_{\ottmv{n}}}  \ottsym{:}  \ottnt{t_{\ottmv{n}}}  \ottlinebreakhack }%
\ottpremise{ \forall    \ottmv{i}  \in [1,  \ottmv{n}  ]   . ~  \ottsym{(}   \textsf{cap}( \{  \textsf{iso}   \ottsym{,}   \textsf{imm}  \},  \ottnt{t'_{\ottmv{i}}}  )   \land  \Gamma_{\ottmv{i}}  \vdash  \ottnt{use_{\ottmv{i}}}  \ottsym{:}  \ottnt{t'_{\ottmv{i}}}  \dashv   \Gamma_{i+1}   \land  \ottnt{t'_{\ottmv{i}}}  \ottsym{<:}  \ottnt{t_{\ottmv{i}}}  \ottsym{)} }%
}{
\Gamma_{{\mathrm{1}}}  \ottsym{::}  \overline{\Gamma}  \vdash   \textit{halloc} (  \ottmv{x} ,   \textsf{iso}  , \# \ottmv{C} ,  \ottnt{use_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottnt{use_{\ottmv{n}}}  )   \dashv   \Gamma_{n+1}   \ottsym{,}  \ottmv{x}  \ottsym{:}    \textsf{iso}   ~   C    \ottsym{::}  \overline{\Gamma}}{%
{\ottdrulename{wf\_eff\_halloc\_iso}}{}%
}}


\newcommand{\ottdrulewfXXeffXXsalloc}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x} \, \mathit{fresh}}%
\ottpremise{ \ottnt{k}  \in   \{   \textsf{tmp}   \ottsym{,}   \textsf{var}   \}  }%
\ottpremise{\vdash   \ottnt{k}  ~  \ottnt{CL} }%
\ottpremise{ \ottkw{ftypes} \, \ottsym{(}   C   \ottsym{)}  \ottsym{=}  \ottnt{f_{{\mathrm{1}}}}  \ottsym{:}  \ottnt{t_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottnt{f_{\ottmv{n}}}  \ottsym{:}  \ottnt{t_{\ottmv{n}}}  \ottlinebreakhack }%
\ottpremise{ \forall    \ottmv{i}  \in [1,  \ottmv{n}  ]   . ~  \Gamma_{\ottmv{i}}  \vdash  \ottnt{use_{\ottmv{i}}}  \ottsym{:}  \ottnt{t_{\ottmv{i}}}  \dashv   \Gamma_{i+1}  }%
}{
\Gamma_{{\mathrm{1}}}  \ottsym{::}  \overline{\Gamma}  \vdash   \textit{salloc} (  \ottmv{x} ,  \ottnt{k} ,  \#CL ,  \ottnt{use_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottnt{use_{\ottmv{n}}}  )   \dashv   \Gamma_{n+1}   \ottsym{,}  \ottmv{x}  \ottsym{:}   \ottnt{k}  ~  \ottnt{CL}   \ottsym{::}  \overline{\Gamma}}{%
{\ottdrulename{wf\_eff\_salloc}}{}%
}}


\newcommand{\ottdrulewfXXeffXXfreeze}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x} \, \mathit{fresh}}%
\ottpremise{\Gamma  \vdash  \ottnt{use}  \ottsym{:}  \ottnt{t}  \dashv  \Gamma'}%
\ottpremise{ \textsf{cap}(   \textsf{iso}   ,  \ottnt{t}  ) }%
}{
\Gamma  \ottsym{::}  \overline{\Gamma}  \vdash   \textit{freeze} (  \ottmv{x}  ,  \ottnt{use}  )   \dashv  \Gamma'  \ottsym{,}  \ottmv{x}  \ottsym{:}   \mathit{make\_imm} (  \ottnt{t}  )   \ottsym{::}  \overline{\Gamma}}{%
{\ottdrulename{wf\_eff\_freeze}}{}%
}}


\newcommand{\ottdrulewfXXeffXXmerge}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x} \, \mathit{fresh}}%
\ottpremise{\Gamma  \vdash  \ottnt{use}  \ottsym{:}  \ottnt{t}  \dashv  \Gamma'}%
\ottpremise{ \textsf{cap}(   \textsf{iso}   ,  \ottnt{t}  ) }%
}{
\Gamma  \ottsym{::}  \overline{\Gamma}  \vdash   \textit{merge} (  \ottmv{x} ,  \ottnt{use}  )   \dashv  \Gamma'  \ottsym{,}  \ottmv{x}  \ottsym{:}   \mathit{make\_mut} (  \ottnt{t}  )   \ottsym{::}  \overline{\Gamma}}{%
{\ottdrulename{wf\_eff\_merge}}{}%
}}


\newcommand{\ottdrulewfXXeffXXcast}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x} \, \mathit{fresh}}%
\ottpremise{\Gamma  \vdash  \ottnt{use}  \ottsym{:}  \ottnt{t}  \dashv  \Gamma'}%
\ottpremise{ \ottnt{k}  ~   C    \ottsym{<:}  \ottnt{t'}}%
}{
\Gamma  \ottsym{::}  \overline{\Gamma}  \vdash   \textit{cast} (  \ottmv{x} ,  \ottnt{use} ,  \ottnt{k} ~  C   )   \dashv  \Gamma'  \ottsym{,}  \ottmv{x}  \ottsym{:}  \ottnt{t'}  \ottsym{::}  \overline{\Gamma}}{%
{\ottdrulename{wf\_eff\_cast}}{}%
}}


\newcommand{\ottdrulewfXXeffXXnocast}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{x} \, \mathit{fresh}}%
\ottpremise{\Gamma  \vdash  \ottnt{use}  \ottsym{:}  \ottnt{t}  \dashv  \Gamma'}%
}{
\Gamma  \ottsym{::}  \overline{\Gamma}  \vdash   \textit{nocast} (  \ottmv{x} ,  \ottnt{use} ,  \ottnt{k} ~  C   )   \dashv  \Gamma'  \ottsym{,}  \ottmv{x}  \ottsym{:}  \ottnt{t}  \ottsym{::}  \overline{\Gamma}}{%
{\ottdrulename{wf\_eff\_nocast}}{}%
}}


\newcommand{\ottdrulewfXXeffXXbind}[1]{\ottdrule[#1]{%
\ottpremise{ \forall    \ottmv{i}  \in [1,  \ottmv{n}  ]   . ~  \ottmv{x_{\ottmv{i}}} \, \mathit{fresh} }%
\ottpremise{ \forall    \ottmv{i}  \in [1,  \ottmv{n}  ]   . ~  \Gamma_{\ottmv{i}}  \vdash  \ottnt{use_{\ottmv{i}}}  \ottsym{:}  \ottnt{t_{\ottmv{i}}}  \dashv   \Gamma_{i+1}  }%
}{
\Gamma_{{\mathrm{1}}}  \ottsym{::}  \overline{\Gamma}  \vdash   \textit{bind} (  \ottmv{x_{{\mathrm{1}}}}  \ottsym{=}  \ottnt{use_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{x_{\ottmv{n}}}  \ottsym{=}  \ottnt{use_{\ottmv{n}}}  )   \dashv   \Gamma_{n+1}   \ottsym{,}  \ottmv{x_{{\mathrm{1}}}}  \ottsym{:}  \ottnt{t_{{\mathrm{1}}}}  \ottsym{,} \, ... \, \ottsym{,}  \ottmv{x_{\ottmv{n}}}  \ottsym{:}  \ottnt{t_{\ottmv{n}}}  \ottsym{::}  \overline{\Gamma}}{%
{\ottdrulename{wf\_eff\_bind}}{}%
}}


\newcommand{\ottdrulewfXXeffXXsplit}[1]{\ottdrule[#1]{%
\ottpremise{\overline{\Gamma}  \ottsym{[}  \ottmv{x}  \ottsym{:}  \ottnt{t}  \ottsym{]}  \vdash  \ottnt{Eff}  \dashv  \overline{\Gamma}_{{\mathrm{1}}}}%
\ottpremise{\overline{\Gamma}  \ottsym{[}  \ottmv{x}  \ottsym{:}  \ottnt{t'}  \ottsym{]}  \vdash  \ottnt{Eff}  \dashv  \overline{\Gamma}_{{\mathrm{2}}}}%
}{
\overline{\Gamma}  \ottsym{[}  \ottmv{x}  \ottsym{:}   \ottnt{t}  \mathop{|}  \ottnt{t'}   \ottsym{]}  \vdash  \ottnt{Eff}  \dashv   \overline{\Gamma}_{{\mathrm{1}}}  \mathop{|}  \overline{\Gamma}_{{\mathrm{2}}} }{%
{\ottdrulename{wf\_eff\_split}}{}%
}}

\newcommand{\ottdefnwfXXwfXXeff}[1]{\begin{ottdefnblock}[#1]{$\overline{\Gamma}  \vdash  \ottnt{Eff}  \dashv  \overline{\Gamma}'$}{}
\ottusedrule{\ottdrulewfXXeffXXeps{}}
\ottusedrule{\ottdrulewfXXeffXXenter{}}
\ottusedrule{\ottdrulewfXXeffXXbadenter{}}
\ottusedrule{\ottdrulewfXXeffXXexit{}}
\ottusedrule{\ottdrulewfXXeffXXload{}}
\ottusedrule{\ottdrulewfXXeffXXswapXXclass{}}
\ottusedrule{\ottdrulewfXXeffXXswapXXvar{}}
\ottusedrule{\ottdrulewfXXeffXXhallocXXmut{}}
\ottusedrule{\ottdrulewfXXeffXXhallocXXiso{}}
\ottusedrule{\ottdrulewfXXeffXXsalloc{}}
\ottusedrule{\ottdrulewfXXeffXXfreeze{}}
\ottusedrule{\ottdrulewfXXeffXXmerge{}}
\ottusedrule{\ottdrulewfXXeffXXcast{}}
\ottusedrule{\ottdrulewfXXeffXXnocast{}}
\ottusedrule{\ottdrulewfXXeffXXbind{}}
\ottusedrule{\ottdrulewfXXeffXXsplit{}}
\end{ottdefnblock}}


\newcommand{\ottdefnsWellFormedness}{
\ottdefnwfXXwfXXccfg{}\ottdefnwfXXwfXXrcfg{}\ottdefnwfXXwfXXde{}\ottdefnwfXXwfXXpsiXXdeltaXXrcfg{}\ottdefnwfXXwfXXrs{}\ottdefnwfXXwfXXdelta{}\ottdefnwfXXwfXXH{}\ottdefnwfXXwfXXsubheap{}\ottdefnwfXXwfXXF{}\ottdefnwfXXwfXXeff{}}

% defns Order
%% defn lt
\newcommand{\ottdruleregionXXorderXXltXXcons}[1]{\ottdrule[#1]{%
\ottpremise{ \ottmv{r}  \in  \rho }%
}{
 \ottmv{r'}  \rhosep{ \ottmv{x} . \ottnt{f} }  \rho   \vdash  \ottmv{r} \, < \, \ottmv{r'}}{%
{\ottdrulename{region\_order\_lt\_cons}}{}%
}}

\newcommand{\ottdefnregionXXorderXXlt}[1]{\begin{ottdefnblock}[#1]{$\rho  \vdash  \ottmv{r} \, < \, \ottmv{r'}$}{}
\ottusedrule{\ottdruleregionXXorderXXltXXcons{}}
\end{ottdefnblock}}

%% defn leq
\newcommand{\ottdruleregionXXorderXXleqXXstrict}[1]{\ottdrule[#1]{%
\ottpremise{\rho  \vdash  \ottmv{r} \, < \, \ottmv{r'}}%
}{
\rho  \vdash  \ottmv{r} \, \leq \, \ottmv{r'}}{%
{\ottdrulename{region\_order\_leq\_strict}}{}%
}}


\newcommand{\ottdruleregionXXorderXXleqXXeq}[1]{\ottdrule[#1]{%
}{
\rho  \vdash  \ottmv{r} \, \leq \, \ottmv{r}}{%
{\ottdrulename{region\_order\_leq\_eq}}{}%
}}

\newcommand{\ottdefnregionXXorderXXleq}[1]{\begin{ottdefnblock}[#1]{$\rho  \vdash  \ottmv{r} \, \leq \, \ottmv{r'}$}{}
\ottusedrule{\ottdruleregionXXorderXXleqXXstrict{}}
\ottusedrule{\ottdruleregionXXorderXXleqXXeq{}}
\end{ottdefnblock}}


\newcommand{\ottdefnsOrder}{
\ottdefnregionXXorderXXlt{}\ottdefnregionXXorderXXleq{}}

\newcommand{\ottdefnss}{
\ottdefnsTandem
\ottdefnsRegion
\ottdefnsCommand
\ottdefnsTyping
\ottdefnsWellFormedness
\ottdefnsOrder
}

\newcommand{\ottall}{\ottmetavars\\[0pt]
\ottgrammar\\[5.0mm]
\ottdefnss}

